<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.124">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="need to implement custom data preparation pipeline and loss function">

<title>meteo_imp - Implement Kalman model using FastAI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="meteo_imp - Implement Kalman model using FastAI">
<meta property="og:description" content="need to implement custom data preparation pipeline and loss function">
<meta property="og:site-name" content="meteo_imp">
<meta name="twitter:title" content="meteo_imp - Implement Kalman model using FastAI">
<meta name="twitter:description" content="need to implement custom data preparation pipeline and loss function">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">meteo_imp</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Implement Kalman model using FastAI</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">GPFA Imputation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_preparation.html" class="sidebar-item-text sidebar-link">Data Preparation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../results.html" class="sidebar-item-text sidebar-link">Results</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../simplegp_imputation.html" class="sidebar-item-text sidebar-link">Simple GP Imputation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gaussian.html" class="sidebar-item-text sidebar-link">Gaussian Distributions Utils</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../utils.html" class="sidebar-item-text sidebar-link">Utils</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Fluxnet</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fluxnet/gap_finder.html" class="sidebar-item-text sidebar-link">Find Gaps in Fluxnet data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fluxnet/hainich.html" class="sidebar-item-text sidebar-link">Fluxnet Hainich</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">GPFA</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../GPFA/gpfa.html" class="sidebar-item-text sidebar-link">Gaussian Processes Factor Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../GPFA/learner.html" class="sidebar-item-text sidebar-link">GPFA Learner</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../GPFA/imputation.html" class="sidebar-item-text sidebar-link">Imputation time series</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">kalman</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/filter.html" class="sidebar-item-text sidebar-link">Kalman Filter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/test_filter_pykalman.html" class="sidebar-item-text sidebar-link">Compare PyKalman</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/filter_performance-stability.html" class="sidebar-item-text sidebar-link">Filter Perfomance and Stability</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/filter_numerical_stability.html" class="sidebar-item-text sidebar-link">Numerical stability filter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/fastai.html" class="sidebar-item-text sidebar-link active">Implement Kalman model using FastAI</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/learner.html" class="sidebar-item-text sidebar-link">Kalman Filter Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/imputation.html" class="sidebar-item-text sidebar-link">Imputation Kalman Model</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/old statsmodels - statespace.html" class="sidebar-item-text sidebar-link">[Not Working] StatsModels Kalman filter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/old_01_pykalman_models.html" class="sidebar-item-text sidebar-link">[OLD] PyKalman Filter Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/old_02_pykalman_imputation.html" class="sidebar-item-text sidebar-link">[OLD] Imputation PyKalman Model</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link active" data-scroll-target="#data-preparation">Data Preparation</a>
  <ul class="collapse">
  <li><a href="#utils" id="toc-utils" class="nav-link" data-scroll-target="#utils">Utils</a></li>
  <li><a href="#block-index" id="toc-block-index" class="nav-link" data-scroll-target="#block-index">1) Block Index</a></li>
  <li><a href="#blockindextransform" id="toc-blockindextransform" class="nav-link" data-scroll-target="#blockindextransform">BlockIndexTransform</a></li>
  <li><a href="#meteo-imp-block-dataframes" id="toc-meteo-imp-block-dataframes" class="nav-link" data-scroll-target="#meteo-imp-block-dataframes">2) Meteo Imp Block DataFrames</a></li>
  <li><a href="#datacontrol" id="toc-datacontrol" class="nav-link" data-scroll-target="#datacontrol">DataControl</a></li>
  <li><a href="#blockdftransform" id="toc-blockdftransform" class="nav-link" data-scroll-target="#blockdftransform">BlockDfTransform</a></li>
  <li><a href="#gaps" id="toc-gaps" class="nav-link" data-scroll-target="#gaps">3) Gaps</a></li>
  <li><a href="#gen_gap_len" id="toc-gen_gap_len" class="nav-link" data-scroll-target="#gen_gap_len">gen_gap_len</a></li>
  <li><a href="#gen_var_sel" id="toc-gen_var_sel" class="nav-link" data-scroll-target="#gen_var_sel">gen_var_sel</a></li>
  <li><a href="#as_generator" id="toc-as_generator" class="nav-link" data-scroll-target="#as_generator">as_generator</a></li>
  <li><a href="#meteoimpdf" id="toc-meteoimpdf" class="nav-link" data-scroll-target="#meteoimpdf">MeteoImpDf</a></li>
  <li><a href="#addgaptransform" id="toc-addgaptransform" class="nav-link" data-scroll-target="#addgaptransform">AddGapTransform</a></li>
  <li><a href="#meteoimpdf.tidy" id="toc-meteoimpdf.tidy" class="nav-link" data-scroll-target="#meteoimpdf.tidy">MeteoImpDf.tidy</a></li>
  <li><a href="#find_gap_limits" id="toc-find_gap_limits" class="nav-link" data-scroll-target="#find_gap_limits">find_gap_limits</a></li>
  <li><a href="#plot_missing_area" id="toc-plot_missing_area" class="nav-link" data-scroll-target="#plot_missing_area">plot_missing_area</a></li>
  <li><a href="#plot_points" id="toc-plot_points" class="nav-link" data-scroll-target="#plot_points">plot_points</a></li>
  <li><a href="#plot_variable" id="toc-plot_variable" class="nav-link" data-scroll-target="#plot_variable">plot_variable</a></li>
  <li><a href="#facet_variable" id="toc-facet_variable" class="nav-link" data-scroll-target="#facet_variable">facet_variable</a></li>
  <li><a href="#meteoimpdf.show" id="toc-meteoimpdf.show" class="nav-link" data-scroll-target="#meteoimpdf.show">MeteoImpDf.show</a></li>
  <li><a href="#to-tensor" id="toc-to-tensor" class="nav-link" data-scroll-target="#to-tensor">4) To Tensor</a></li>
  <li><a href="#meteoimptensor" id="toc-meteoimptensor" class="nav-link" data-scroll-target="#meteoimptensor">MeteoImpTensor</a></li>
  <li><a href="#meteoimpdf2tensor" id="toc-meteoimpdf2tensor" class="nav-link" data-scroll-target="#meteoimpdf2tensor">MeteoImpDf2Tensor</a></li>
  <li><a href="#normalize" id="toc-normalize" class="nav-link" data-scroll-target="#normalize">5) Normalize</a></li>
  <li><a href="#normalsparams" id="toc-normalsparams" class="nav-link" data-scroll-target="#normalsparams">NormalsParams</a></li>
  <li><a href="#get_stats" id="toc-get_stats" class="nav-link" data-scroll-target="#get_stats">get_stats</a></li>
  <li><a href="#meteoimpnormalize" id="toc-meteoimpnormalize" class="nav-link" data-scroll-target="#meteoimpnormalize">MeteoImpNormalize</a></li>
  <li><a href="#to-tuple" id="toc-to-tuple" class="nav-link" data-scroll-target="#to-tuple">6) To Tuple</a></li>
  <li><a href="#totuple" id="toc-totuple" class="nav-link" data-scroll-target="#totuple">ToTuple</a></li>
  <li><a href="#pipeline" id="toc-pipeline" class="nav-link" data-scroll-target="#pipeline">Pipeline</a></li>
  <li><a href="#imp_pipeline" id="toc-imp_pipeline" class="nav-link" data-scroll-target="#imp_pipeline">imp_pipeline</a></li>
  <li><a href="#dataloader" id="toc-dataloader" class="nav-link" data-scroll-target="#dataloader">Dataloader</a></li>
  <li><a href="#imp_dataloader" id="toc-imp_dataloader" class="nav-link" data-scroll-target="#imp_dataloader">imp_dataloader</a></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a>
  <ul class="collapse">
  <li><a href="#forward-function" id="toc-forward-function" class="nav-link" data-scroll-target="#forward-function">Forward Function</a></li>
  <li><a href="#kalmanfilter.forward" id="toc-kalmanfilter.forward" class="nav-link" data-scroll-target="#kalmanfilter.forward">KalmanFilter.forward</a></li>
  <li><a href="#loss-function" id="toc-loss-function" class="nav-link" data-scroll-target="#loss-function">Loss Function</a></li>
  <li><a href="#kalmanloss" id="toc-kalmanloss" class="nav-link" data-scroll-target="#kalmanloss">KalmanLoss</a></li>
  <li><a href="#metrics" id="toc-metrics" class="nav-link" data-scroll-target="#metrics">Metrics</a></li>
  <li><a href="#impmetric" id="toc-impmetric" class="nav-link" data-scroll-target="#impmetric">ImpMetric</a></li>
  <li><a href="#callback" id="toc-callback" class="nav-link" data-scroll-target="#callback">Callback</a></li>
  <li><a href="#saveparams" id="toc-saveparams" class="nav-link" data-scroll-target="#saveparams">SaveParams</a></li>
  <li><a href="#saveparams-1" id="toc-saveparams-1" class="nav-link" data-scroll-target="#saveparams-1">SaveParams</a></li>
  <li><a href="#learner" id="toc-learner" class="nav-link" data-scroll-target="#learner">Learner</a></li>
  <li><a href="#float64callback" id="toc-float64callback" class="nav-link" data-scroll-target="#float64callback">Float64Callback</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a></li>
  <li><a href="#normalsdf" id="toc-normalsdf" class="nav-link" data-scroll-target="#normalsdf">NormalsDf</a></li>
  <li><a href="#preds2df" id="toc-preds2df" class="nav-link" data-scroll-target="#preds2df">preds2df</a></li>
  <li><a href="#predict_items" id="toc-predict_items" class="nav-link" data-scroll-target="#predict_items">predict_items</a></li>
  <li><a href="#format_metric" id="toc-format_metric" class="nav-link" data-scroll-target="#format_metric">format_metric</a></li>
  <li><a href="#plot_result" id="toc-plot_result" class="nav-link" data-scroll-target="#plot_result">plot_result</a></li>
  <li><a href="#plot_results" id="toc-plot_results" class="nav-link" data-scroll-target="#plot_results">plot_results</a></li>
  <li><a href="#get_results" id="toc-get_results" class="nav-link" data-scroll-target="#get_results">get_results</a></li>
  <li><a href="#show_results" id="toc-show_results" class="nav-link" data-scroll-target="#show_results">show_results</a></li>
  <li><a href="#results_custom_gap" id="toc-results_custom_gap" class="nav-link" data-scroll-target="#results_custom_gap">results_custom_gap</a></li>
  <li><a href="#interact_results" id="toc-interact_results" class="nav-link" data-scroll-target="#interact_results">interact_results</a></li>
  </ul></li>
  <li><a href="#export" id="toc-export" class="nav-link" data-scroll-target="#export">Export</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mone27/meteo_imp/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Implement Kalman model using FastAI</h1>
</div>

<div>
  <div class="description">
    need to implement custom data preparation pipeline and loss function
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>reset_seed()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>hai_path</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Path('/home/simone/Documents/uni/Thesis/GPFA_imputation/data/FLX_DE-Hai_FLUXNET2015_FULLSET_HH_2000-2012_1-4_float32.parquet')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>hai <span class="op">=</span> pd.read_parquet(hai_path)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>hai64 <span class="op">=</span> pd.read_parquet(hai_path64)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>hai_era <span class="op">=</span> pd.read_parquet(hai_era_path)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>hai_era64 <span class="op">=</span> pd.read_parquet(hai_era_path64)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<p>The aim of the data preparation pipeline is to: - take the original time series and split it into time blocks - for each block generate a random gap (need to figure out the properties of the gap) - split some time blocks for testing</p>
<p>the input of the pipeline is: - a dataframe containing all observations</p>
<p>the input of the model is: - observed data (potentially containing NaN where data is missing) - missing data mask (which is telling where the data is missing) - the data needs to be standardized</p>
<section id="utils" class="level3">
<h3 class="anchored" data-anchor-id="utils">Utils</h3>
</section>
<section id="block-index" class="level3">
<h3 class="anchored" data-anchor-id="block-index">1) Block Index</h3>
<p>the first step is to transfrom the original dataframe into blocks of a specified <code>block_len</code></p>
<p>two different strategies are possible:</p>
<ul>
<li>contigous blocks</li>
<li>random block in the dataframe</li>
</ul>
<p>for now contigous blocks are used</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L59" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="blockindextransform" class="level3">
<h3 class="anchored" data-anchor-id="blockindextransform">BlockIndexTransform</h3>
<blockquote class="blockquote">
<pre><code> BlockIndexTransform (idx:pandas.core.indexes.datetimes.DatetimeIndex,
                      block_len:int=200, offset=1)</code></pre>
</blockquote>
<p>divide timeseries DataFrame index into blocks</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>blk <span class="op">=</span> BlockIndexTransform(hai.index, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>blk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
  <p>
    <strong>BlockIndexTransform</strong>
  </p>
  <p>(list,object) -&gt; encodes
</p>
  <p></p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hai.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>DatetimeIndex(['2000-01-01 00:30:00', '2000-01-01 01:00:00',
               '2000-01-01 01:30:00', '2000-01-01 02:00:00',
               '2000-01-01 02:30:00', '2000-01-01 03:00:00',
               '2000-01-01 03:30:00', '2000-01-01 04:00:00',
               '2000-01-01 04:30:00', '2000-01-01 05:00:00',
               ...
               '2012-12-31 19:30:00', '2012-12-31 20:00:00',
               '2012-12-31 20:30:00', '2012-12-31 21:00:00',
               '2012-12-31 21:30:00', '2012-12-31 22:00:00',
               '2012-12-31 22:30:00', '2012-12-31 23:00:00',
               '2012-12-31 23:30:00', '2013-01-01 00:00:00'],
              dtype='datetime64[ns]', name='time', length=227952, freq=None)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>blk([<span class="dv">2</span>,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>DatetimeIndex(['2000-01-01 12:30:00', '2000-01-01 13:00:00',
               '2000-01-01 13:30:00', '2000-01-01 14:00:00',
               '2000-01-01 14:30:00', '2000-01-01 15:00:00',
               '2000-01-01 15:30:00', '2000-01-01 16:00:00',
               '2000-01-01 16:30:00', '2000-01-01 17:00:00'],
              dtype='datetime64[ns]', name='time', freq=None)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>blk([<span class="dv">2</span>,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>DatetimeIndex(['2000-01-01 12:00:00', '2000-01-01 12:30:00',
               '2000-01-01 13:00:00', '2000-01-01 13:30:00',
               '2000-01-01 14:00:00', '2000-01-01 14:30:00',
               '2000-01-01 15:00:00', '2000-01-01 15:30:00',
               '2000-01-01 16:00:00', '2000-01-01 16:30:00'],
              dtype='datetime64[ns]', name='time', freq=None)</code></pre>
</div>
</div>
</section>
<section id="meteo-imp-block-dataframes" class="level3">
<h3 class="anchored" data-anchor-id="meteo-imp-block-dataframes">2) Meteo Imp Block DataFrames</h3>
<p>Get a chunck out of dataframes given an index</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L76" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="datacontrol" class="level3">
<h3 class="anchored" data-anchor-id="datacontrol">DataControl</h3>
<blockquote class="blockquote">
<pre><code> DataControl (data:pandas.core.frame.DataFrame,
              control:pandas.core.frame.DataFrame)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> hai.loc[blk([<span class="dv">1</span>,<span class="dv">0</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df.rename(columns<span class="op">=</span>_rename_lag(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>TA_lag_1</th>
<th>SW_IN_lag_1</th>
<th>VPD_lag_1</th>
</tr>
<tr class="odd">
<th>time</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>2000-01-01 06:00:00</th>
<td>-0.23</td>
<td>0.00</td>
<td>0.122</td>
</tr>
<tr class="even">
<th>2000-01-01 06:30:00</th>
<td>-0.22</td>
<td>0.00</td>
<td>0.098</td>
</tr>
<tr class="odd">
<th>2000-01-01 07:00:00</th>
<td>-0.24</td>
<td>0.00</td>
<td>0.066</td>
</tr>
<tr class="even">
<th>2000-01-01 07:30:00</th>
<td>-0.23</td>
<td>0.00</td>
<td>0.044</td>
</tr>
<tr class="odd">
<th>2000-01-01 08:00:00</th>
<td>-0.22</td>
<td>0.00</td>
<td>0.026</td>
</tr>
<tr class="even">
<th>2000-01-01 08:30:00</th>
<td>-0.19</td>
<td>0.45</td>
<td>0.016</td>
</tr>
<tr class="odd">
<th>2000-01-01 09:00:00</th>
<td>-0.14</td>
<td>3.70</td>
<td>0.010</td>
</tr>
<tr class="even">
<th>2000-01-01 09:30:00</th>
<td>-0.03</td>
<td>7.26</td>
<td>0.006</td>
</tr>
<tr class="odd">
<th>2000-01-01 10:00:00</th>
<td>0.04</td>
<td>12.24</td>
<td>0.006</td>
</tr>
<tr class="even">
<th>2000-01-01 10:30:00</th>
<td>0.10</td>
<td>16.51</td>
<td>0.006</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>_lag_df(df, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>TA_lag_1</th>
<th>SW_IN_lag_1</th>
<th>VPD_lag_1</th>
</tr>
<tr class="odd">
<th>time</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>2000-01-01 06:00:00</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th>2000-01-01 06:30:00</th>
<td>-0.23</td>
<td>0.00</td>
<td>0.122</td>
</tr>
<tr class="odd">
<th>2000-01-01 07:00:00</th>
<td>-0.22</td>
<td>0.00</td>
<td>0.098</td>
</tr>
<tr class="even">
<th>2000-01-01 07:30:00</th>
<td>-0.24</td>
<td>0.00</td>
<td>0.066</td>
</tr>
<tr class="odd">
<th>2000-01-01 08:00:00</th>
<td>-0.23</td>
<td>0.00</td>
<td>0.044</td>
</tr>
<tr class="even">
<th>2000-01-01 08:30:00</th>
<td>-0.22</td>
<td>0.00</td>
<td>0.026</td>
</tr>
<tr class="odd">
<th>2000-01-01 09:00:00</th>
<td>-0.19</td>
<td>0.45</td>
<td>0.016</td>
</tr>
<tr class="even">
<th>2000-01-01 09:30:00</th>
<td>-0.14</td>
<td>3.70</td>
<td>0.010</td>
</tr>
<tr class="odd">
<th>2000-01-01 10:00:00</th>
<td>-0.03</td>
<td>7.26</td>
<td>0.006</td>
</tr>
<tr class="even">
<th>2000-01-01 10:30:00</th>
<td>0.04</td>
<td>12.24</td>
<td>0.006</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>_add_lags_df(df, [<span class="dv">1</span>,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>TA</th>
<th>SW_IN</th>
<th>VPD</th>
<th>TA_lag_1</th>
<th>SW_IN_lag_1</th>
<th>VPD_lag_1</th>
<th>TA_lag_2</th>
<th>SW_IN_lag_2</th>
<th>VPD_lag_2</th>
</tr>
<tr class="odd">
<th>time</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>2000-01-01 06:00:00</th>
<td>-0.23</td>
<td>0.00</td>
<td>0.122</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<th>2000-01-01 06:30:00</th>
<td>-0.22</td>
<td>0.00</td>
<td>0.098</td>
<td>-0.23</td>
<td>0.00</td>
<td>0.122</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<th>2000-01-01 07:00:00</th>
<td>-0.24</td>
<td>0.00</td>
<td>0.066</td>
<td>-0.22</td>
<td>0.00</td>
<td>0.098</td>
<td>-0.23</td>
<td>0.00</td>
<td>0.122</td>
</tr>
<tr class="even">
<th>2000-01-01 07:30:00</th>
<td>-0.23</td>
<td>0.00</td>
<td>0.044</td>
<td>-0.24</td>
<td>0.00</td>
<td>0.066</td>
<td>-0.22</td>
<td>0.00</td>
<td>0.098</td>
</tr>
<tr class="odd">
<th>2000-01-01 08:00:00</th>
<td>-0.22</td>
<td>0.00</td>
<td>0.026</td>
<td>-0.23</td>
<td>0.00</td>
<td>0.044</td>
<td>-0.24</td>
<td>0.00</td>
<td>0.066</td>
</tr>
<tr class="even">
<th>2000-01-01 08:30:00</th>
<td>-0.19</td>
<td>0.45</td>
<td>0.016</td>
<td>-0.22</td>
<td>0.00</td>
<td>0.026</td>
<td>-0.23</td>
<td>0.00</td>
<td>0.044</td>
</tr>
<tr class="odd">
<th>2000-01-01 09:00:00</th>
<td>-0.14</td>
<td>3.70</td>
<td>0.010</td>
<td>-0.19</td>
<td>0.45</td>
<td>0.016</td>
<td>-0.22</td>
<td>0.00</td>
<td>0.026</td>
</tr>
<tr class="even">
<th>2000-01-01 09:30:00</th>
<td>-0.03</td>
<td>7.26</td>
<td>0.006</td>
<td>-0.14</td>
<td>3.70</td>
<td>0.010</td>
<td>-0.19</td>
<td>0.45</td>
<td>0.016</td>
</tr>
<tr class="odd">
<th>2000-01-01 10:00:00</th>
<td>0.04</td>
<td>12.24</td>
<td>0.006</td>
<td>-0.03</td>
<td>7.26</td>
<td>0.006</td>
<td>-0.14</td>
<td>3.70</td>
<td>0.010</td>
</tr>
<tr class="even">
<th>2000-01-01 10:30:00</th>
<td>0.10</td>
<td>16.51</td>
<td>0.006</td>
<td>0.04</td>
<td>12.24</td>
<td>0.006</td>
<td>-0.03</td>
<td>7.26</td>
<td>0.006</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L104" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="blockdftransform" class="level3">
<h3 class="anchored" data-anchor-id="blockdftransform">BlockDfTransform</h3>
<blockquote class="blockquote">
<pre><code> BlockDfTransform (data:pandas.core.frame.DataFrame,
                   control:pandas.core.frame.DataFrame,
                   control_lags:Union[int,Iterable[int]])</code></pre>
</blockquote>
<p>divide timeseries DataFrame index into blocks</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>blkdf <span class="op">=</span> BlockDfTransform(hai, hai_era, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>blkdf(blk([<span class="dv">1</span>,<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table id="T_e3e5e" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_e3e5e_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_e3e5e_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_e3e5e_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_e3e5e_level0_row0" class="row_heading level0 row0">2000-01-01 07:00:00</th>
<td id="T_e3e5e_row0_col0" class="data row0 col0">-0.2400</td>
<td id="T_e3e5e_row0_col1" class="data row0 col1">0.0000</td>
<td id="T_e3e5e_row0_col2" class="data row0 col2">0.0660</td>
</tr>
<tr class="even">
<th id="T_e3e5e_level0_row1" class="row_heading level0 row1">2000-01-01 07:30:00</th>
<td id="T_e3e5e_row1_col0" class="data row1 col0">-0.2300</td>
<td id="T_e3e5e_row1_col1" class="data row1 col1">0.0000</td>
<td id="T_e3e5e_row1_col2" class="data row1 col2">0.0440</td>
</tr>
<tr class="odd">
<th id="T_e3e5e_level0_row2" class="row_heading level0 row2">2000-01-01 08:00:00</th>
<td id="T_e3e5e_row2_col0" class="data row2 col0">-0.2200</td>
<td id="T_e3e5e_row2_col1" class="data row2 col1">0.0000</td>
<td id="T_e3e5e_row2_col2" class="data row2 col2">0.0260</td>
</tr>
<tr class="even">
<th id="T_e3e5e_level0_row3" class="row_heading level0 row3">2000-01-01 08:30:00</th>
<td id="T_e3e5e_row3_col0" class="data row3 col0">-0.1900</td>
<td id="T_e3e5e_row3_col1" class="data row3 col1">0.4500</td>
<td id="T_e3e5e_row3_col2" class="data row3 col2">0.0160</td>
</tr>
<tr class="odd">
<th id="T_e3e5e_level0_row4" class="row_heading level0 row4">2000-01-01 09:00:00</th>
<td id="T_e3e5e_row4_col0" class="data row4 col0">-0.1400</td>
<td id="T_e3e5e_row4_col1" class="data row4 col1">3.7000</td>
<td id="T_e3e5e_row4_col2" class="data row4 col2">0.0100</td>
</tr>
<tr class="even">
<th id="T_e3e5e_level0_row5" class="row_heading level0 row5">2000-01-01 09:30:00</th>
<td id="T_e3e5e_row5_col0" class="data row5 col0">-0.0300</td>
<td id="T_e3e5e_row5_col1" class="data row5 col1">7.2600</td>
<td id="T_e3e5e_row5_col2" class="data row5 col2">0.0060</td>
</tr>
<tr class="odd">
<th id="T_e3e5e_level0_row6" class="row_heading level0 row6">2000-01-01 10:00:00</th>
<td id="T_e3e5e_row6_col0" class="data row6 col0">0.0400</td>
<td id="T_e3e5e_row6_col1" class="data row6 col1">12.2400</td>
<td id="T_e3e5e_row6_col2" class="data row6 col2">0.0060</td>
</tr>
<tr class="even">
<th id="T_e3e5e_level0_row7" class="row_heading level0 row7">2000-01-01 10:30:00</th>
<td id="T_e3e5e_row7_col0" class="data row7 col0">0.1000</td>
<td id="T_e3e5e_row7_col1" class="data row7 col1">16.5100</td>
<td id="T_e3e5e_row7_col2" class="data row7 col2">0.0060</td>
</tr>
<tr class="odd">
<th id="T_e3e5e_level0_row8" class="row_heading level0 row8">2000-01-01 11:00:00</th>
<td id="T_e3e5e_row8_col0" class="data row8 col0">0.1800</td>
<td id="T_e3e5e_row8_col1" class="data row8 col1">24.7300</td>
<td id="T_e3e5e_row8_col2" class="data row8 col2">0.0110</td>
</tr>
<tr class="even">
<th id="T_e3e5e_level0_row9" class="row_heading level0 row9">2000-01-01 11:30:00</th>
<td id="T_e3e5e_row9_col0" class="data row9 col0">0.2100</td>
<td id="T_e3e5e_row9_col1" class="data row9 col1">47.4200</td>
<td id="T_e3e5e_row9_col2" class="data row9 col2">0.0190</td>
</tr>
</tbody>
</table>
<div>
<p>control</p>
<table id="T_75115" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_75115_level0_col0" class="col_heading level0 col0">TA_ERA</th>
<th id="T_75115_level0_col1" class="col_heading level0 col1">SW_IN_ERA</th>
<th id="T_75115_level0_col2" class="col_heading level0 col2">VPD_ERA</th>
<th id="T_75115_level0_col3" class="col_heading level0 col3">TA_ERA_lag_1</th>
<th id="T_75115_level0_col4" class="col_heading level0 col4">SW_IN_ERA_lag_1</th>
<th id="T_75115_level0_col5" class="col_heading level0 col5">VPD_ERA_lag_1</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
<th class="blank col3">&nbsp;</th>
<th class="blank col4">&nbsp;</th>
<th class="blank col5">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_75115_level0_row0" class="row_heading level0 row0">2000-01-01 07:00:00</th>
<td id="T_75115_row0_col0" class="data row0 col0">-0.1420</td>
<td id="T_75115_row0_col1" class="data row0 col1">0.0000</td>
<td id="T_75115_row0_col2" class="data row0 col2">0.5100</td>
<td id="T_75115_row0_col3" class="data row0 col3">-0.2110</td>
<td id="T_75115_row0_col4" class="data row0 col4">0.0000</td>
<td id="T_75115_row0_col5" class="data row0 col5">0.5060</td>
</tr>
<tr class="even">
<th id="T_75115_level0_row1" class="row_heading level0 row1">2000-01-01 07:30:00</th>
<td id="T_75115_row1_col0" class="data row1 col0">-0.0740</td>
<td id="T_75115_row1_col1" class="data row1 col1">0.0000</td>
<td id="T_75115_row1_col2" class="data row1 col2">0.5150</td>
<td id="T_75115_row1_col3" class="data row1 col3">-0.1420</td>
<td id="T_75115_row1_col4" class="data row1 col4">0.0000</td>
<td id="T_75115_row1_col5" class="data row1 col5">0.5100</td>
</tr>
<tr class="odd">
<th id="T_75115_level0_row2" class="row_heading level0 row2">2000-01-01 08:00:00</th>
<td id="T_75115_row2_col0" class="data row2 col0">0.0440</td>
<td id="T_75115_row2_col1" class="data row2 col1">0.0000</td>
<td id="T_75115_row2_col2" class="data row2 col2">0.5270</td>
<td id="T_75115_row2_col3" class="data row2 col3">-0.0740</td>
<td id="T_75115_row2_col4" class="data row2 col4">0.0000</td>
<td id="T_75115_row2_col5" class="data row2 col5">0.5150</td>
</tr>
<tr class="even">
<th id="T_75115_level0_row3" class="row_heading level0 row3">2000-01-01 08:30:00</th>
<td id="T_75115_row3_col0" class="data row3 col0">0.1610</td>
<td id="T_75115_row3_col1" class="data row3 col1">0.0000</td>
<td id="T_75115_row3_col2" class="data row3 col2">0.5390</td>
<td id="T_75115_row3_col3" class="data row3 col3">0.0440</td>
<td id="T_75115_row3_col4" class="data row3 col4">0.0000</td>
<td id="T_75115_row3_col5" class="data row3 col5">0.5270</td>
</tr>
<tr class="odd">
<th id="T_75115_level0_row4" class="row_heading level0 row4">2000-01-01 09:00:00</th>
<td id="T_75115_row4_col0" class="data row4 col0">0.2790</td>
<td id="T_75115_row4_col1" class="data row4 col1">2.6550</td>
<td id="T_75115_row4_col2" class="data row4 col2">0.5510</td>
<td id="T_75115_row4_col3" class="data row4 col3">0.1610</td>
<td id="T_75115_row4_col4" class="data row4 col4">0.0000</td>
<td id="T_75115_row4_col5" class="data row4 col5">0.5390</td>
</tr>
<tr class="even">
<th id="T_75115_level0_row5" class="row_heading level0 row5">2000-01-01 09:30:00</th>
<td id="T_75115_row5_col0" class="data row5 col0">0.3960</td>
<td id="T_75115_row5_col1" class="data row5 col1">7.0800</td>
<td id="T_75115_row5_col2" class="data row5 col2">0.5630</td>
<td id="T_75115_row5_col3" class="data row5 col3">0.2790</td>
<td id="T_75115_row5_col4" class="data row5 col4">2.6550</td>
<td id="T_75115_row5_col5" class="data row5 col5">0.5510</td>
</tr>
<tr class="odd">
<th id="T_75115_level0_row6" class="row_heading level0 row6">2000-01-01 10:00:00</th>
<td id="T_75115_row6_col0" class="data row6 col0">0.5140</td>
<td id="T_75115_row6_col1" class="data row6 col1">10.9880</td>
<td id="T_75115_row6_col2" class="data row6 col2">0.5750</td>
<td id="T_75115_row6_col3" class="data row6 col3">0.3960</td>
<td id="T_75115_row6_col4" class="data row6 col4">7.0800</td>
<td id="T_75115_row6_col5" class="data row6 col5">0.5630</td>
</tr>
<tr class="even">
<th id="T_75115_level0_row7" class="row_heading level0 row7">2000-01-01 10:30:00</th>
<td id="T_75115_row7_col0" class="data row7 col0">0.6310</td>
<td id="T_75115_row7_col1" class="data row7 col1">18.0120</td>
<td id="T_75115_row7_col2" class="data row7 col2">0.5860</td>
<td id="T_75115_row7_col3" class="data row7 col3">0.5140</td>
<td id="T_75115_row7_col4" class="data row7 col4">10.9880</td>
<td id="T_75115_row7_col5" class="data row7 col5">0.5750</td>
</tr>
<tr class="odd">
<th id="T_75115_level0_row8" class="row_heading level0 row8">2000-01-01 11:00:00</th>
<td id="T_75115_row8_col0" class="data row8 col0">0.7520</td>
<td id="T_75115_row8_col1" class="data row8 col1">21.3900</td>
<td id="T_75115_row8_col2" class="data row8 col2">0.5880</td>
<td id="T_75115_row8_col3" class="data row8 col3">0.6310</td>
<td id="T_75115_row8_col4" class="data row8 col4">18.0120</td>
<td id="T_75115_row8_col5" class="data row8 col5">0.5860</td>
</tr>
<tr class="even">
<th id="T_75115_level0_row9" class="row_heading level0 row9">2000-01-01 11:30:00</th>
<td id="T_75115_row9_col0" class="data row9 col0">0.8730</td>
<td id="T_75115_row9_col1" class="data row9 col1">23.9050</td>
<td id="T_75115_row9_col2" class="data row9 col2">0.5900</td>
<td id="T_75115_row9_col3" class="data row9 col3">0.7520</td>
<td id="T_75115_row9_col4" class="data row9 col4">21.3900</td>
<td id="T_75115_row9_col5" class="data row9 col5">0.5880</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>taking a day in the summer so there is an higher values for the variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>blkdf(blk([<span class="dv">800</span>,<span class="dv">0</span>])).data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>TA</th>
<th>SW_IN</th>
<th>VPD</th>
</tr>
<tr class="odd">
<th>time</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>2000-06-15 17:00:00</th>
<td>14.22</td>
<td>224.800003</td>
<td>5.799</td>
</tr>
<tr class="even">
<th>2000-06-15 17:30:00</th>
<td>14.11</td>
<td>195.279999</td>
<td>6.577</td>
</tr>
<tr class="odd">
<th>2000-06-15 18:00:00</th>
<td>14.23</td>
<td>244.169998</td>
<td>6.931</td>
</tr>
<tr class="even">
<th>2000-06-15 18:30:00</th>
<td>14.40</td>
<td>253.919998</td>
<td>7.286</td>
</tr>
<tr class="odd">
<th>2000-06-15 19:00:00</th>
<td>14.09</td>
<td>177.309998</td>
<td>7.251</td>
</tr>
<tr class="even">
<th>2000-06-15 19:30:00</th>
<td>13.71</td>
<td>97.070000</td>
<td>6.683</td>
</tr>
<tr class="odd">
<th>2000-06-15 20:00:00</th>
<td>13.08</td>
<td>39.709999</td>
<td>5.851</td>
</tr>
<tr class="even">
<th>2000-06-15 20:30:00</th>
<td>12.41</td>
<td>10.650000</td>
<td>5.254</td>
</tr>
<tr class="odd">
<th>2000-06-15 21:00:00</th>
<td>12.27</td>
<td>0.320000</td>
<td>5.164</td>
</tr>
<tr class="even">
<th>2000-06-15 21:30:00</th>
<td>12.20</td>
<td>0.000000</td>
<td>5.037</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tfms1 <span class="op">=</span> TfmdLists([[<span class="dv">800</span>,<span class="dv">0</span>],[<span class="dv">801</span>,<span class="dv">0</span>],[<span class="dv">802</span>,<span class="dv">0</span>],[<span class="dv">803</span>,<span class="dv">0</span>]], [BlockIndexTransform(hai.index, <span class="dv">10</span>), BlockDfTransform(hai, hai_era, control_lags<span class="op">=</span><span class="dv">1</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tfms1[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table id="T_671df" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_671df_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_671df_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_671df_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_671df_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_671df_row0_col0" class="data row0 col0">14.2200</td>
<td id="T_671df_row0_col1" class="data row0 col1">224.8000</td>
<td id="T_671df_row0_col2" class="data row0 col2">5.7990</td>
</tr>
<tr class="even">
<th id="T_671df_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_671df_row1_col0" class="data row1 col0">14.1100</td>
<td id="T_671df_row1_col1" class="data row1 col1">195.2800</td>
<td id="T_671df_row1_col2" class="data row1 col2">6.5770</td>
</tr>
<tr class="odd">
<th id="T_671df_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_671df_row2_col0" class="data row2 col0">14.2300</td>
<td id="T_671df_row2_col1" class="data row2 col1">244.1700</td>
<td id="T_671df_row2_col2" class="data row2 col2">6.9310</td>
</tr>
<tr class="even">
<th id="T_671df_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_671df_row3_col0" class="data row3 col0">14.4000</td>
<td id="T_671df_row3_col1" class="data row3 col1">253.9200</td>
<td id="T_671df_row3_col2" class="data row3 col2">7.2860</td>
</tr>
<tr class="odd">
<th id="T_671df_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_671df_row4_col0" class="data row4 col0">14.0900</td>
<td id="T_671df_row4_col1" class="data row4 col1">177.3100</td>
<td id="T_671df_row4_col2" class="data row4 col2">7.2510</td>
</tr>
<tr class="even">
<th id="T_671df_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_671df_row5_col0" class="data row5 col0">13.7100</td>
<td id="T_671df_row5_col1" class="data row5 col1">97.0700</td>
<td id="T_671df_row5_col2" class="data row5 col2">6.6830</td>
</tr>
<tr class="odd">
<th id="T_671df_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_671df_row6_col0" class="data row6 col0">13.0800</td>
<td id="T_671df_row6_col1" class="data row6 col1">39.7100</td>
<td id="T_671df_row6_col2" class="data row6 col2">5.8510</td>
</tr>
<tr class="even">
<th id="T_671df_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_671df_row7_col0" class="data row7 col0">12.4100</td>
<td id="T_671df_row7_col1" class="data row7 col1">10.6500</td>
<td id="T_671df_row7_col2" class="data row7 col2">5.2540</td>
</tr>
<tr class="odd">
<th id="T_671df_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_671df_row8_col0" class="data row8 col0">12.2700</td>
<td id="T_671df_row8_col1" class="data row8 col1">0.3200</td>
<td id="T_671df_row8_col2" class="data row8 col2">5.1640</td>
</tr>
<tr class="even">
<th id="T_671df_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_671df_row9_col0" class="data row9 col0">12.2000</td>
<td id="T_671df_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_671df_row9_col2" class="data row9 col2">5.0370</td>
</tr>
</tbody>
</table>
<div>
<p>control</p>
<table id="T_404af" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_404af_level0_col0" class="col_heading level0 col0">TA_ERA</th>
<th id="T_404af_level0_col1" class="col_heading level0 col1">SW_IN_ERA</th>
<th id="T_404af_level0_col2" class="col_heading level0 col2">VPD_ERA</th>
<th id="T_404af_level0_col3" class="col_heading level0 col3">TA_ERA_lag_1</th>
<th id="T_404af_level0_col4" class="col_heading level0 col4">SW_IN_ERA_lag_1</th>
<th id="T_404af_level0_col5" class="col_heading level0 col5">VPD_ERA_lag_1</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
<th class="blank col3">&nbsp;</th>
<th class="blank col4">&nbsp;</th>
<th class="blank col5">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_404af_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_404af_row0_col0" class="data row0 col0">15.0500</td>
<td id="T_404af_row0_col1" class="data row0 col1">255.1930</td>
<td id="T_404af_row0_col2" class="data row0 col2">5.1020</td>
<td id="T_404af_row0_col3" class="data row0 col3">15.1390</td>
<td id="T_404af_row0_col4" class="data row0 col4">287.1000</td>
<td id="T_404af_row0_col5" class="data row0 col5">4.9000</td>
</tr>
<tr class="even">
<th id="T_404af_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_404af_row1_col0" class="data row1 col0">14.9610</td>
<td id="T_404af_row1_col1" class="data row1 col1">221.4270</td>
<td id="T_404af_row1_col2" class="data row1 col2">5.3050</td>
<td id="T_404af_row1_col3" class="data row1 col3">15.0500</td>
<td id="T_404af_row1_col4" class="data row1 col4">255.1930</td>
<td id="T_404af_row1_col5" class="data row1 col5">5.1020</td>
</tr>
<tr class="odd">
<th id="T_404af_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_404af_row2_col0" class="data row2 col0">14.8720</td>
<td id="T_404af_row2_col1" class="data row2 col1">186.3800</td>
<td id="T_404af_row2_col2" class="data row2 col2">5.5070</td>
<td id="T_404af_row2_col3" class="data row2 col3">14.9610</td>
<td id="T_404af_row2_col4" class="data row2 col4">221.4270</td>
<td id="T_404af_row2_col5" class="data row2 col5">5.3050</td>
</tr>
<tr class="even">
<th id="T_404af_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_404af_row3_col0" class="data row3 col0">14.7830</td>
<td id="T_404af_row3_col1" class="data row3 col1">150.6500</td>
<td id="T_404af_row3_col2" class="data row3 col2">5.7100</td>
<td id="T_404af_row3_col3" class="data row3 col3">14.8720</td>
<td id="T_404af_row3_col4" class="data row3 col4">186.3800</td>
<td id="T_404af_row3_col5" class="data row3 col5">5.5070</td>
</tr>
<tr class="odd">
<th id="T_404af_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_404af_row4_col0" class="data row4 col0">14.6940</td>
<td id="T_404af_row4_col1" class="data row4 col1">114.8490</td>
<td id="T_404af_row4_col2" class="data row4 col2">5.9120</td>
<td id="T_404af_row4_col3" class="data row4 col3">14.7830</td>
<td id="T_404af_row4_col4" class="data row4 col4">150.6500</td>
<td id="T_404af_row4_col5" class="data row4 col5">5.7100</td>
</tr>
<tr class="even">
<th id="T_404af_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_404af_row5_col0" class="data row5 col0">14.6060</td>
<td id="T_404af_row5_col1" class="data row5 col1">34.7280</td>
<td id="T_404af_row5_col2" class="data row5 col2">6.1140</td>
<td id="T_404af_row5_col3" class="data row5 col3">14.6940</td>
<td id="T_404af_row5_col4" class="data row5 col4">114.8490</td>
<td id="T_404af_row5_col5" class="data row5 col5">5.9120</td>
</tr>
<tr class="odd">
<th id="T_404af_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_404af_row6_col0" class="data row6 col0">14.3800</td>
<td id="T_404af_row6_col1" class="data row6 col1">19.8430</td>
<td id="T_404af_row6_col2" class="data row6 col2">6.0740</td>
<td id="T_404af_row6_col3" class="data row6 col3">14.6060</td>
<td id="T_404af_row6_col4" class="data row6 col4">34.7280</td>
<td id="T_404af_row6_col5" class="data row6 col5">6.1140</td>
</tr>
<tr class="even">
<th id="T_404af_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_404af_row7_col0" class="data row7 col0">14.1550</td>
<td id="T_404af_row7_col1" class="data row7 col1">5.7120</td>
<td id="T_404af_row7_col2" class="data row7 col2">6.0340</td>
<td id="T_404af_row7_col3" class="data row7 col3">14.3800</td>
<td id="T_404af_row7_col4" class="data row7 col4">19.8430</td>
<td id="T_404af_row7_col5" class="data row7 col5">6.0740</td>
</tr>
<tr class="odd">
<th id="T_404af_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_404af_row8_col0" class="data row8 col0">13.9290</td>
<td id="T_404af_row8_col1" class="data row8 col1">0.0000</td>
<td id="T_404af_row8_col2" class="data row8 col2">5.9940</td>
<td id="T_404af_row8_col3" class="data row8 col3">14.1550</td>
<td id="T_404af_row8_col4" class="data row8 col4">5.7120</td>
<td id="T_404af_row8_col5" class="data row8 col5">6.0340</td>
</tr>
<tr class="even">
<th id="T_404af_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_404af_row9_col0" class="data row9 col0">13.7040</td>
<td id="T_404af_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_404af_row9_col2" class="data row9 col2">5.9540</td>
<td id="T_404af_row9_col3" class="data row9 col3">13.9290</td>
<td id="T_404af_row9_col4" class="data row9 col4">0.0000</td>
<td id="T_404af_row9_col5" class="data row9 col5">5.9940</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="gaps" class="level3">
<h3 class="anchored" data-anchor-id="gaps">3) Gaps</h3>
<p>adds a mask which includes a random gap</p>
<section id="make-random-gap" class="level4">
<h4 class="anchored" data-anchor-id="make-random-gap">Make random Gap</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> L(<span class="op">*</span>tfms1[<span class="dv">0</span>].data.columns).argwhere(<span class="kw">lambda</span> x: x <span class="kw">in</span> [<span class="st">'TA'</span>,<span class="st">'SW_IN'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.ones_like(tfms1[<span class="dv">0</span>].data, dtype<span class="op">=</span><span class="bu">bool</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _make_random_gap(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    gap_length: <span class="bu">int</span>, <span class="co"># The length of the gap</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    total_length: <span class="bu">int</span>, <span class="co"># The total number of observations</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    gap_start: <span class="bu">int</span> <span class="co"># Optional start of gap</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span> np.ndarray: <span class="co"># [total_length] array of bools to indicicate if the data is missing or not</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Add a continous gap of given length at random position"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(gap_length <span class="op">&gt;=</span> total_length):</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.repeat(<span class="va">True</span>, total_length)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.hstack([</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        np.repeat(<span class="va">False</span>, gap_start),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        np.repeat(<span class="va">True</span>, gap_length),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        np.repeat(<span class="va">False</span>, total_length <span class="op">-</span> (gap_length <span class="op">+</span> gap_start))</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>gap <span class="op">=</span> _make_random_gap(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>gap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([False, False,  True,  True, False, False, False, False, False,
       False])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>np.argwhere(gap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[2],
       [3]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mask[np.argwhere(gap), idx] <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ True,  True,  True],
       [ True,  True,  True],
       [False, False,  True],
       [False, False,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>mask[gap]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[False, False,  True],
       [False, False,  True]])</code></pre>
</div>
</div>
</section>
<section id="gap-len-generator" class="level4">
<h4 class="anchored" data-anchor-id="gap-len-generator">Gap Len Generator</h4>
<p>The gap lengths are drawn from a gamma distribution, so we have a long tail and a min value of 0, but compared to an exponentail distributions we don’t have many gaps of len 0</p>
<p><span class="math display">\[ p(x)=\frac{1}{\Gamma(k) \theta^k} x^{k - 1} e^{-\frac{x}{\theta}}\]</span></p>
<p><span class="math display">\[\begin{align}\mu &amp;= k\theta\\
m &amp;= (k-1)\theta \end{align}\]</span> where <span class="math inline">\(m\)</span> is the mode and <span class="math inline">\(\mu\)</span> is the mean (for <span class="math inline">\(k&gt;1\)</span>), which is what we want</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.special <span class="im">as</span> sps  </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>scale <span class="op">=</span> mean <span class="op">*</span> <span class="fl">.6</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>shape <span class="op">=</span> mean<span class="op">/</span>scale</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>mode <span class="op">=</span> (shape<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>scale</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x<span class="op">**</span>(shape<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>(np.exp(<span class="op">-</span>x<span class="op">/</span>scale) <span class="op">/</span> (sps.gamma(shape)<span class="op">*</span>scale<span class="op">**</span>shape))</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y)  </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="10_fastai_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This is a very guessestimate of a good probability density distribution of the gap len. The actual measure should come from the fluxnet data</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L128" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="gen_gap_len" class="level3">
<h3 class="anchored" data-anchor-id="gen_gap_len">gen_gap_len</h3>
<blockquote class="blockquote">
<pre><code> gen_gap_len (mean:float, min_v=1)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">next</span>(gen_gap_len(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>g_len <span class="op">=</span> gen_gap_len(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>gap_lens_sample <span class="op">=</span> pd.DataFrame([<span class="bu">next</span>(g_len) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>)])</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>gap_lens_sample.hist(bins<span class="op">=</span>gap_lens_sample[<span class="dv">0</span>].<span class="bu">max</span>()<span class="op">//</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[&lt;AxesSubplot: title={'center': '0'}&gt;]], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="10_fastai_files/figure-html/cell-36-output-2.png" class="img-fluid"></p>
</div>
</div>
<section id="var-sel-generator" class="level4">
<h4 class="anchored" data-anchor-id="var-sel-generator">Var Sel Generator</h4>
<p>draws a number of variables from a uniform distribution from 1 to the max n of vars and then select the variables with equal probability</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L135" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="gen_var_sel" class="level3">
<h3 class="anchored" data-anchor-id="gen_var_sel">gen_var_sel</h3>
<blockquote class="blockquote">
<pre><code> gen_var_sel (vars)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>g_var <span class="op">=</span> gen_var_sel(<span class="bu">list</span>(<span class="st">"abcdefg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>[<span class="bu">next</span>(g_var) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[array(['e', 'a', 'c', 'f', 'd', 'g', 'b'], dtype='&lt;U1'),
 array(['b', 'g', 'e', 'f', 'c'], dtype='&lt;U1'),
 array(['e', 'a', 'b', 'g', 'c', 'd'], dtype='&lt;U1'),
 array(['a'], dtype='&lt;U1'),
 array(['e', 'd', 'c', 'g', 'b', 'f', 'a'], dtype='&lt;U1')]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>g_var <span class="op">=</span> gen_var_sel([<span class="st">"a"</span>, <span class="st">"bb"</span>, <span class="st">"ccc"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>[<span class="bu">next</span>(g_var) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[array(['ccc', 'a'], dtype='&lt;U3'),
 array(['bb', 'ccc'], dtype='&lt;U3'),
 array(['bb', 'ccc'], dtype='&lt;U3'),
 array(['a', 'bb', 'ccc'], dtype='&lt;U3'),
 array(['a', 'bb', 'ccc'], dtype='&lt;U3')]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>g_var <span class="op">=</span> gen_var_sel([<span class="st">'TA'</span>, <span class="st">'VPD'</span>, <span class="st">'SW_IN'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>[<span class="bu">next</span>(g_var) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[array(['TA', 'VPD', 'SW_IN'], dtype='&lt;U5'),
 array(['VPD', 'SW_IN'], dtype='&lt;U5'),
 array(['TA'], dtype='&lt;U5'),
 array(['SW_IN', 'VPD', 'TA'], dtype='&lt;U5'),
 array(['SW_IN', 'VPD', 'TA'], dtype='&lt;U5'),
 array(['TA', 'VPD'], dtype='&lt;U5'),
 array(['VPD'], dtype='&lt;U5'),
 array(['TA'], dtype='&lt;U5'),
 array(['TA', 'SW_IN'], dtype='&lt;U5'),
 array(['TA', 'VPD', 'SW_IN'], dtype='&lt;U5')]</code></pre>
</div>
</div>
<section id="add-gap-transform" class="level4">
<h4 class="anchored" data-anchor-id="add-gap-transform">Add Gap Transform</h4>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L144" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="as_generator" class="level3">
<h3 class="anchored" data-anchor-id="as_generator">as_generator</h3>
<blockquote class="blockquote">
<pre><code> as_generator (x:collections.abc.Generator|object)</code></pre>
</blockquote>
<p>Maybe convert iterable to generator</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="bu">isinstance</span>(g_var, Iterable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>as_generator(g_var), <span class="bu">next</span>(as_generator(g_var))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(&lt;generator object gen_var_sel&gt;,
 array(['SW_IN', 'VPD'], dtype='&lt;U5'))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>as_generator([<span class="dv">1</span>,<span class="dv">2</span>]), <span class="bu">next</span>(as_generator([<span class="dv">1</span>,<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(&lt;itertools.cycle&gt;, [1, 2])</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L150" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="meteoimpdf" class="level3">
<h3 class="anchored" data-anchor-id="meteoimpdf">MeteoImpDf</h3>
<blockquote class="blockquote">
<pre><code> MeteoImpDf (*args)</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L161" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="addgaptransform" class="level3">
<h3 class="anchored" data-anchor-id="addgaptransform">AddGapTransform</h3>
<blockquote class="blockquote">
<pre><code> AddGapTransform (variables, gap_length, gap_start)</code></pre>
</blockquote>
<p>Adds a random gap to a dataframe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>a_gap <span class="op">=</span> AddGapTransform([<span class="st">'TA'</span>, <span class="st">'VPD'</span>], <span class="dv">5</span>, <span class="dv">1</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>a_gap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
  <p>
    <strong>AddGapTransform</strong>
  </p>
  <p>(DataControl,object) -&gt; encodes
</p>
  <p></p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>[a_gap._yield_gens().variables <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)], [a_gap._yield_gens().gap_length <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>([['TA', 'VPD'], ['TA', 'VPD'], ['TA', 'VPD'], ['TA', 'VPD'], ['TA', 'VPD']],
 [5, 5, 5, 5, 5])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>g_var <span class="op">=</span> gen_var_sel([<span class="st">'TA'</span>, <span class="st">'VPD'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>a_gap2 <span class="op">=</span> AddGapTransform(g_var, gen_gap_len(<span class="dv">5</span>), <span class="dv">1</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>a_gap2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
  <p>
    <strong>AddGapTransform</strong>
  </p>
  <p>(DataControl,object) -&gt; encodes
</p>
  <p></p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>[a_gap2._yield_gens().variables <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)], [a_gap2._yield_gens().gap_length <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>([array(['VPD'], dtype='&lt;U3'),
  array(['VPD', 'TA'], dtype='&lt;U3'),
  array(['TA', 'VPD'], dtype='&lt;U3'),
  array(['TA', 'VPD'], dtype='&lt;U3'),
  array(['VPD'], dtype='&lt;U3')],
 [4, 2, 3, 2, 4])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>a_gap(tfms1[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table id="T_d8c46" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_d8c46_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_d8c46_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_d8c46_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_d8c46_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_d8c46_row0_col0" class="data row0 col0">14.2200</td>
<td id="T_d8c46_row0_col1" class="data row0 col1">224.8000</td>
<td id="T_d8c46_row0_col2" class="data row0 col2">5.7990</td>
</tr>
<tr class="even">
<th id="T_d8c46_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_d8c46_row1_col0" class="data row1 col0">14.1100</td>
<td id="T_d8c46_row1_col1" class="data row1 col1">195.2800</td>
<td id="T_d8c46_row1_col2" class="data row1 col2">6.5770</td>
</tr>
<tr class="odd">
<th id="T_d8c46_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_d8c46_row2_col0" class="data row2 col0">14.2300</td>
<td id="T_d8c46_row2_col1" class="data row2 col1">244.1700</td>
<td id="T_d8c46_row2_col2" class="data row2 col2">6.9310</td>
</tr>
<tr class="even">
<th id="T_d8c46_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_d8c46_row3_col0" class="data row3 col0">14.4000</td>
<td id="T_d8c46_row3_col1" class="data row3 col1">253.9200</td>
<td id="T_d8c46_row3_col2" class="data row3 col2">7.2860</td>
</tr>
<tr class="odd">
<th id="T_d8c46_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_d8c46_row4_col0" class="data row4 col0">14.0900</td>
<td id="T_d8c46_row4_col1" class="data row4 col1">177.3100</td>
<td id="T_d8c46_row4_col2" class="data row4 col2">7.2510</td>
</tr>
<tr class="even">
<th id="T_d8c46_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_d8c46_row5_col0" class="data row5 col0">13.7100</td>
<td id="T_d8c46_row5_col1" class="data row5 col1">97.0700</td>
<td id="T_d8c46_row5_col2" class="data row5 col2">6.6830</td>
</tr>
<tr class="odd">
<th id="T_d8c46_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_d8c46_row6_col0" class="data row6 col0">13.0800</td>
<td id="T_d8c46_row6_col1" class="data row6 col1">39.7100</td>
<td id="T_d8c46_row6_col2" class="data row6 col2">5.8510</td>
</tr>
<tr class="even">
<th id="T_d8c46_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_d8c46_row7_col0" class="data row7 col0">12.4100</td>
<td id="T_d8c46_row7_col1" class="data row7 col1">10.6500</td>
<td id="T_d8c46_row7_col2" class="data row7 col2">5.2540</td>
</tr>
<tr class="odd">
<th id="T_d8c46_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_d8c46_row8_col0" class="data row8 col0">12.2700</td>
<td id="T_d8c46_row8_col1" class="data row8 col1">0.3200</td>
<td id="T_d8c46_row8_col2" class="data row8 col2">5.1640</td>
</tr>
<tr class="even">
<th id="T_d8c46_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_d8c46_row9_col0" class="data row9 col0">12.2000</td>
<td id="T_d8c46_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_d8c46_row9_col2" class="data row9 col2">5.0370</td>
</tr>
</tbody>
</table>
<div>
<p>mask</p>
<table id="T_3a33a" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_3a33a_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_3a33a_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_3a33a_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_3a33a_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_3a33a_row0_col0" class="data row0 col0">True</td>
<td id="T_3a33a_row0_col1" class="data row0 col1">True</td>
<td id="T_3a33a_row0_col2" class="data row0 col2">True</td>
</tr>
<tr class="even">
<th id="T_3a33a_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_3a33a_row1_col0" class="data row1 col0">False</td>
<td id="T_3a33a_row1_col1" class="data row1 col1">True</td>
<td id="T_3a33a_row1_col2" class="data row1 col2">False</td>
</tr>
<tr class="odd">
<th id="T_3a33a_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_3a33a_row2_col0" class="data row2 col0">False</td>
<td id="T_3a33a_row2_col1" class="data row2 col1">True</td>
<td id="T_3a33a_row2_col2" class="data row2 col2">False</td>
</tr>
<tr class="even">
<th id="T_3a33a_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_3a33a_row3_col0" class="data row3 col0">False</td>
<td id="T_3a33a_row3_col1" class="data row3 col1">True</td>
<td id="T_3a33a_row3_col2" class="data row3 col2">False</td>
</tr>
<tr class="odd">
<th id="T_3a33a_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_3a33a_row4_col0" class="data row4 col0">False</td>
<td id="T_3a33a_row4_col1" class="data row4 col1">True</td>
<td id="T_3a33a_row4_col2" class="data row4 col2">False</td>
</tr>
<tr class="even">
<th id="T_3a33a_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_3a33a_row5_col0" class="data row5 col0">False</td>
<td id="T_3a33a_row5_col1" class="data row5 col1">True</td>
<td id="T_3a33a_row5_col2" class="data row5 col2">False</td>
</tr>
<tr class="odd">
<th id="T_3a33a_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_3a33a_row6_col0" class="data row6 col0">True</td>
<td id="T_3a33a_row6_col1" class="data row6 col1">True</td>
<td id="T_3a33a_row6_col2" class="data row6 col2">True</td>
</tr>
<tr class="even">
<th id="T_3a33a_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_3a33a_row7_col0" class="data row7 col0">True</td>
<td id="T_3a33a_row7_col1" class="data row7 col1">True</td>
<td id="T_3a33a_row7_col2" class="data row7 col2">True</td>
</tr>
<tr class="odd">
<th id="T_3a33a_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_3a33a_row8_col0" class="data row8 col0">True</td>
<td id="T_3a33a_row8_col1" class="data row8 col1">True</td>
<td id="T_3a33a_row8_col2" class="data row8 col2">True</td>
</tr>
<tr class="even">
<th id="T_3a33a_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_3a33a_row9_col0" class="data row9 col0">True</td>
<td id="T_3a33a_row9_col1" class="data row9 col1">True</td>
<td id="T_3a33a_row9_col2" class="data row9 col2">True</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>control</p>
<table id="T_347a5" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_347a5_level0_col0" class="col_heading level0 col0">TA_ERA</th>
<th id="T_347a5_level0_col1" class="col_heading level0 col1">SW_IN_ERA</th>
<th id="T_347a5_level0_col2" class="col_heading level0 col2">VPD_ERA</th>
<th id="T_347a5_level0_col3" class="col_heading level0 col3">TA_ERA_lag_1</th>
<th id="T_347a5_level0_col4" class="col_heading level0 col4">SW_IN_ERA_lag_1</th>
<th id="T_347a5_level0_col5" class="col_heading level0 col5">VPD_ERA_lag_1</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
<th class="blank col3">&nbsp;</th>
<th class="blank col4">&nbsp;</th>
<th class="blank col5">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_347a5_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_347a5_row0_col0" class="data row0 col0">15.0500</td>
<td id="T_347a5_row0_col1" class="data row0 col1">255.1930</td>
<td id="T_347a5_row0_col2" class="data row0 col2">5.1020</td>
<td id="T_347a5_row0_col3" class="data row0 col3">15.1390</td>
<td id="T_347a5_row0_col4" class="data row0 col4">287.1000</td>
<td id="T_347a5_row0_col5" class="data row0 col5">4.9000</td>
</tr>
<tr class="even">
<th id="T_347a5_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_347a5_row1_col0" class="data row1 col0">14.9610</td>
<td id="T_347a5_row1_col1" class="data row1 col1">221.4270</td>
<td id="T_347a5_row1_col2" class="data row1 col2">5.3050</td>
<td id="T_347a5_row1_col3" class="data row1 col3">15.0500</td>
<td id="T_347a5_row1_col4" class="data row1 col4">255.1930</td>
<td id="T_347a5_row1_col5" class="data row1 col5">5.1020</td>
</tr>
<tr class="odd">
<th id="T_347a5_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_347a5_row2_col0" class="data row2 col0">14.8720</td>
<td id="T_347a5_row2_col1" class="data row2 col1">186.3800</td>
<td id="T_347a5_row2_col2" class="data row2 col2">5.5070</td>
<td id="T_347a5_row2_col3" class="data row2 col3">14.9610</td>
<td id="T_347a5_row2_col4" class="data row2 col4">221.4270</td>
<td id="T_347a5_row2_col5" class="data row2 col5">5.3050</td>
</tr>
<tr class="even">
<th id="T_347a5_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_347a5_row3_col0" class="data row3 col0">14.7830</td>
<td id="T_347a5_row3_col1" class="data row3 col1">150.6500</td>
<td id="T_347a5_row3_col2" class="data row3 col2">5.7100</td>
<td id="T_347a5_row3_col3" class="data row3 col3">14.8720</td>
<td id="T_347a5_row3_col4" class="data row3 col4">186.3800</td>
<td id="T_347a5_row3_col5" class="data row3 col5">5.5070</td>
</tr>
<tr class="odd">
<th id="T_347a5_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_347a5_row4_col0" class="data row4 col0">14.6940</td>
<td id="T_347a5_row4_col1" class="data row4 col1">114.8490</td>
<td id="T_347a5_row4_col2" class="data row4 col2">5.9120</td>
<td id="T_347a5_row4_col3" class="data row4 col3">14.7830</td>
<td id="T_347a5_row4_col4" class="data row4 col4">150.6500</td>
<td id="T_347a5_row4_col5" class="data row4 col5">5.7100</td>
</tr>
<tr class="even">
<th id="T_347a5_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_347a5_row5_col0" class="data row5 col0">14.6060</td>
<td id="T_347a5_row5_col1" class="data row5 col1">34.7280</td>
<td id="T_347a5_row5_col2" class="data row5 col2">6.1140</td>
<td id="T_347a5_row5_col3" class="data row5 col3">14.6940</td>
<td id="T_347a5_row5_col4" class="data row5 col4">114.8490</td>
<td id="T_347a5_row5_col5" class="data row5 col5">5.9120</td>
</tr>
<tr class="odd">
<th id="T_347a5_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_347a5_row6_col0" class="data row6 col0">14.3800</td>
<td id="T_347a5_row6_col1" class="data row6 col1">19.8430</td>
<td id="T_347a5_row6_col2" class="data row6 col2">6.0740</td>
<td id="T_347a5_row6_col3" class="data row6 col3">14.6060</td>
<td id="T_347a5_row6_col4" class="data row6 col4">34.7280</td>
<td id="T_347a5_row6_col5" class="data row6 col5">6.1140</td>
</tr>
<tr class="even">
<th id="T_347a5_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_347a5_row7_col0" class="data row7 col0">14.1550</td>
<td id="T_347a5_row7_col1" class="data row7 col1">5.7120</td>
<td id="T_347a5_row7_col2" class="data row7 col2">6.0340</td>
<td id="T_347a5_row7_col3" class="data row7 col3">14.3800</td>
<td id="T_347a5_row7_col4" class="data row7 col4">19.8430</td>
<td id="T_347a5_row7_col5" class="data row7 col5">6.0740</td>
</tr>
<tr class="odd">
<th id="T_347a5_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_347a5_row8_col0" class="data row8 col0">13.9290</td>
<td id="T_347a5_row8_col1" class="data row8 col1">0.0000</td>
<td id="T_347a5_row8_col2" class="data row8 col2">5.9940</td>
<td id="T_347a5_row8_col3" class="data row8 col3">14.1550</td>
<td id="T_347a5_row8_col4" class="data row8 col4">5.7120</td>
<td id="T_347a5_row8_col5" class="data row8 col5">6.0340</td>
</tr>
<tr class="even">
<th id="T_347a5_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_347a5_row9_col0" class="data row9 col0">13.7040</td>
<td id="T_347a5_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_347a5_row9_col2" class="data row9 col2">5.9540</td>
<td id="T_347a5_row9_col3" class="data row9 col3">13.9290</td>
<td id="T_347a5_row9_col4" class="data row9 col4">0.0000</td>
<td id="T_347a5_row9_col5" class="data row9 col5">5.9940</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>a_gap2(tfms1[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table id="T_79757" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_79757_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_79757_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_79757_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_79757_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_79757_row0_col0" class="data row0 col0">14.2200</td>
<td id="T_79757_row0_col1" class="data row0 col1">224.8000</td>
<td id="T_79757_row0_col2" class="data row0 col2">5.7990</td>
</tr>
<tr class="even">
<th id="T_79757_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_79757_row1_col0" class="data row1 col0">14.1100</td>
<td id="T_79757_row1_col1" class="data row1 col1">195.2800</td>
<td id="T_79757_row1_col2" class="data row1 col2">6.5770</td>
</tr>
<tr class="odd">
<th id="T_79757_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_79757_row2_col0" class="data row2 col0">14.2300</td>
<td id="T_79757_row2_col1" class="data row2 col1">244.1700</td>
<td id="T_79757_row2_col2" class="data row2 col2">6.9310</td>
</tr>
<tr class="even">
<th id="T_79757_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_79757_row3_col0" class="data row3 col0">14.4000</td>
<td id="T_79757_row3_col1" class="data row3 col1">253.9200</td>
<td id="T_79757_row3_col2" class="data row3 col2">7.2860</td>
</tr>
<tr class="odd">
<th id="T_79757_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_79757_row4_col0" class="data row4 col0">14.0900</td>
<td id="T_79757_row4_col1" class="data row4 col1">177.3100</td>
<td id="T_79757_row4_col2" class="data row4 col2">7.2510</td>
</tr>
<tr class="even">
<th id="T_79757_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_79757_row5_col0" class="data row5 col0">13.7100</td>
<td id="T_79757_row5_col1" class="data row5 col1">97.0700</td>
<td id="T_79757_row5_col2" class="data row5 col2">6.6830</td>
</tr>
<tr class="odd">
<th id="T_79757_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_79757_row6_col0" class="data row6 col0">13.0800</td>
<td id="T_79757_row6_col1" class="data row6 col1">39.7100</td>
<td id="T_79757_row6_col2" class="data row6 col2">5.8510</td>
</tr>
<tr class="even">
<th id="T_79757_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_79757_row7_col0" class="data row7 col0">12.4100</td>
<td id="T_79757_row7_col1" class="data row7 col1">10.6500</td>
<td id="T_79757_row7_col2" class="data row7 col2">5.2540</td>
</tr>
<tr class="odd">
<th id="T_79757_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_79757_row8_col0" class="data row8 col0">12.2700</td>
<td id="T_79757_row8_col1" class="data row8 col1">0.3200</td>
<td id="T_79757_row8_col2" class="data row8 col2">5.1640</td>
</tr>
<tr class="even">
<th id="T_79757_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_79757_row9_col0" class="data row9 col0">12.2000</td>
<td id="T_79757_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_79757_row9_col2" class="data row9 col2">5.0370</td>
</tr>
</tbody>
</table>
<div>
<p>mask</p>
<table id="T_54916" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_54916_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_54916_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_54916_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_54916_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_54916_row0_col0" class="data row0 col0">True</td>
<td id="T_54916_row0_col1" class="data row0 col1">True</td>
<td id="T_54916_row0_col2" class="data row0 col2">True</td>
</tr>
<tr class="even">
<th id="T_54916_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_54916_row1_col0" class="data row1 col0">False</td>
<td id="T_54916_row1_col1" class="data row1 col1">True</td>
<td id="T_54916_row1_col2" class="data row1 col2">False</td>
</tr>
<tr class="odd">
<th id="T_54916_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_54916_row2_col0" class="data row2 col0">False</td>
<td id="T_54916_row2_col1" class="data row2 col1">True</td>
<td id="T_54916_row2_col2" class="data row2 col2">False</td>
</tr>
<tr class="even">
<th id="T_54916_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_54916_row3_col0" class="data row3 col0">False</td>
<td id="T_54916_row3_col1" class="data row3 col1">True</td>
<td id="T_54916_row3_col2" class="data row3 col2">False</td>
</tr>
<tr class="odd">
<th id="T_54916_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_54916_row4_col0" class="data row4 col0">True</td>
<td id="T_54916_row4_col1" class="data row4 col1">True</td>
<td id="T_54916_row4_col2" class="data row4 col2">True</td>
</tr>
<tr class="even">
<th id="T_54916_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_54916_row5_col0" class="data row5 col0">True</td>
<td id="T_54916_row5_col1" class="data row5 col1">True</td>
<td id="T_54916_row5_col2" class="data row5 col2">True</td>
</tr>
<tr class="odd">
<th id="T_54916_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_54916_row6_col0" class="data row6 col0">True</td>
<td id="T_54916_row6_col1" class="data row6 col1">True</td>
<td id="T_54916_row6_col2" class="data row6 col2">True</td>
</tr>
<tr class="even">
<th id="T_54916_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_54916_row7_col0" class="data row7 col0">True</td>
<td id="T_54916_row7_col1" class="data row7 col1">True</td>
<td id="T_54916_row7_col2" class="data row7 col2">True</td>
</tr>
<tr class="odd">
<th id="T_54916_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_54916_row8_col0" class="data row8 col0">True</td>
<td id="T_54916_row8_col1" class="data row8 col1">True</td>
<td id="T_54916_row8_col2" class="data row8 col2">True</td>
</tr>
<tr class="even">
<th id="T_54916_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_54916_row9_col0" class="data row9 col0">True</td>
<td id="T_54916_row9_col1" class="data row9 col1">True</td>
<td id="T_54916_row9_col2" class="data row9 col2">True</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>control</p>
<table id="T_03405" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_03405_level0_col0" class="col_heading level0 col0">TA_ERA</th>
<th id="T_03405_level0_col1" class="col_heading level0 col1">SW_IN_ERA</th>
<th id="T_03405_level0_col2" class="col_heading level0 col2">VPD_ERA</th>
<th id="T_03405_level0_col3" class="col_heading level0 col3">TA_ERA_lag_1</th>
<th id="T_03405_level0_col4" class="col_heading level0 col4">SW_IN_ERA_lag_1</th>
<th id="T_03405_level0_col5" class="col_heading level0 col5">VPD_ERA_lag_1</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
<th class="blank col3">&nbsp;</th>
<th class="blank col4">&nbsp;</th>
<th class="blank col5">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_03405_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_03405_row0_col0" class="data row0 col0">15.0500</td>
<td id="T_03405_row0_col1" class="data row0 col1">255.1930</td>
<td id="T_03405_row0_col2" class="data row0 col2">5.1020</td>
<td id="T_03405_row0_col3" class="data row0 col3">15.1390</td>
<td id="T_03405_row0_col4" class="data row0 col4">287.1000</td>
<td id="T_03405_row0_col5" class="data row0 col5">4.9000</td>
</tr>
<tr class="even">
<th id="T_03405_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_03405_row1_col0" class="data row1 col0">14.9610</td>
<td id="T_03405_row1_col1" class="data row1 col1">221.4270</td>
<td id="T_03405_row1_col2" class="data row1 col2">5.3050</td>
<td id="T_03405_row1_col3" class="data row1 col3">15.0500</td>
<td id="T_03405_row1_col4" class="data row1 col4">255.1930</td>
<td id="T_03405_row1_col5" class="data row1 col5">5.1020</td>
</tr>
<tr class="odd">
<th id="T_03405_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_03405_row2_col0" class="data row2 col0">14.8720</td>
<td id="T_03405_row2_col1" class="data row2 col1">186.3800</td>
<td id="T_03405_row2_col2" class="data row2 col2">5.5070</td>
<td id="T_03405_row2_col3" class="data row2 col3">14.9610</td>
<td id="T_03405_row2_col4" class="data row2 col4">221.4270</td>
<td id="T_03405_row2_col5" class="data row2 col5">5.3050</td>
</tr>
<tr class="even">
<th id="T_03405_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_03405_row3_col0" class="data row3 col0">14.7830</td>
<td id="T_03405_row3_col1" class="data row3 col1">150.6500</td>
<td id="T_03405_row3_col2" class="data row3 col2">5.7100</td>
<td id="T_03405_row3_col3" class="data row3 col3">14.8720</td>
<td id="T_03405_row3_col4" class="data row3 col4">186.3800</td>
<td id="T_03405_row3_col5" class="data row3 col5">5.5070</td>
</tr>
<tr class="odd">
<th id="T_03405_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_03405_row4_col0" class="data row4 col0">14.6940</td>
<td id="T_03405_row4_col1" class="data row4 col1">114.8490</td>
<td id="T_03405_row4_col2" class="data row4 col2">5.9120</td>
<td id="T_03405_row4_col3" class="data row4 col3">14.7830</td>
<td id="T_03405_row4_col4" class="data row4 col4">150.6500</td>
<td id="T_03405_row4_col5" class="data row4 col5">5.7100</td>
</tr>
<tr class="even">
<th id="T_03405_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_03405_row5_col0" class="data row5 col0">14.6060</td>
<td id="T_03405_row5_col1" class="data row5 col1">34.7280</td>
<td id="T_03405_row5_col2" class="data row5 col2">6.1140</td>
<td id="T_03405_row5_col3" class="data row5 col3">14.6940</td>
<td id="T_03405_row5_col4" class="data row5 col4">114.8490</td>
<td id="T_03405_row5_col5" class="data row5 col5">5.9120</td>
</tr>
<tr class="odd">
<th id="T_03405_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_03405_row6_col0" class="data row6 col0">14.3800</td>
<td id="T_03405_row6_col1" class="data row6 col1">19.8430</td>
<td id="T_03405_row6_col2" class="data row6 col2">6.0740</td>
<td id="T_03405_row6_col3" class="data row6 col3">14.6060</td>
<td id="T_03405_row6_col4" class="data row6 col4">34.7280</td>
<td id="T_03405_row6_col5" class="data row6 col5">6.1140</td>
</tr>
<tr class="even">
<th id="T_03405_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_03405_row7_col0" class="data row7 col0">14.1550</td>
<td id="T_03405_row7_col1" class="data row7 col1">5.7120</td>
<td id="T_03405_row7_col2" class="data row7 col2">6.0340</td>
<td id="T_03405_row7_col3" class="data row7 col3">14.3800</td>
<td id="T_03405_row7_col4" class="data row7 col4">19.8430</td>
<td id="T_03405_row7_col5" class="data row7 col5">6.0740</td>
</tr>
<tr class="odd">
<th id="T_03405_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_03405_row8_col0" class="data row8 col0">13.9290</td>
<td id="T_03405_row8_col1" class="data row8 col1">0.0000</td>
<td id="T_03405_row8_col2" class="data row8 col2">5.9940</td>
<td id="T_03405_row8_col3" class="data row8 col3">14.1550</td>
<td id="T_03405_row8_col4" class="data row8 col4">5.7120</td>
<td id="T_03405_row8_col5" class="data row8 col5">6.0340</td>
</tr>
<tr class="even">
<th id="T_03405_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_03405_row9_col0" class="data row9 col0">13.7040</td>
<td id="T_03405_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_03405_row9_col2" class="data row9 col2">5.9540</td>
<td id="T_03405_row9_col3" class="data row9 col3">13.9290</td>
<td id="T_03405_row9_col4" class="data row9 col4">0.0000</td>
<td id="T_03405_row9_col5" class="data row9 col5">5.9940</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">800</span>):</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="kw">not</span> a_gap2(blkdf(blk([i, <span class="dv">0</span>]))).mask.to_numpy().<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>a_gap2(blkdf(blk([i, <span class="dv">0</span>]))).mask.to_numpy().<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>a_gap2(tfms1[<span class="dv">3</span>]).mask.to_numpy().<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>799</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>tfms2 <span class="op">=</span> TfmdLists(tfms1.items, [<span class="op">*</span>tfms1.fs, AddGapTransform([<span class="st">'TA'</span>,<span class="st">'SW_IN'</span>], <span class="dv">2</span>, <span class="dv">2</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>tfms2[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table id="T_395de" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_395de_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_395de_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_395de_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_395de_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_395de_row0_col0" class="data row0 col0">14.2200</td>
<td id="T_395de_row0_col1" class="data row0 col1">224.8000</td>
<td id="T_395de_row0_col2" class="data row0 col2">5.7990</td>
</tr>
<tr class="even">
<th id="T_395de_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_395de_row1_col0" class="data row1 col0">14.1100</td>
<td id="T_395de_row1_col1" class="data row1 col1">195.2800</td>
<td id="T_395de_row1_col2" class="data row1 col2">6.5770</td>
</tr>
<tr class="odd">
<th id="T_395de_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_395de_row2_col0" class="data row2 col0">14.2300</td>
<td id="T_395de_row2_col1" class="data row2 col1">244.1700</td>
<td id="T_395de_row2_col2" class="data row2 col2">6.9310</td>
</tr>
<tr class="even">
<th id="T_395de_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_395de_row3_col0" class="data row3 col0">14.4000</td>
<td id="T_395de_row3_col1" class="data row3 col1">253.9200</td>
<td id="T_395de_row3_col2" class="data row3 col2">7.2860</td>
</tr>
<tr class="odd">
<th id="T_395de_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_395de_row4_col0" class="data row4 col0">14.0900</td>
<td id="T_395de_row4_col1" class="data row4 col1">177.3100</td>
<td id="T_395de_row4_col2" class="data row4 col2">7.2510</td>
</tr>
<tr class="even">
<th id="T_395de_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_395de_row5_col0" class="data row5 col0">13.7100</td>
<td id="T_395de_row5_col1" class="data row5 col1">97.0700</td>
<td id="T_395de_row5_col2" class="data row5 col2">6.6830</td>
</tr>
<tr class="odd">
<th id="T_395de_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_395de_row6_col0" class="data row6 col0">13.0800</td>
<td id="T_395de_row6_col1" class="data row6 col1">39.7100</td>
<td id="T_395de_row6_col2" class="data row6 col2">5.8510</td>
</tr>
<tr class="even">
<th id="T_395de_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_395de_row7_col0" class="data row7 col0">12.4100</td>
<td id="T_395de_row7_col1" class="data row7 col1">10.6500</td>
<td id="T_395de_row7_col2" class="data row7 col2">5.2540</td>
</tr>
<tr class="odd">
<th id="T_395de_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_395de_row8_col0" class="data row8 col0">12.2700</td>
<td id="T_395de_row8_col1" class="data row8 col1">0.3200</td>
<td id="T_395de_row8_col2" class="data row8 col2">5.1640</td>
</tr>
<tr class="even">
<th id="T_395de_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_395de_row9_col0" class="data row9 col0">12.2000</td>
<td id="T_395de_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_395de_row9_col2" class="data row9 col2">5.0370</td>
</tr>
</tbody>
</table>
<div>
<p>mask</p>
<table id="T_b1260" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_b1260_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_b1260_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_b1260_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_b1260_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_b1260_row0_col0" class="data row0 col0">True</td>
<td id="T_b1260_row0_col1" class="data row0 col1">True</td>
<td id="T_b1260_row0_col2" class="data row0 col2">True</td>
</tr>
<tr class="even">
<th id="T_b1260_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_b1260_row1_col0" class="data row1 col0">True</td>
<td id="T_b1260_row1_col1" class="data row1 col1">True</td>
<td id="T_b1260_row1_col2" class="data row1 col2">True</td>
</tr>
<tr class="odd">
<th id="T_b1260_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_b1260_row2_col0" class="data row2 col0">False</td>
<td id="T_b1260_row2_col1" class="data row2 col1">False</td>
<td id="T_b1260_row2_col2" class="data row2 col2">True</td>
</tr>
<tr class="even">
<th id="T_b1260_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_b1260_row3_col0" class="data row3 col0">False</td>
<td id="T_b1260_row3_col1" class="data row3 col1">False</td>
<td id="T_b1260_row3_col2" class="data row3 col2">True</td>
</tr>
<tr class="odd">
<th id="T_b1260_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_b1260_row4_col0" class="data row4 col0">True</td>
<td id="T_b1260_row4_col1" class="data row4 col1">True</td>
<td id="T_b1260_row4_col2" class="data row4 col2">True</td>
</tr>
<tr class="even">
<th id="T_b1260_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_b1260_row5_col0" class="data row5 col0">True</td>
<td id="T_b1260_row5_col1" class="data row5 col1">True</td>
<td id="T_b1260_row5_col2" class="data row5 col2">True</td>
</tr>
<tr class="odd">
<th id="T_b1260_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_b1260_row6_col0" class="data row6 col0">True</td>
<td id="T_b1260_row6_col1" class="data row6 col1">True</td>
<td id="T_b1260_row6_col2" class="data row6 col2">True</td>
</tr>
<tr class="even">
<th id="T_b1260_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_b1260_row7_col0" class="data row7 col0">True</td>
<td id="T_b1260_row7_col1" class="data row7 col1">True</td>
<td id="T_b1260_row7_col2" class="data row7 col2">True</td>
</tr>
<tr class="odd">
<th id="T_b1260_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_b1260_row8_col0" class="data row8 col0">True</td>
<td id="T_b1260_row8_col1" class="data row8 col1">True</td>
<td id="T_b1260_row8_col2" class="data row8 col2">True</td>
</tr>
<tr class="even">
<th id="T_b1260_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_b1260_row9_col0" class="data row9 col0">True</td>
<td id="T_b1260_row9_col1" class="data row9 col1">True</td>
<td id="T_b1260_row9_col2" class="data row9 col2">True</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>control</p>
<table id="T_ff663" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_ff663_level0_col0" class="col_heading level0 col0">TA_ERA</th>
<th id="T_ff663_level0_col1" class="col_heading level0 col1">SW_IN_ERA</th>
<th id="T_ff663_level0_col2" class="col_heading level0 col2">VPD_ERA</th>
<th id="T_ff663_level0_col3" class="col_heading level0 col3">TA_ERA_lag_1</th>
<th id="T_ff663_level0_col4" class="col_heading level0 col4">SW_IN_ERA_lag_1</th>
<th id="T_ff663_level0_col5" class="col_heading level0 col5">VPD_ERA_lag_1</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
<th class="blank col3">&nbsp;</th>
<th class="blank col4">&nbsp;</th>
<th class="blank col5">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_ff663_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_ff663_row0_col0" class="data row0 col0">15.0500</td>
<td id="T_ff663_row0_col1" class="data row0 col1">255.1930</td>
<td id="T_ff663_row0_col2" class="data row0 col2">5.1020</td>
<td id="T_ff663_row0_col3" class="data row0 col3">15.1390</td>
<td id="T_ff663_row0_col4" class="data row0 col4">287.1000</td>
<td id="T_ff663_row0_col5" class="data row0 col5">4.9000</td>
</tr>
<tr class="even">
<th id="T_ff663_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_ff663_row1_col0" class="data row1 col0">14.9610</td>
<td id="T_ff663_row1_col1" class="data row1 col1">221.4270</td>
<td id="T_ff663_row1_col2" class="data row1 col2">5.3050</td>
<td id="T_ff663_row1_col3" class="data row1 col3">15.0500</td>
<td id="T_ff663_row1_col4" class="data row1 col4">255.1930</td>
<td id="T_ff663_row1_col5" class="data row1 col5">5.1020</td>
</tr>
<tr class="odd">
<th id="T_ff663_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_ff663_row2_col0" class="data row2 col0">14.8720</td>
<td id="T_ff663_row2_col1" class="data row2 col1">186.3800</td>
<td id="T_ff663_row2_col2" class="data row2 col2">5.5070</td>
<td id="T_ff663_row2_col3" class="data row2 col3">14.9610</td>
<td id="T_ff663_row2_col4" class="data row2 col4">221.4270</td>
<td id="T_ff663_row2_col5" class="data row2 col5">5.3050</td>
</tr>
<tr class="even">
<th id="T_ff663_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_ff663_row3_col0" class="data row3 col0">14.7830</td>
<td id="T_ff663_row3_col1" class="data row3 col1">150.6500</td>
<td id="T_ff663_row3_col2" class="data row3 col2">5.7100</td>
<td id="T_ff663_row3_col3" class="data row3 col3">14.8720</td>
<td id="T_ff663_row3_col4" class="data row3 col4">186.3800</td>
<td id="T_ff663_row3_col5" class="data row3 col5">5.5070</td>
</tr>
<tr class="odd">
<th id="T_ff663_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_ff663_row4_col0" class="data row4 col0">14.6940</td>
<td id="T_ff663_row4_col1" class="data row4 col1">114.8490</td>
<td id="T_ff663_row4_col2" class="data row4 col2">5.9120</td>
<td id="T_ff663_row4_col3" class="data row4 col3">14.7830</td>
<td id="T_ff663_row4_col4" class="data row4 col4">150.6500</td>
<td id="T_ff663_row4_col5" class="data row4 col5">5.7100</td>
</tr>
<tr class="even">
<th id="T_ff663_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_ff663_row5_col0" class="data row5 col0">14.6060</td>
<td id="T_ff663_row5_col1" class="data row5 col1">34.7280</td>
<td id="T_ff663_row5_col2" class="data row5 col2">6.1140</td>
<td id="T_ff663_row5_col3" class="data row5 col3">14.6940</td>
<td id="T_ff663_row5_col4" class="data row5 col4">114.8490</td>
<td id="T_ff663_row5_col5" class="data row5 col5">5.9120</td>
</tr>
<tr class="odd">
<th id="T_ff663_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_ff663_row6_col0" class="data row6 col0">14.3800</td>
<td id="T_ff663_row6_col1" class="data row6 col1">19.8430</td>
<td id="T_ff663_row6_col2" class="data row6 col2">6.0740</td>
<td id="T_ff663_row6_col3" class="data row6 col3">14.6060</td>
<td id="T_ff663_row6_col4" class="data row6 col4">34.7280</td>
<td id="T_ff663_row6_col5" class="data row6 col5">6.1140</td>
</tr>
<tr class="even">
<th id="T_ff663_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_ff663_row7_col0" class="data row7 col0">14.1550</td>
<td id="T_ff663_row7_col1" class="data row7 col1">5.7120</td>
<td id="T_ff663_row7_col2" class="data row7 col2">6.0340</td>
<td id="T_ff663_row7_col3" class="data row7 col3">14.3800</td>
<td id="T_ff663_row7_col4" class="data row7 col4">19.8430</td>
<td id="T_ff663_row7_col5" class="data row7 col5">6.0740</td>
</tr>
<tr class="odd">
<th id="T_ff663_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_ff663_row8_col0" class="data row8 col0">13.9290</td>
<td id="T_ff663_row8_col1" class="data row8 col1">0.0000</td>
<td id="T_ff663_row8_col2" class="data row8 col2">5.9940</td>
<td id="T_ff663_row8_col3" class="data row8 col3">14.1550</td>
<td id="T_ff663_row8_col4" class="data row8 col4">5.7120</td>
<td id="T_ff663_row8_col5" class="data row8 col5">6.0340</td>
</tr>
<tr class="even">
<th id="T_ff663_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_ff663_row9_col0" class="data row9 col0">13.7040</td>
<td id="T_ff663_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_ff663_row9_col2" class="data row9 col2">5.9540</td>
<td id="T_ff663_row9_col3" class="data row9 col3">13.9290</td>
<td id="T_ff663_row9_col4" class="data row9 col4">0.0000</td>
<td id="T_ff663_row9_col5" class="data row9 col5">5.9940</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>m_df <span class="op">=</span> tfms2[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="tidy" class="level5">
<h5 class="anchored" data-anchor-id="tidy">Tidy</h5>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L185" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="meteoimpdf.tidy" class="level3">
<h3 class="anchored" data-anchor-id="meteoimpdf.tidy">MeteoImpDf.tidy</h3>
<blockquote class="blockquote">
<pre><code> MeteoImpDf.tidy (control:Optional[dict[str,str]]=None)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>control</td>
<td>Optional</td>
<td>None</td>
<td>mapping from control var names to obs names</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>m_df.tidy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>time</th>
<th>variable</th>
<th>value</th>
<th>is_present</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>0</th>
<td>2000-06-15 17:00:00</td>
<td>TA</td>
<td>14.220000</td>
<td>True</td>
</tr>
<tr class="even">
<th>1</th>
<td>2000-06-15 17:30:00</td>
<td>TA</td>
<td>14.110000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>2</th>
<td>2000-06-15 18:00:00</td>
<td>TA</td>
<td>14.230000</td>
<td>False</td>
</tr>
<tr class="even">
<th>3</th>
<td>2000-06-15 18:30:00</td>
<td>TA</td>
<td>14.400000</td>
<td>False</td>
</tr>
<tr class="odd">
<th>4</th>
<td>2000-06-15 19:00:00</td>
<td>TA</td>
<td>14.090000</td>
<td>True</td>
</tr>
<tr class="even">
<th>5</th>
<td>2000-06-15 19:30:00</td>
<td>TA</td>
<td>13.710000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>6</th>
<td>2000-06-15 20:00:00</td>
<td>TA</td>
<td>13.080000</td>
<td>True</td>
</tr>
<tr class="even">
<th>7</th>
<td>2000-06-15 20:30:00</td>
<td>TA</td>
<td>12.410000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>8</th>
<td>2000-06-15 21:00:00</td>
<td>TA</td>
<td>12.270000</td>
<td>True</td>
</tr>
<tr class="even">
<th>9</th>
<td>2000-06-15 21:30:00</td>
<td>TA</td>
<td>12.200000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>10</th>
<td>2000-06-15 17:00:00</td>
<td>SW_IN</td>
<td>224.800003</td>
<td>True</td>
</tr>
<tr class="even">
<th>11</th>
<td>2000-06-15 17:30:00</td>
<td>SW_IN</td>
<td>195.279999</td>
<td>True</td>
</tr>
<tr class="odd">
<th>12</th>
<td>2000-06-15 18:00:00</td>
<td>SW_IN</td>
<td>244.169998</td>
<td>False</td>
</tr>
<tr class="even">
<th>13</th>
<td>2000-06-15 18:30:00</td>
<td>SW_IN</td>
<td>253.919998</td>
<td>False</td>
</tr>
<tr class="odd">
<th>14</th>
<td>2000-06-15 19:00:00</td>
<td>SW_IN</td>
<td>177.309998</td>
<td>True</td>
</tr>
<tr class="even">
<th>15</th>
<td>2000-06-15 19:30:00</td>
<td>SW_IN</td>
<td>97.070000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>16</th>
<td>2000-06-15 20:00:00</td>
<td>SW_IN</td>
<td>39.709999</td>
<td>True</td>
</tr>
<tr class="even">
<th>17</th>
<td>2000-06-15 20:30:00</td>
<td>SW_IN</td>
<td>10.650000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>18</th>
<td>2000-06-15 21:00:00</td>
<td>SW_IN</td>
<td>0.320000</td>
<td>True</td>
</tr>
<tr class="even">
<th>19</th>
<td>2000-06-15 21:30:00</td>
<td>SW_IN</td>
<td>0.000000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>20</th>
<td>2000-06-15 17:00:00</td>
<td>VPD</td>
<td>5.799000</td>
<td>True</td>
</tr>
<tr class="even">
<th>21</th>
<td>2000-06-15 17:30:00</td>
<td>VPD</td>
<td>6.577000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>22</th>
<td>2000-06-15 18:00:00</td>
<td>VPD</td>
<td>6.931000</td>
<td>True</td>
</tr>
<tr class="even">
<th>23</th>
<td>2000-06-15 18:30:00</td>
<td>VPD</td>
<td>7.286000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>24</th>
<td>2000-06-15 19:00:00</td>
<td>VPD</td>
<td>7.251000</td>
<td>True</td>
</tr>
<tr class="even">
<th>25</th>
<td>2000-06-15 19:30:00</td>
<td>VPD</td>
<td>6.683000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>26</th>
<td>2000-06-15 20:00:00</td>
<td>VPD</td>
<td>5.851000</td>
<td>True</td>
</tr>
<tr class="even">
<th>27</th>
<td>2000-06-15 20:30:00</td>
<td>VPD</td>
<td>5.254000</td>
<td>True</td>
</tr>
<tr class="odd">
<th>28</th>
<td>2000-06-15 21:00:00</td>
<td>VPD</td>
<td>5.164000</td>
<td>True</td>
</tr>
<tr class="even">
<th>29</th>
<td>2000-06-15 21:30:00</td>
<td>VPD</td>
<td>5.037000</td>
<td>True</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>m_df.tidy(control<span class="op">=</span>{<span class="st">'TA_ERA'</span>: <span class="st">'TA'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>time</th>
<th>variable</th>
<th>value</th>
<th>control</th>
<th>is_present</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>0</th>
<td>2000-06-15 17:00:00</td>
<td>TA</td>
<td>14.220000</td>
<td>15.050</td>
<td>True</td>
</tr>
<tr class="even">
<th>1</th>
<td>2000-06-15 17:30:00</td>
<td>TA</td>
<td>14.110000</td>
<td>14.961</td>
<td>True</td>
</tr>
<tr class="odd">
<th>2</th>
<td>2000-06-15 18:00:00</td>
<td>TA</td>
<td>14.230000</td>
<td>14.872</td>
<td>False</td>
</tr>
<tr class="even">
<th>3</th>
<td>2000-06-15 18:30:00</td>
<td>TA</td>
<td>14.400000</td>
<td>14.783</td>
<td>False</td>
</tr>
<tr class="odd">
<th>4</th>
<td>2000-06-15 19:00:00</td>
<td>TA</td>
<td>14.090000</td>
<td>14.694</td>
<td>True</td>
</tr>
<tr class="even">
<th>5</th>
<td>2000-06-15 19:30:00</td>
<td>TA</td>
<td>13.710000</td>
<td>14.606</td>
<td>True</td>
</tr>
<tr class="odd">
<th>6</th>
<td>2000-06-15 20:00:00</td>
<td>TA</td>
<td>13.080000</td>
<td>14.380</td>
<td>True</td>
</tr>
<tr class="even">
<th>7</th>
<td>2000-06-15 20:30:00</td>
<td>TA</td>
<td>12.410000</td>
<td>14.155</td>
<td>True</td>
</tr>
<tr class="odd">
<th>8</th>
<td>2000-06-15 21:00:00</td>
<td>TA</td>
<td>12.270000</td>
<td>13.929</td>
<td>True</td>
</tr>
<tr class="even">
<th>9</th>
<td>2000-06-15 21:30:00</td>
<td>TA</td>
<td>12.200000</td>
<td>13.704</td>
<td>True</td>
</tr>
<tr class="odd">
<th>10</th>
<td>2000-06-15 17:00:00</td>
<td>SW_IN</td>
<td>224.800003</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>11</th>
<td>2000-06-15 17:30:00</td>
<td>SW_IN</td>
<td>195.279999</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<th>12</th>
<td>2000-06-15 18:00:00</td>
<td>SW_IN</td>
<td>244.169998</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="even">
<th>13</th>
<td>2000-06-15 18:30:00</td>
<td>SW_IN</td>
<td>253.919998</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="odd">
<th>14</th>
<td>2000-06-15 19:00:00</td>
<td>SW_IN</td>
<td>177.309998</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>15</th>
<td>2000-06-15 19:30:00</td>
<td>SW_IN</td>
<td>97.070000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<th>16</th>
<td>2000-06-15 20:00:00</td>
<td>SW_IN</td>
<td>39.709999</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>17</th>
<td>2000-06-15 20:30:00</td>
<td>SW_IN</td>
<td>10.650000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<th>18</th>
<td>2000-06-15 21:00:00</td>
<td>SW_IN</td>
<td>0.320000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>19</th>
<td>2000-06-15 21:30:00</td>
<td>SW_IN</td>
<td>0.000000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<th>20</th>
<td>2000-06-15 17:00:00</td>
<td>VPD</td>
<td>5.799000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>21</th>
<td>2000-06-15 17:30:00</td>
<td>VPD</td>
<td>6.577000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<th>22</th>
<td>2000-06-15 18:00:00</td>
<td>VPD</td>
<td>6.931000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>23</th>
<td>2000-06-15 18:30:00</td>
<td>VPD</td>
<td>7.286000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<th>24</th>
<td>2000-06-15 19:00:00</td>
<td>VPD</td>
<td>7.251000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>25</th>
<td>2000-06-15 19:30:00</td>
<td>VPD</td>
<td>6.683000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<th>26</th>
<td>2000-06-15 20:00:00</td>
<td>VPD</td>
<td>5.851000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>27</th>
<td>2000-06-15 20:30:00</td>
<td>VPD</td>
<td>5.254000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="odd">
<th>28</th>
<td>2000-06-15 21:00:00</td>
<td>VPD</td>
<td>5.164000</td>
<td>NaN</td>
<td>True</td>
</tr>
<tr class="even">
<th>29</th>
<td>2000-06-15 21:30:00</td>
<td>VPD</td>
<td>5.037000</td>
<td>NaN</td>
<td>True</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="plotting" class="level4">
<h4 class="anchored" data-anchor-id="plotting">Plotting</h4>
<section id="rug" class="level5">
<h5 class="anchored" data-anchor-id="rug">Rug</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>plot_rug(m_df.tidy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-7cb696790b014274ac9601381c6bbdb4"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-7cb696790b014274ac9601381c6bbdb4") {
      outputDiv = document.getElementById("altair-viz-7cb696790b014274ac9601381c6bbdb4");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-116cc6393c3280498ddad806716d336a"}, "mark": {"type": "tick", "color": "black"}, "encoding": {"color": {"condition": {"value": "white", "test": "datum.is_present"}, "value": "black"}, "x": {"field": "time", "type": "temporal"}}, "params": [{"name": "param_1", "select": {"type": "interval"}, "bind": "scales"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-116cc6393c3280498ddad806716d336a": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "VPD", "value": 5.0370001792907715, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> m_df.tidy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.variable<span class="op">==</span><span class="st">"TA"</span>].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'row_number'</span>] <span class="op">=</span> df.reset_index().index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>time</th>
<th>variable</th>
<th>value</th>
<th>is_present</th>
<th>row_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>0</th>
<td>2000-06-15 17:00:00</td>
<td>TA</td>
<td>14.22</td>
<td>True</td>
<td>0</td>
</tr>
<tr class="even">
<th>1</th>
<td>2000-06-15 17:30:00</td>
<td>TA</td>
<td>14.11</td>
<td>True</td>
<td>1</td>
</tr>
<tr class="odd">
<th>2</th>
<td>2000-06-15 18:00:00</td>
<td>TA</td>
<td>14.23</td>
<td>False</td>
<td>2</td>
</tr>
<tr class="even">
<th>3</th>
<td>2000-06-15 18:30:00</td>
<td>TA</td>
<td>14.40</td>
<td>False</td>
<td>3</td>
</tr>
<tr class="odd">
<th>4</th>
<td>2000-06-15 19:00:00</td>
<td>TA</td>
<td>14.09</td>
<td>True</td>
<td>4</td>
</tr>
<tr class="even">
<th>5</th>
<td>2000-06-15 19:30:00</td>
<td>TA</td>
<td>13.71</td>
<td>True</td>
<td>5</td>
</tr>
<tr class="odd">
<th>6</th>
<td>2000-06-15 20:00:00</td>
<td>TA</td>
<td>13.08</td>
<td>True</td>
<td>6</td>
</tr>
<tr class="even">
<th>7</th>
<td>2000-06-15 20:30:00</td>
<td>TA</td>
<td>12.41</td>
<td>True</td>
<td>7</td>
</tr>
<tr class="odd">
<th>8</th>
<td>2000-06-15 21:00:00</td>
<td>TA</td>
<td>12.27</td>
<td>True</td>
<td>8</td>
</tr>
<tr class="even">
<th>9</th>
<td>2000-06-15 21:30:00</td>
<td>TA</td>
<td>12.20</td>
<td>True</td>
<td>9</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>time          2000-06-15 17:30:00
variable                       TA
value                       14.11
is_present                   True
row_number                      1
Name: 1, dtype: object</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">2</span>, <span class="st">"is_present"</span>] <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>time</th>
<th>variable</th>
<th>value</th>
<th>is_present</th>
<th>row_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>0</th>
<td>2000-06-15 17:00:00</td>
<td>TA</td>
<td>14.22</td>
<td>True</td>
<td>0</td>
</tr>
<tr class="even">
<th>1</th>
<td>2000-06-15 17:30:00</td>
<td>TA</td>
<td>14.11</td>
<td>True</td>
<td>1</td>
</tr>
<tr class="odd">
<th>2</th>
<td>2000-06-15 18:00:00</td>
<td>TA</td>
<td>14.23</td>
<td>True</td>
<td>2</td>
</tr>
<tr class="even">
<th>3</th>
<td>2000-06-15 18:30:00</td>
<td>TA</td>
<td>14.40</td>
<td>False</td>
<td>3</td>
</tr>
<tr class="odd">
<th>4</th>
<td>2000-06-15 19:00:00</td>
<td>TA</td>
<td>14.09</td>
<td>True</td>
<td>4</td>
</tr>
<tr class="even">
<th>5</th>
<td>2000-06-15 19:30:00</td>
<td>TA</td>
<td>13.71</td>
<td>True</td>
<td>5</td>
</tr>
<tr class="odd">
<th>6</th>
<td>2000-06-15 20:00:00</td>
<td>TA</td>
<td>13.08</td>
<td>True</td>
<td>6</td>
</tr>
<tr class="even">
<th>7</th>
<td>2000-06-15 20:30:00</td>
<td>TA</td>
<td>12.41</td>
<td>True</td>
<td>7</td>
</tr>
<tr class="odd">
<th>8</th>
<td>2000-06-15 21:00:00</td>
<td>TA</td>
<td>12.27</td>
<td>True</td>
<td>8</td>
</tr>
<tr class="even">
<th>9</th>
<td>2000-06-15 21:30:00</td>
<td>TA</td>
<td>12.20</td>
<td>True</td>
<td>9</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>prev, curr, _next<span class="op">=</span> df.iloc[i<span class="op">-</span><span class="dv">1</span>], df.iloc[i], df.iloc[i<span class="op">+</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>prev, curr, _next</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(time          2000-06-15 17:00:00
 variable                       TA
 value                       14.22
 is_present                   True
 row_number                      0
 Name: 0, dtype: object,
 time          2000-06-15 17:30:00
 variable                       TA
 value                       14.11
 is_present                   True
 row_number                      1
 Name: 1, dtype: object,
 time          2000-06-15 18:00:00
 variable                       TA
 value                       14.23
 is_present                   True
 row_number                      2
 Name: 2, dtype: object)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>time</th>
<th>variable</th>
<th>value</th>
<th>is_present</th>
<th>row_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>0</th>
<td>2000-06-15 17:00:00</td>
<td>TA</td>
<td>14.22</td>
<td>True</td>
<td>0</td>
</tr>
<tr class="even">
<th>1</th>
<td>2000-06-15 17:30:00</td>
<td>TA</td>
<td>14.11</td>
<td>True</td>
<td>1</td>
</tr>
<tr class="odd">
<th>2</th>
<td>2000-06-15 18:00:00</td>
<td>TA</td>
<td>14.23</td>
<td>True</td>
<td>2</td>
</tr>
<tr class="even">
<th>3</th>
<td>2000-06-15 18:30:00</td>
<td>TA</td>
<td>14.40</td>
<td>False</td>
<td>3</td>
</tr>
<tr class="odd">
<th>4</th>
<td>2000-06-15 19:00:00</td>
<td>TA</td>
<td>14.09</td>
<td>True</td>
<td>4</td>
</tr>
<tr class="even">
<th>5</th>
<td>2000-06-15 19:30:00</td>
<td>TA</td>
<td>13.71</td>
<td>True</td>
<td>5</td>
</tr>
<tr class="odd">
<th>6</th>
<td>2000-06-15 20:00:00</td>
<td>TA</td>
<td>13.08</td>
<td>True</td>
<td>6</td>
</tr>
<tr class="even">
<th>7</th>
<td>2000-06-15 20:30:00</td>
<td>TA</td>
<td>12.41</td>
<td>True</td>
<td>7</td>
</tr>
<tr class="odd">
<th>8</th>
<td>2000-06-15 21:00:00</td>
<td>TA</td>
<td>12.27</td>
<td>True</td>
<td>8</td>
</tr>
<tr class="even">
<th>9</th>
<td>2000-06-15 21:30:00</td>
<td>TA</td>
<td>12.20</td>
<td>True</td>
<td>9</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df)):</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># handle boundaries</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    prev <span class="op">=</span> df.iloc[i<span class="op">-</span><span class="dv">1</span>].is_present <span class="cf">if</span> i<span class="op">&gt;</span><span class="dv">0</span> <span class="cf">else</span> <span class="va">True</span> </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    _next <span class="op">=</span> df.iloc[i<span class="op">+</span><span class="dv">1</span>].is_present <span class="cf">if</span> i<span class="op">&lt;</span>(<span class="bu">len</span>(df)<span class="op">-</span><span class="dv">1</span>) <span class="cf">else</span> <span class="va">True</span> </span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    curr <span class="op">=</span> df.iloc[i]</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> curr.is_present <span class="kw">and</span> prev:</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"gap start"</span>, curr.time)</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> curr.is_present <span class="kw">and</span> _next:</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"gap end"</span>, curr.time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>gap start 2000-06-15 18:30:00
gap end 2000-06-15 18:30:00</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L224" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
</section>
<section id="find_gap_limits" class="level3">
<h3 class="anchored" data-anchor-id="find_gap_limits">find_gap_limits</h3>
<blockquote class="blockquote">
<pre><code> find_gap_limits (df)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>find_gap_limits(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>gap_start</th>
<th>gap_end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>0</th>
<td>2000-06-15 18:30:00</td>
<td>2000-06-15 18:30:00</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L236" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_missing_area" class="level3">
<h3 class="anchored" data-anchor-id="plot_missing_area">plot_missing_area</h3>
<blockquote class="blockquote">
<pre><code> plot_missing_area (df, sel=Selection('selector002', SelectionDef({
                    bind: 'scales',   type: 'interval' })), props={})</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>plot_missing_area(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-944ac8229347423a87de22991377b8e4"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-944ac8229347423a87de22991377b8e4") {
      outputDiv = document.getElementById("altair-viz-944ac8229347423a87de22991377b8e4");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-659c10d340f0c99d8c9e8162adc87433"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-659c10d340f0c99d8c9e8162adc87433": [{"gap_start": "2000-06-15T18:30:00", "gap_end": "2000-06-15T18:30:00"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<section id="points" class="level5">
<h5 class="anchored" data-anchor-id="points">Points</h5>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L251" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="plot_points" class="level3">
<h3 class="anchored" data-anchor-id="plot_points">plot_points</h3>
<blockquote class="blockquote">
<pre><code> plot_points (df, y='value', y_label='', sel=Selection('selector003',
              SelectionDef({   bind: 'scales',   type: 'interval' })),
              props={})</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>plot_points(m_df.tidy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-195b88576b0a49d4bfb7c64dc1983b45"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-195b88576b0a49d4bfb7c64dc1983b45") {
      outputDiv = document.getElementById("altair-viz-195b88576b0a49d4bfb7c64dc1983b45");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-116cc6393c3280498ddad806716d336a"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-116cc6393c3280498ddad806716d336a": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "VPD", "value": 5.0370001792907715, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<section id="line" class="level5">
<h5 class="anchored" data-anchor-id="line">Line</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>plot_line(m_df.tidy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-ee2d56468a7844dc8965de224ef0efdc"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-ee2d56468a7844dc8965de224ef0efdc") {
      outputDiv = document.getElementById("altair-viz-ee2d56468a7844dc8965de224ef0efdc");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-116cc6393c3280498ddad806716d336a"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "params": [{"name": "param_4", "select": {"type": "interval"}, "bind": "scales"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-116cc6393c3280498ddad806716d336a": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "VPD", "value": 5.0370001792907715, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="control" class="level5">
<h5 class="anchored" data-anchor-id="control">Control</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>plot_control(m_df.tidy(), y<span class="op">=</span><span class="st">"value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-9ae36861ca724ffe971da238f51f5482"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9ae36861ca724ffe971da238f51f5482") {
      outputDiv = document.getElementById("altair-viz-9ae36861ca724ffe971da238f51f5482");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-116cc6393c3280498ddad806716d336a"}, "mark": {"type": "line", "strokeDash": [4, 6]}, "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "params": [{"name": "param_22", "select": {"type": "interval"}, "bind": "scales"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-116cc6393c3280498ddad806716d336a": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "VPD", "value": 5.0370001792907715, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="errorband" class="level5">
<h5 class="anchored" data-anchor-id="errorband">Errorband</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>plot_error(m_df.tidy().assign(std<span class="op">=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-334bbf09ff904bf1b6a372fa1ca1d946"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-334bbf09ff904bf1b6a372fa1ca1d946") {
      outputDiv = document.getElementById("altair-viz-334bbf09ff904bf1b6a372fa1ca1d946");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-493ef612c090791713c008f9f727e0f8"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "params": [{"name": "param_5", "select": {"type": "interval"}, "bind": "scales"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-493ef612c090791713c008f9f727e0f8": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true, "std": 5, "err_low": 4.220000267028809, "err_high": 24.22000026702881}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true, "std": 5, "err_low": 4.109999656677246, "err_high": 24.109999656677246}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false, "std": 5, "err_low": 4.229999542236328, "err_high": 24.229999542236328}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false, "std": 5, "err_low": 4.399999618530273, "err_high": 24.399999618530273}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true, "std": 5, "err_low": 4.090000152587891, "err_high": 24.09000015258789}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true, "std": 5, "err_low": 3.7100000381469727, "err_high": 23.710000038146973}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true, "std": 5, "err_low": 3.0799999237060547, "err_high": 23.079999923706055}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true, "std": 5, "err_low": 2.4099998474121094, "err_high": 22.40999984741211}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true, "std": 5, "err_low": 2.270000457763672, "err_high": 22.270000457763672}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true, "std": 5, "err_low": 2.1999998092651367, "err_high": 22.199999809265137}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true, "std": 5, "err_low": 214.8000030517578, "err_high": 234.8000030517578}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true, "std": 5, "err_low": 185.27999877929688, "err_high": 205.27999877929688}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": false, "std": 5, "err_low": 234.1699981689453, "err_high": 254.1699981689453}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": false, "std": 5, "err_low": 243.9199981689453, "err_high": 263.9199981689453}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true, "std": 5, "err_low": 167.30999755859375, "err_high": 187.30999755859375}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true, "std": 5, "err_low": 87.06999969482422, "err_high": 107.06999969482422}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true, "std": 5, "err_low": 29.709999084472656, "err_high": 49.709999084472656}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true, "std": 5, "err_low": 0.6499996185302734, "err_high": 20.649999618530273}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true, "std": 5, "err_low": -9.680000007152557, "err_high": 10.319999992847443}, {"time": "2000-06-15T21:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "std": 5, "err_low": -10.0, "err_high": 10.0}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": true, "std": 5, "err_low": -4.201000213623047, "err_high": 15.798999786376953}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": true, "std": 5, "err_low": -3.422999858856201, "err_high": 16.5770001411438}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": true, "std": 5, "err_low": -3.068999767303467, "err_high": 16.931000232696533}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": true, "std": 5, "err_low": -2.7140002250671387, "err_high": 17.28599977493286}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true, "std": 5, "err_low": -2.749000072479248, "err_high": 17.250999927520752}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true, "std": 5, "err_low": -3.316999912261963, "err_high": 16.683000087738037}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true, "std": 5, "err_low": -4.14900016784668, "err_high": 15.85099983215332}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true, "std": 5, "err_low": -4.745999813079834, "err_high": 15.254000186920166}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true, "std": 5, "err_low": -4.835999965667725, "err_high": 15.164000034332275}, {"time": "2000-06-15T21:30:00", "variable": "VPD", "value": 5.0370001792907715, "is_present": true, "std": 5, "err_low": -4.9629998207092285, "err_high": 15.037000179290771}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="variable" class="level5">
<h5 class="anchored" data-anchor-id="variable">Variable</h5>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L314" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="plot_variable" class="level3">
<h3 class="anchored" data-anchor-id="plot_variable">plot_variable</h3>
<blockquote class="blockquote">
<pre><code> plot_variable (df, variable, ys=['value', 'value', 'control'], title='',
                y_label='', sel=None, error=False, point=True,
                gap_area=True, control=False, props={})</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>plot_variable(m_df.tidy(), <span class="st">"TA"</span>, title<span class="op">=</span><span class="st">"title TA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-6a0e4f32aa7742438fcb6b6a9c87ddff"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-6a0e4f32aa7742438fcb6b6a9c87ddff") {
      outputDiv = document.getElementById("altair-viz-6a0e4f32aa7742438fcb6b6a9c87ddff");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"data": {"name": "data-d3522d54a15a85a858b8e6a3f806052a"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-3d8f1279455991cf43dd896051a908a7"}}, {"data": {"name": "data-d3522d54a15a85a858b8e6a3f806052a"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_18"}], "params": [{"name": "param_28", "select": {"type": "interval"}, "bind": "scales", "views": ["view_18"]}], "title": "title TA", "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-d3522d54a15a85a858b8e6a3f806052a": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true}], "data-3d8f1279455991cf43dd896051a908a7": [{"gap_start": "2000-06-15T18:00:00", "gap_end": "2000-06-15T18:30:00"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>plot_variable(m_df.tidy(control<span class="op">=</span>hai_control), <span class="st">"TA"</span>, title<span class="op">=</span><span class="st">"title TA"</span>, control<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-1d32bcfe31b24fabaabb59135b91e2d2"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-1d32bcfe31b24fabaabb59135b91e2d2") {
      outputDiv = document.getElementById("altair-viz-1d32bcfe31b24fabaabb59135b91e2d2");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"data": {"name": "data-6e6ec3db0644b86898f31aee73937473"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-3d8f1279455991cf43dd896051a908a7"}}, {"data": {"name": "data-6e6ec3db0644b86898f31aee73937473"}, "mark": {"type": "line", "strokeDash": [4, 6]}, "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "control", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_19"}, {"data": {"name": "data-6e6ec3db0644b86898f31aee73937473"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "params": [{"name": "param_29", "select": {"type": "interval"}, "bind": "scales", "views": ["view_19"]}], "title": "title TA", "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-6e6ec3db0644b86898f31aee73937473": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "control": 15.050000190734863, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "control": 14.961000442504883, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "control": 14.871999740600586, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "control": 14.782999992370605, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "control": 14.694000244140625, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "control": 14.605999946594238, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "control": 14.380000114440918, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "control": 14.154999732971191, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "control": 13.928999900817871, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "control": 13.704000473022461, "is_present": true}], "data-3d8f1279455991cf43dd896051a908a7": [{"gap_start": "2000-06-15T18:00:00", "gap_end": "2000-06-15T18:30:00"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>plot_variable(m_df.tidy().assign(std<span class="op">=</span><span class="fl">.5</span>), <span class="st">"TA"</span>, title<span class="op">=</span><span class="st">"title TA"</span>, error<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-d453d3418ad54f9fb04e8a948dd9df84"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d453d3418ad54f9fb04e8a948dd9df84") {
      outputDiv = document.getElementById("altair-viz-d453d3418ad54f9fb04e8a948dd9df84");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"data": {"name": "data-949886b415eaa76139d63a0cedd7ea19"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-3d8f1279455991cf43dd896051a908a7"}}, {"data": {"name": "data-949886b415eaa76139d63a0cedd7ea19"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_2"}, {"data": {"name": "data-949886b415eaa76139d63a0cedd7ea19"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "params": [{"name": "param_7", "select": {"type": "interval"}, "bind": "scales", "views": ["view_2"]}], "title": "title TA", "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-949886b415eaa76139d63a0cedd7ea19": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true, "std": 0.5, "err_low": 13.220000267028809, "err_high": 15.220000267028809}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true, "std": 0.5, "err_low": 13.109999656677246, "err_high": 15.109999656677246}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false, "std": 0.5, "err_low": 13.229999542236328, "err_high": 15.229999542236328}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false, "std": 0.5, "err_low": 13.399999618530273, "err_high": 15.399999618530273}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true, "std": 0.5, "err_low": 13.09000015258789, "err_high": 15.09000015258789}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true, "std": 0.5, "err_low": 12.710000038146973, "err_high": 14.710000038146973}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true, "std": 0.5, "err_low": 12.079999923706055, "err_high": 14.079999923706055}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true, "std": 0.5, "err_low": 11.40999984741211, "err_high": 13.40999984741211}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true, "std": 0.5, "err_low": 11.270000457763672, "err_high": 13.270000457763672}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true, "std": 0.5, "err_low": 11.199999809265137, "err_high": 13.199999809265137}], "data-3d8f1279455991cf43dd896051a908a7": [{"gap_start": "2000-06-15T18:00:00", "gap_end": "2000-06-15T18:30:00"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>plot_variable(m_df.tidy().assign(std<span class="op">=</span><span class="fl">.5</span>), <span class="st">"TA"</span>, title<span class="op">=</span><span class="st">"title TA"</span>, error<span class="op">=</span><span class="va">True</span>, point<span class="op">=</span><span class="va">False</span>, gap_area<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-edf191573f3247848c660086bf37531d"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-edf191573f3247848c660086bf37531d") {
      outputDiv = document.getElementById("altair-viz-edf191573f3247848c660086bf37531d");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_3"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "data": {"name": "data-949886b415eaa76139d63a0cedd7ea19"}, "params": [{"name": "param_8", "select": {"type": "interval"}, "bind": "scales", "views": ["view_3"]}], "title": "title TA", "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-949886b415eaa76139d63a0cedd7ea19": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true, "std": 0.5, "err_low": 13.220000267028809, "err_high": 15.220000267028809}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true, "std": 0.5, "err_low": 13.109999656677246, "err_high": 15.109999656677246}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false, "std": 0.5, "err_low": 13.229999542236328, "err_high": 15.229999542236328}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false, "std": 0.5, "err_low": 13.399999618530273, "err_high": 15.399999618530273}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true, "std": 0.5, "err_low": 13.09000015258789, "err_high": 15.09000015258789}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true, "std": 0.5, "err_low": 12.710000038146973, "err_high": 14.710000038146973}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true, "std": 0.5, "err_low": 12.079999923706055, "err_high": 14.079999923706055}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true, "std": 0.5, "err_low": 11.40999984741211, "err_high": 13.40999984741211}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true, "std": 0.5, "err_low": 11.270000457763672, "err_high": 13.270000457763672}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true, "std": 0.5, "err_low": 11.199999809265137, "err_high": 13.199999809265137}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<section id="facet" class="level5">
<h5 class="anchored" data-anchor-id="facet">Facet</h5>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L341" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="facet_variable" class="level3">
<h3 class="anchored" data-anchor-id="facet_variable">facet_variable</h3>
<blockquote class="blockquote">
<pre><code> facet_variable (df, n_cols:int=3, bind_interaction:bool=True, units=None,
                 ys=['value', 'value', 'control'], title='', sel=None,
                 error=False, point=True, gap_area=True, control=False,
                 props={})</code></pre>
</blockquote>
<p>Plot all values of the column <code>variable</code> in different subplots</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td></td>
<td></td>
<td>tidy dataframe</td>
</tr>
<tr class="even">
<td>n_cols</td>
<td>int</td>
<td>3</td>
<td></td>
</tr>
<tr class="odd">
<td>bind_interaction</td>
<td>bool</td>
<td>True</td>
<td>Whether the sub-plots for each variable should be connected for zooming/panning</td>
</tr>
<tr class="even">
<td>units</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>ys</td>
<td>list</td>
<td>[‘value’, ‘value’, ‘control’]</td>
<td></td>
</tr>
<tr class="even">
<td>title</td>
<td>str</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>sel</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>error</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="odd">
<td>point</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="even">
<td>gap_area</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="odd">
<td>control</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="even">
<td>props</td>
<td>dict</td>
<td>{}</td>
<td></td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Chart</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<section id="show" class="level5">
<h5 class="anchored" data-anchor-id="show">Show</h5>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L367" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="meteoimpdf.show" class="level3">
<h3 class="anchored" data-anchor-id="meteoimpdf.show">MeteoImpDf.show</h3>
<blockquote class="blockquote">
<pre><code> MeteoImpDf.show (ax=None, ctx=None, n_cols:int=3,
                  bind_interaction:bool=True, props:dict=None)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ax</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>ctx</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>n_cols</td>
<td>int</td>
<td>3</td>
<td></td>
</tr>
<tr class="even">
<td>bind_interaction</td>
<td>bool</td>
<td>True</td>
<td>Whether the sub-plots for each variable should be connected for zooming/panning</td>
</tr>
<tr class="odd">
<td>props</td>
<td>dict</td>
<td>None</td>
<td>additional properties (eg. size) for altair plot</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Chart</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>m_df.show(bind_interaction <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-84303e40bceb4651bbad5082e20505e0"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-84303e40bceb4651bbad5082e20505e0") {
      outputDiv = document.getElementById("altair-viz-84303e40bceb4651bbad5082e20505e0");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"layer": [{"data": {"name": "data-d3522d54a15a85a858b8e6a3f806052a"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-3d8f1279455991cf43dd896051a908a7"}}, {"data": {"name": "data-d3522d54a15a85a858b8e6a3f806052a"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_4"}], "height": 150, "title": "", "width": 200}, {"layer": [{"data": {"name": "data-ba91082466fb229ed1d96bd2562685ce"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-3d8f1279455991cf43dd896051a908a7"}}, {"data": {"name": "data-ba91082466fb229ed1d96bd2562685ce"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_5"}], "height": 150, "title": "", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_6"}], "data": {"name": "data-87566384334aba3c379fa0e38b728291"}, "height": 150, "title": "", "width": 200}]}], "params": [{"name": "param_9", "select": {"type": "interval"}, "bind": "scales", "views": ["view_4"]}, {"name": "param_10", "select": {"type": "interval"}, "bind": "scales", "views": ["view_5"]}, {"name": "param_11", "select": {"type": "interval"}, "bind": "scales", "views": ["view_6"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-d3522d54a15a85a858b8e6a3f806052a": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true}], "data-3d8f1279455991cf43dd896051a908a7": [{"gap_start": "2000-06-15T18:00:00", "gap_end": "2000-06-15T18:30:00"}], "data-ba91082466fb229ed1d96bd2562685ce": [{"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true}], "data-87566384334aba3c379fa0e38b728291": [{"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "VPD", "value": 5.0370001792907715, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>tfms2[<span class="dv">0</span>].show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-9e9883012afe48de8a5fca83abddbcf8"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9e9883012afe48de8a5fca83abddbcf8") {
      outputDiv = document.getElementById("altair-viz-9e9883012afe48de8a5fca83abddbcf8");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"layer": [{"data": {"name": "data-d3522d54a15a85a858b8e6a3f806052a"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-3d8f1279455991cf43dd896051a908a7"}}, {"data": {"name": "data-d3522d54a15a85a858b8e6a3f806052a"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_7"}], "height": 150, "title": "", "width": 200}, {"layer": [{"data": {"name": "data-ba91082466fb229ed1d96bd2562685ce"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-3d8f1279455991cf43dd896051a908a7"}}, {"data": {"name": "data-ba91082466fb229ed1d96bd2562685ce"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_8"}], "height": 150, "title": "", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_9"}], "data": {"name": "data-87566384334aba3c379fa0e38b728291"}, "height": 150, "title": "", "width": 200}]}], "params": [{"name": "param_12", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_7", "view_8", "view_9"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-d3522d54a15a85a858b8e6a3f806052a": [{"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "TA", "value": 12.199999809265137, "is_present": true}], "data-3d8f1279455991cf43dd896051a908a7": [{"gap_start": "2000-06-15T18:00:00", "gap_end": "2000-06-15T18:30:00"}], "data-ba91082466fb229ed1d96bd2562685ce": [{"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true}], "data-87566384334aba3c379fa0e38b728291": [{"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}, {"time": "2000-06-15T21:30:00", "variable": "VPD", "value": 5.0370001792907715, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>tfms2[<span class="dv">3</span>].show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-0abeebea14b14f4fa3113a04f386e0d8"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0abeebea14b14f4fa3113a04f386e0d8") {
      outputDiv = document.getElementById("altair-viz-0abeebea14b14f4fa3113a04f386e0d8");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"layer": [{"data": {"name": "data-ab6f2550198bae81eff022e4d2802f6f"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-7abd4e4a3459d6f581062531aa9e5dc7"}}, {"data": {"name": "data-ab6f2550198bae81eff022e4d2802f6f"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_10"}], "height": 150, "title": "", "width": 200}, {"layer": [{"data": {"name": "data-0e24e746637fe86fbe97cac7aeaf242e"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-7abd4e4a3459d6f581062531aa9e5dc7"}}, {"data": {"name": "data-0e24e746637fe86fbe97cac7aeaf242e"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_11"}], "height": 150, "title": "", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_12"}], "data": {"name": "data-0758420d5d1e1a0a6b4da55e8a5b3610"}, "height": 150, "title": "", "width": 200}]}], "params": [{"name": "param_16", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_10", "view_11", "view_12"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-ab6f2550198bae81eff022e4d2802f6f": [{"time": "2000-06-16T08:00:00", "variable": "TA", "value": 8.899999618530273, "is_present": true}, {"time": "2000-06-16T08:30:00", "variable": "TA", "value": 9.569999694824219, "is_present": true}, {"time": "2000-06-16T09:00:00", "variable": "TA", "value": 9.739999771118164, "is_present": false}, {"time": "2000-06-16T09:30:00", "variable": "TA", "value": 10.020000457763672, "is_present": false}, {"time": "2000-06-16T10:00:00", "variable": "TA", "value": 10.5, "is_present": true}, {"time": "2000-06-16T10:30:00", "variable": "TA", "value": 10.529999732971191, "is_present": true}, {"time": "2000-06-16T11:00:00", "variable": "TA", "value": 10.729999542236328, "is_present": true}, {"time": "2000-06-16T11:30:00", "variable": "TA", "value": 10.770000457763672, "is_present": true}, {"time": "2000-06-16T12:00:00", "variable": "TA", "value": 10.850000381469727, "is_present": true}, {"time": "2000-06-16T12:30:00", "variable": "TA", "value": 11.399999618530273, "is_present": true}], "data-7abd4e4a3459d6f581062531aa9e5dc7": [{"gap_start": "2000-06-16T09:00:00", "gap_end": "2000-06-16T09:30:00"}], "data-0e24e746637fe86fbe97cac7aeaf242e": [{"time": "2000-06-16T08:00:00", "variable": "SW_IN", "value": 467.94000244140625, "is_present": true}, {"time": "2000-06-16T08:30:00", "variable": "SW_IN", "value": 526.6400146484375, "is_present": true}, {"time": "2000-06-16T09:00:00", "variable": "SW_IN", "value": 463.1000061035156, "is_present": false}, {"time": "2000-06-16T09:30:00", "variable": "SW_IN", "value": 676.3599853515625, "is_present": false}, {"time": "2000-06-16T10:00:00", "variable": "SW_IN", "value": 689.47998046875, "is_present": true}, {"time": "2000-06-16T10:30:00", "variable": "SW_IN", "value": 503.30999755859375, "is_present": true}, {"time": "2000-06-16T11:00:00", "variable": "SW_IN", "value": 583.1699829101562, "is_present": true}, {"time": "2000-06-16T11:30:00", "variable": "SW_IN", "value": 329.6400146484375, "is_present": true}, {"time": "2000-06-16T12:00:00", "variable": "SW_IN", "value": 503.57000732421875, "is_present": true}, {"time": "2000-06-16T12:30:00", "variable": "SW_IN", "value": 567.5599975585938, "is_present": true}], "data-0758420d5d1e1a0a6b4da55e8a5b3610": [{"time": "2000-06-16T08:00:00", "variable": "VPD", "value": 3.5490000247955322, "is_present": true}, {"time": "2000-06-16T08:30:00", "variable": "VPD", "value": 4.1529998779296875, "is_present": true}, {"time": "2000-06-16T09:00:00", "variable": "VPD", "value": 4.705999851226807, "is_present": true}, {"time": "2000-06-16T09:30:00", "variable": "VPD", "value": 5.374000072479248, "is_present": true}, {"time": "2000-06-16T10:00:00", "variable": "VPD", "value": 5.7129998207092285, "is_present": true}, {"time": "2000-06-16T10:30:00", "variable": "VPD", "value": 5.677000045776367, "is_present": true}, {"time": "2000-06-16T11:00:00", "variable": "VPD", "value": 5.386000156402588, "is_present": true}, {"time": "2000-06-16T11:30:00", "variable": "VPD", "value": 5.355000019073486, "is_present": true}, {"time": "2000-06-16T12:00:00", "variable": "VPD", "value": 5.065999984741211, "is_present": true}, {"time": "2000-06-16T12:30:00", "variable": "VPD", "value": 5.794000148773193, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="to-tensor" class="level3">
<h3 class="anchored" data-anchor-id="to-tensor">4) To Tensor</h3>
<p>this needs to handle both the init with a list of items and when the first item is a sequence of list of items</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L377" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="meteoimptensor" class="level3">
<h3 class="anchored" data-anchor-id="meteoimptensor">MeteoImpTensor</h3>
<blockquote class="blockquote">
<pre><code> MeteoImpTensor (*args)</code></pre>
</blockquote>
<p>All the operations on a read-only sequence.</p>
<p>Concrete subclasses must override <strong>new</strong> or <strong>init</strong>, <strong>getitem</strong>, and <strong>len</strong>.</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L402" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="meteoimpdf2tensor" class="level3">
<h3 class="anchored" data-anchor-id="meteoimpdf2tensor">MeteoImpDf2Tensor</h3>
<blockquote class="blockquote">
<pre><code> MeteoImpDf2Tensor (enc=None, dec=None, split_idx=None, order=None)</code></pre>
</blockquote>
<p>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<code>encodes</code>,<code>decodes</code>,<code>setups</code>) if <code>split_idx</code> matches</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>to_t <span class="op">=</span> MeteoImpDf2Tensor()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>to_t.setup(tfms2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>to_t(tfms2[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div><p style="font-size: 1.2rem;">data</p> <pre>tensor([[ 14.2200, 224.8000,   5.7990],
        [ 14.1100, 195.2800,   6.5770],
        [ 14.2300, 244.1700,   6.9310],
        [ 14.4000, 253.9200,   7.2860],
        [ 14.0900, 177.3100,   7.2510],
        [ 13.7100,  97.0700,   6.6830],
        [ 13.0800,  39.7100,   5.8510],
        [ 12.4100,  10.6500,   5.2540],
        [ 12.2700,   0.3200,   5.1640],
        [ 12.2000,   0.0000,   5.0370]])</pre> </div><div><p style="font-size: 1.2rem;">mask</p> <pre>tensor([[ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]])</pre> </div><div><p style="font-size: 1.2rem;">control</p> <pre>tensor([[ 15.0500, 255.1930,   5.1020,  15.1390, 287.1000,   4.9000],
        [ 14.9610, 221.4270,   5.3050,  15.0500, 255.1930,   5.1020],
        [ 14.8720, 186.3800,   5.5070,  14.9610, 221.4270,   5.3050],
        [ 14.7830, 150.6500,   5.7100,  14.8720, 186.3800,   5.5070],
        [ 14.6940, 114.8490,   5.9120,  14.7830, 150.6500,   5.7100],
        [ 14.6060,  34.7280,   6.1140,  14.6940, 114.8490,   5.9120],
        [ 14.3800,  19.8430,   6.0740,  14.6060,  34.7280,   6.1140],
        [ 14.1550,   5.7120,   6.0340,  14.3800,  19.8430,   6.0740],
        [ 13.9290,   0.0000,   5.9940,  14.1550,   5.7120,   6.0340],
        [ 13.7040,   0.0000,   5.9540,  13.9290,   0.0000,   5.9940]])</pre> </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>to_t.decode(to_t(tfms2[<span class="dv">0</span>]))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>tfms2[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table id="T_aa9b5" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_aa9b5_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_aa9b5_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_aa9b5_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_aa9b5_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_aa9b5_row0_col0" class="data row0 col0">14.2200</td>
<td id="T_aa9b5_row0_col1" class="data row0 col1">224.8000</td>
<td id="T_aa9b5_row0_col2" class="data row0 col2">5.7990</td>
</tr>
<tr class="even">
<th id="T_aa9b5_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_aa9b5_row1_col0" class="data row1 col0">14.1100</td>
<td id="T_aa9b5_row1_col1" class="data row1 col1">195.2800</td>
<td id="T_aa9b5_row1_col2" class="data row1 col2">6.5770</td>
</tr>
<tr class="odd">
<th id="T_aa9b5_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_aa9b5_row2_col0" class="data row2 col0">14.2300</td>
<td id="T_aa9b5_row2_col1" class="data row2 col1">244.1700</td>
<td id="T_aa9b5_row2_col2" class="data row2 col2">6.9310</td>
</tr>
<tr class="even">
<th id="T_aa9b5_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_aa9b5_row3_col0" class="data row3 col0">14.4000</td>
<td id="T_aa9b5_row3_col1" class="data row3 col1">253.9200</td>
<td id="T_aa9b5_row3_col2" class="data row3 col2">7.2860</td>
</tr>
<tr class="odd">
<th id="T_aa9b5_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_aa9b5_row4_col0" class="data row4 col0">14.0900</td>
<td id="T_aa9b5_row4_col1" class="data row4 col1">177.3100</td>
<td id="T_aa9b5_row4_col2" class="data row4 col2">7.2510</td>
</tr>
<tr class="even">
<th id="T_aa9b5_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_aa9b5_row5_col0" class="data row5 col0">13.7100</td>
<td id="T_aa9b5_row5_col1" class="data row5 col1">97.0700</td>
<td id="T_aa9b5_row5_col2" class="data row5 col2">6.6830</td>
</tr>
<tr class="odd">
<th id="T_aa9b5_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_aa9b5_row6_col0" class="data row6 col0">13.0800</td>
<td id="T_aa9b5_row6_col1" class="data row6 col1">39.7100</td>
<td id="T_aa9b5_row6_col2" class="data row6 col2">5.8510</td>
</tr>
<tr class="even">
<th id="T_aa9b5_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_aa9b5_row7_col0" class="data row7 col0">12.4100</td>
<td id="T_aa9b5_row7_col1" class="data row7 col1">10.6500</td>
<td id="T_aa9b5_row7_col2" class="data row7 col2">5.2540</td>
</tr>
<tr class="odd">
<th id="T_aa9b5_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_aa9b5_row8_col0" class="data row8 col0">12.2700</td>
<td id="T_aa9b5_row8_col1" class="data row8 col1">0.3200</td>
<td id="T_aa9b5_row8_col2" class="data row8 col2">5.1640</td>
</tr>
<tr class="even">
<th id="T_aa9b5_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_aa9b5_row9_col0" class="data row9 col0">12.2000</td>
<td id="T_aa9b5_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_aa9b5_row9_col2" class="data row9 col2">5.0370</td>
</tr>
</tbody>
</table>
<div>
<p>mask</p>
<table id="T_90c74" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_90c74_level0_col0" class="col_heading level0 col0">TA</th>
<th id="T_90c74_level0_col1" class="col_heading level0 col1">SW_IN</th>
<th id="T_90c74_level0_col2" class="col_heading level0 col2">VPD</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_90c74_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_90c74_row0_col0" class="data row0 col0">True</td>
<td id="T_90c74_row0_col1" class="data row0 col1">True</td>
<td id="T_90c74_row0_col2" class="data row0 col2">True</td>
</tr>
<tr class="even">
<th id="T_90c74_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_90c74_row1_col0" class="data row1 col0">True</td>
<td id="T_90c74_row1_col1" class="data row1 col1">True</td>
<td id="T_90c74_row1_col2" class="data row1 col2">True</td>
</tr>
<tr class="odd">
<th id="T_90c74_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_90c74_row2_col0" class="data row2 col0">False</td>
<td id="T_90c74_row2_col1" class="data row2 col1">False</td>
<td id="T_90c74_row2_col2" class="data row2 col2">True</td>
</tr>
<tr class="even">
<th id="T_90c74_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_90c74_row3_col0" class="data row3 col0">False</td>
<td id="T_90c74_row3_col1" class="data row3 col1">False</td>
<td id="T_90c74_row3_col2" class="data row3 col2">True</td>
</tr>
<tr class="odd">
<th id="T_90c74_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_90c74_row4_col0" class="data row4 col0">True</td>
<td id="T_90c74_row4_col1" class="data row4 col1">True</td>
<td id="T_90c74_row4_col2" class="data row4 col2">True</td>
</tr>
<tr class="even">
<th id="T_90c74_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_90c74_row5_col0" class="data row5 col0">True</td>
<td id="T_90c74_row5_col1" class="data row5 col1">True</td>
<td id="T_90c74_row5_col2" class="data row5 col2">True</td>
</tr>
<tr class="odd">
<th id="T_90c74_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_90c74_row6_col0" class="data row6 col0">True</td>
<td id="T_90c74_row6_col1" class="data row6 col1">True</td>
<td id="T_90c74_row6_col2" class="data row6 col2">True</td>
</tr>
<tr class="even">
<th id="T_90c74_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_90c74_row7_col0" class="data row7 col0">True</td>
<td id="T_90c74_row7_col1" class="data row7 col1">True</td>
<td id="T_90c74_row7_col2" class="data row7 col2">True</td>
</tr>
<tr class="odd">
<th id="T_90c74_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_90c74_row8_col0" class="data row8 col0">True</td>
<td id="T_90c74_row8_col1" class="data row8 col1">True</td>
<td id="T_90c74_row8_col2" class="data row8 col2">True</td>
</tr>
<tr class="even">
<th id="T_90c74_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_90c74_row9_col0" class="data row9 col0">True</td>
<td id="T_90c74_row9_col1" class="data row9 col1">True</td>
<td id="T_90c74_row9_col2" class="data row9 col2">True</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>control</p>
<table id="T_3e76c" class="table table-sm table-striped">
<thead>
<tr class="header">
<th class="blank level0">&nbsp;</th>
<th id="T_3e76c_level0_col0" class="col_heading level0 col0">TA_ERA</th>
<th id="T_3e76c_level0_col1" class="col_heading level0 col1">SW_IN_ERA</th>
<th id="T_3e76c_level0_col2" class="col_heading level0 col2">VPD_ERA</th>
<th id="T_3e76c_level0_col3" class="col_heading level0 col3">TA_ERA_lag_1</th>
<th id="T_3e76c_level0_col4" class="col_heading level0 col4">SW_IN_ERA_lag_1</th>
<th id="T_3e76c_level0_col5" class="col_heading level0 col5">VPD_ERA_lag_1</th>
</tr>
<tr class="odd">
<th class="index_name level0">time</th>
<th class="blank col0">&nbsp;</th>
<th class="blank col1">&nbsp;</th>
<th class="blank col2">&nbsp;</th>
<th class="blank col3">&nbsp;</th>
<th class="blank col4">&nbsp;</th>
<th class="blank col5">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th id="T_3e76c_level0_row0" class="row_heading level0 row0">2000-06-15 17:00:00</th>
<td id="T_3e76c_row0_col0" class="data row0 col0">15.0500</td>
<td id="T_3e76c_row0_col1" class="data row0 col1">255.1930</td>
<td id="T_3e76c_row0_col2" class="data row0 col2">5.1020</td>
<td id="T_3e76c_row0_col3" class="data row0 col3">15.1390</td>
<td id="T_3e76c_row0_col4" class="data row0 col4">287.1000</td>
<td id="T_3e76c_row0_col5" class="data row0 col5">4.9000</td>
</tr>
<tr class="even">
<th id="T_3e76c_level0_row1" class="row_heading level0 row1">2000-06-15 17:30:00</th>
<td id="T_3e76c_row1_col0" class="data row1 col0">14.9610</td>
<td id="T_3e76c_row1_col1" class="data row1 col1">221.4270</td>
<td id="T_3e76c_row1_col2" class="data row1 col2">5.3050</td>
<td id="T_3e76c_row1_col3" class="data row1 col3">15.0500</td>
<td id="T_3e76c_row1_col4" class="data row1 col4">255.1930</td>
<td id="T_3e76c_row1_col5" class="data row1 col5">5.1020</td>
</tr>
<tr class="odd">
<th id="T_3e76c_level0_row2" class="row_heading level0 row2">2000-06-15 18:00:00</th>
<td id="T_3e76c_row2_col0" class="data row2 col0">14.8720</td>
<td id="T_3e76c_row2_col1" class="data row2 col1">186.3800</td>
<td id="T_3e76c_row2_col2" class="data row2 col2">5.5070</td>
<td id="T_3e76c_row2_col3" class="data row2 col3">14.9610</td>
<td id="T_3e76c_row2_col4" class="data row2 col4">221.4270</td>
<td id="T_3e76c_row2_col5" class="data row2 col5">5.3050</td>
</tr>
<tr class="even">
<th id="T_3e76c_level0_row3" class="row_heading level0 row3">2000-06-15 18:30:00</th>
<td id="T_3e76c_row3_col0" class="data row3 col0">14.7830</td>
<td id="T_3e76c_row3_col1" class="data row3 col1">150.6500</td>
<td id="T_3e76c_row3_col2" class="data row3 col2">5.7100</td>
<td id="T_3e76c_row3_col3" class="data row3 col3">14.8720</td>
<td id="T_3e76c_row3_col4" class="data row3 col4">186.3800</td>
<td id="T_3e76c_row3_col5" class="data row3 col5">5.5070</td>
</tr>
<tr class="odd">
<th id="T_3e76c_level0_row4" class="row_heading level0 row4">2000-06-15 19:00:00</th>
<td id="T_3e76c_row4_col0" class="data row4 col0">14.6940</td>
<td id="T_3e76c_row4_col1" class="data row4 col1">114.8490</td>
<td id="T_3e76c_row4_col2" class="data row4 col2">5.9120</td>
<td id="T_3e76c_row4_col3" class="data row4 col3">14.7830</td>
<td id="T_3e76c_row4_col4" class="data row4 col4">150.6500</td>
<td id="T_3e76c_row4_col5" class="data row4 col5">5.7100</td>
</tr>
<tr class="even">
<th id="T_3e76c_level0_row5" class="row_heading level0 row5">2000-06-15 19:30:00</th>
<td id="T_3e76c_row5_col0" class="data row5 col0">14.6060</td>
<td id="T_3e76c_row5_col1" class="data row5 col1">34.7280</td>
<td id="T_3e76c_row5_col2" class="data row5 col2">6.1140</td>
<td id="T_3e76c_row5_col3" class="data row5 col3">14.6940</td>
<td id="T_3e76c_row5_col4" class="data row5 col4">114.8490</td>
<td id="T_3e76c_row5_col5" class="data row5 col5">5.9120</td>
</tr>
<tr class="odd">
<th id="T_3e76c_level0_row6" class="row_heading level0 row6">2000-06-15 20:00:00</th>
<td id="T_3e76c_row6_col0" class="data row6 col0">14.3800</td>
<td id="T_3e76c_row6_col1" class="data row6 col1">19.8430</td>
<td id="T_3e76c_row6_col2" class="data row6 col2">6.0740</td>
<td id="T_3e76c_row6_col3" class="data row6 col3">14.6060</td>
<td id="T_3e76c_row6_col4" class="data row6 col4">34.7280</td>
<td id="T_3e76c_row6_col5" class="data row6 col5">6.1140</td>
</tr>
<tr class="even">
<th id="T_3e76c_level0_row7" class="row_heading level0 row7">2000-06-15 20:30:00</th>
<td id="T_3e76c_row7_col0" class="data row7 col0">14.1550</td>
<td id="T_3e76c_row7_col1" class="data row7 col1">5.7120</td>
<td id="T_3e76c_row7_col2" class="data row7 col2">6.0340</td>
<td id="T_3e76c_row7_col3" class="data row7 col3">14.3800</td>
<td id="T_3e76c_row7_col4" class="data row7 col4">19.8430</td>
<td id="T_3e76c_row7_col5" class="data row7 col5">6.0740</td>
</tr>
<tr class="odd">
<th id="T_3e76c_level0_row8" class="row_heading level0 row8">2000-06-15 21:00:00</th>
<td id="T_3e76c_row8_col0" class="data row8 col0">13.9290</td>
<td id="T_3e76c_row8_col1" class="data row8 col1">0.0000</td>
<td id="T_3e76c_row8_col2" class="data row8 col2">5.9940</td>
<td id="T_3e76c_row8_col3" class="data row8 col3">14.1550</td>
<td id="T_3e76c_row8_col4" class="data row8 col4">5.7120</td>
<td id="T_3e76c_row8_col5" class="data row8 col5">6.0340</td>
</tr>
<tr class="even">
<th id="T_3e76c_level0_row9" class="row_heading level0 row9">2000-06-15 21:30:00</th>
<td id="T_3e76c_row9_col0" class="data row9 col0">13.7040</td>
<td id="T_3e76c_row9_col1" class="data row9 col1">0.0000</td>
<td id="T_3e76c_row9_col2" class="data row9 col2">5.9540</td>
<td id="T_3e76c_row9_col3" class="data row9 col3">13.9290</td>
<td id="T_3e76c_row9_col4" class="data row9 col4">0.0000</td>
<td id="T_3e76c_row9_col5" class="data row9 col5">5.9940</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>tfms3 <span class="op">=</span> TfmdLists(tfms1.items, [<span class="op">*</span>tfms2.fs, MeteoImpDf2Tensor()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>tfms3[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div><p style="font-size: 1.2rem;">data</p> <pre>tensor([[ 14.2200, 224.8000,   5.7990],
        [ 14.1100, 195.2800,   6.5770],
        [ 14.2300, 244.1700,   6.9310],
        [ 14.4000, 253.9200,   7.2860],
        [ 14.0900, 177.3100,   7.2510],
        [ 13.7100,  97.0700,   6.6830],
        [ 13.0800,  39.7100,   5.8510],
        [ 12.4100,  10.6500,   5.2540],
        [ 12.2700,   0.3200,   5.1640],
        [ 12.2000,   0.0000,   5.0370]])</pre> </div><div><p style="font-size: 1.2rem;">mask</p> <pre>tensor([[ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]])</pre> </div><div><p style="font-size: 1.2rem;">control</p> <pre>tensor([[ 15.0500, 255.1930,   5.1020,  15.1390, 287.1000,   4.9000],
        [ 14.9610, 221.4270,   5.3050,  15.0500, 255.1930,   5.1020],
        [ 14.8720, 186.3800,   5.5070,  14.9610, 221.4270,   5.3050],
        [ 14.7830, 150.6500,   5.7100,  14.8720, 186.3800,   5.5070],
        [ 14.6940, 114.8490,   5.9120,  14.7830, 150.6500,   5.7100],
        [ 14.6060,  34.7280,   6.1140,  14.6940, 114.8490,   5.9120],
        [ 14.3800,  19.8430,   6.0740,  14.6060,  34.7280,   6.1140],
        [ 14.1550,   5.7120,   6.0340,  14.3800,  19.8430,   6.0740],
        [ 13.9290,   0.0000,   5.9940,  14.1550,   5.7120,   6.0340],
        [ 13.7040,   0.0000,   5.9540,  13.9290,   0.0000,   5.9940]])</pre> </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(tfms3[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.MeteoImpTensor</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tfms3.decode(tfms3[0])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalize" class="level3">
<h3 class="anchored" data-anchor-id="normalize">5) Normalize</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>collections.namedtuple</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;function collections.namedtuple(typename, field_names, *, rename=False, defaults=None, module=None)&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>nt <span class="op">=</span> collections.namedtuple(<span class="st">"nt"</span>, <span class="st">"a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="bu">isinstance</span>(nt(<span class="dv">1</span>), <span class="bu">tuple</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L424" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="normalsparams" class="level3">
<h3 class="anchored" data-anchor-id="normalsparams">NormalsParams</h3>
<blockquote class="blockquote">
<pre><code> NormalsParams (*args)</code></pre>
</blockquote>
<p>Built-in mutable sequence.</p>
<p>If no argument is given, the constructor creates a new empty list. The argument must be an iterable if specified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>NormalsParams(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.NormalsParams(mean=0, std=1)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L448" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_stats" class="level3">
<h3 class="anchored" data-anchor-id="get_stats">get_stats</h3>
<blockquote class="blockquote">
<pre><code> get_stats (df, repeat=1, device='cpu')</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L452" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="meteoimpnormalize" class="level3">
<h3 class="anchored" data-anchor-id="meteoimpnormalize">MeteoImpNormalize</h3>
<blockquote class="blockquote">
<pre><code> MeteoImpNormalize (mean_data, std_data, mean_control, std_control)</code></pre>
</blockquote>
<p>Normalize/denorm MeteoImpTensor column-wise</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> MeteoImpNormalize(<span class="op">*</span>get_stats(hai), <span class="op">*</span>get_stats(hai_era,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>tfms3[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div><p style="font-size: 1.2rem;">data</p> <pre>tensor([[ 14.2200, 224.8000,   5.7990],
        [ 14.1100, 195.2800,   6.5770],
        [ 14.2300, 244.1700,   6.9310],
        [ 14.4000, 253.9200,   7.2860],
        [ 14.0900, 177.3100,   7.2510],
        [ 13.7100,  97.0700,   6.6830],
        [ 13.0800,  39.7100,   5.8510],
        [ 12.4100,  10.6500,   5.2540],
        [ 12.2700,   0.3200,   5.1640],
        [ 12.2000,   0.0000,   5.0370]])</pre> </div><div><p style="font-size: 1.2rem;">mask</p> <pre>tensor([[ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]])</pre> </div><div><p style="font-size: 1.2rem;">control</p> <pre>tensor([[ 15.0500, 255.1930,   5.1020,  15.1390, 287.1000,   4.9000],
        [ 14.9610, 221.4270,   5.3050,  15.0500, 255.1930,   5.1020],
        [ 14.8720, 186.3800,   5.5070,  14.9610, 221.4270,   5.3050],
        [ 14.7830, 150.6500,   5.7100,  14.8720, 186.3800,   5.5070],
        [ 14.6940, 114.8490,   5.9120,  14.7830, 150.6500,   5.7100],
        [ 14.6060,  34.7280,   6.1140,  14.6940, 114.8490,   5.9120],
        [ 14.3800,  19.8430,   6.0740,  14.6060,  34.7280,   6.1140],
        [ 14.1550,   5.7120,   6.0340,  14.3800,  19.8430,   6.0740],
        [ 13.9290,   0.0000,   5.9940,  14.1550,   5.7120,   6.0340],
        [ 13.7040,   0.0000,   5.9540,  13.9290,   0.0000,   5.9940]])</pre> </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>norm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
  <p>
    <strong>MeteoImpNormalize -- {'mean_data': tensor([  8.3339, 120.9578,   3.3807]), 'std_data': tensor([  7.9246, 204.0026,   4.3684]), 'mean_control': tensor([  8.1948, 120.6864,   3.3253,   8.1948, 120.6864,   3.3253]), 'std_control': tensor([  7.5459, 187.1730,   3.6871,   7.5459, 187.1730,   3.6871])}</strong>
  </p>
  <p>(MeteoImpTensor,object) -&gt; encodes
</p>
  <p>(MeteoImpTensor,object) -&gt; decodes
(NormalsParams,object) -&gt; decodes
</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>norm(tfms3[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div><p style="font-size: 1.2rem;">data</p> <pre>tensor([[ 0.7428,  0.5090,  0.5536],
        [ 0.7289,  0.3643,  0.7317],
        [ 0.7440,  0.6040,  0.8127],
        [ 0.7655,  0.6518,  0.8940],
        [ 0.7264,  0.2762,  0.8860],
        [ 0.6784, -0.1171,  0.7560],
        [ 0.5989, -0.3983,  0.5655],
        [ 0.5144, -0.5407,  0.4288],
        [ 0.4967, -0.5914,  0.4082],
        [ 0.4879, -0.5929,  0.3792]])</pre> </div><div><p style="font-size: 1.2rem;">mask</p> <pre>tensor([[ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]])</pre> </div><div><p style="font-size: 1.2rem;">control</p> <pre>tensor([[ 0.9085,  0.7186,  0.4819,  0.9203,  0.8891,  0.4271],
        [ 0.8967,  0.5382,  0.5369,  0.9085,  0.7186,  0.4819],
        [ 0.8849,  0.3510,  0.5917,  0.8967,  0.5382,  0.5369],
        [ 0.8731,  0.1601,  0.6468,  0.8849,  0.3510,  0.5917],
        [ 0.8613, -0.0312,  0.7015,  0.8731,  0.1601,  0.6468],
        [ 0.8496, -0.4592,  0.7563,  0.8613, -0.0312,  0.7015],
        [ 0.8197, -0.5388,  0.7455,  0.8496, -0.4592,  0.7563],
        [ 0.7899, -0.6143,  0.7346,  0.8197, -0.5388,  0.7455],
        [ 0.7599, -0.6448,  0.7238,  0.7899, -0.6143,  0.7346],
        [ 0.7301, -0.6448,  0.7129,  0.7599, -0.6448,  0.7238]])</pre> </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>test_close(norm.decode(norm(tfms3[<span class="dv">0</span>]))[<span class="dv">0</span>], tfms3[<span class="dv">0</span>][<span class="dv">0</span>], eps<span class="op">=</span><span class="fl">2e-5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test that NormalsParams decode actually works</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>Npars <span class="op">=</span> NormalsParams(torch.tensor(<span class="dv">1</span>), torch.tensor(<span class="fl">.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>norm.decode(Npars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.NormalsParams(mean=tensor([ 16.2585, 324.9604,   7.7491]), std=tensor([ 0.7925, 20.4003,  0.4368]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>tfms4 <span class="op">=</span> TfmdLists(tfms3.items, [<span class="op">*</span>tfms3.fs,MeteoImpNormalize(<span class="op">*</span>get_stats(hai),<span class="op">*</span>get_stats(hai_era, <span class="dv">2</span>) ) ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>tfms4[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div><p style="font-size: 1.2rem;">data</p> <pre>tensor([[ 0.7428,  0.5090,  0.5536],
        [ 0.7289,  0.3643,  0.7317],
        [ 0.7440,  0.6040,  0.8127],
        [ 0.7655,  0.6518,  0.8940],
        [ 0.7264,  0.2762,  0.8860],
        [ 0.6784, -0.1171,  0.7560],
        [ 0.5989, -0.3983,  0.5655],
        [ 0.5144, -0.5407,  0.4288],
        [ 0.4967, -0.5914,  0.4082],
        [ 0.4879, -0.5929,  0.3792]])</pre> </div><div><p style="font-size: 1.2rem;">mask</p> <pre>tensor([[ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]])</pre> </div><div><p style="font-size: 1.2rem;">control</p> <pre>tensor([[ 0.9085,  0.7186,  0.4819,  0.9203,  0.8891,  0.4271],
        [ 0.8967,  0.5382,  0.5369,  0.9085,  0.7186,  0.4819],
        [ 0.8849,  0.3510,  0.5917,  0.8967,  0.5382,  0.5369],
        [ 0.8731,  0.1601,  0.6468,  0.8849,  0.3510,  0.5917],
        [ 0.8613, -0.0312,  0.7015,  0.8731,  0.1601,  0.6468],
        [ 0.8496, -0.4592,  0.7563,  0.8613, -0.0312,  0.7015],
        [ 0.8197, -0.5388,  0.7455,  0.8496, -0.4592,  0.7563],
        [ 0.7899, -0.6143,  0.7346,  0.8197, -0.5388,  0.7455],
        [ 0.7599, -0.6448,  0.7238,  0.7899, -0.6143,  0.7346],
        [ 0.7301, -0.6448,  0.7129,  0.7599, -0.6448,  0.7238]])</pre> </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>tfms4.decode(tfms4[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div><p style="font-size: 1.2rem;">data</p> <pre>tensor([[ 14.2200, 224.8000,   5.7990],
        [ 14.1100, 195.2800,   6.5770],
        [ 14.2300, 244.1700,   6.9310],
        [ 14.4000, 253.9200,   7.2860],
        [ 14.0900, 177.3100,   7.2510],
        [ 13.7100,  97.0700,   6.6830],
        [ 13.0800,  39.7100,   5.8510],
        [ 12.4100,  10.6500,   5.2540],
        [ 12.2700,   0.3200,   5.1640],
        [ 12.2000,   0.0000,   5.0370]])</pre> </div><div><p style="font-size: 1.2rem;">mask</p> <pre>tensor([[ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]])</pre> </div><div><p style="font-size: 1.2rem;">control</p> <pre>tensor([[ 1.5050e+01,  2.5519e+02,  5.1020e+00,  1.5139e+01,  2.8710e+02,
          4.9000e+00],
        [ 1.4961e+01,  2.2143e+02,  5.3050e+00,  1.5050e+01,  2.5519e+02,
          5.1020e+00],
        [ 1.4872e+01,  1.8638e+02,  5.5070e+00,  1.4961e+01,  2.2143e+02,
          5.3050e+00],
        [ 1.4783e+01,  1.5065e+02,  5.7100e+00,  1.4872e+01,  1.8638e+02,
          5.5070e+00],
        [ 1.4694e+01,  1.1485e+02,  5.9120e+00,  1.4783e+01,  1.5065e+02,
          5.7100e+00],
        [ 1.4606e+01,  3.4728e+01,  6.1140e+00,  1.4694e+01,  1.1485e+02,
          5.9120e+00],
        [ 1.4380e+01,  1.9843e+01,  6.0740e+00,  1.4606e+01,  3.4728e+01,
          6.1140e+00],
        [ 1.4155e+01,  5.7120e+00,  6.0340e+00,  1.4380e+01,  1.9843e+01,
          6.0740e+00],
        [ 1.3929e+01, -7.6294e-06,  5.9940e+00,  1.4155e+01,  5.7120e+00,
          6.0340e+00],
        [ 1.3704e+01, -7.6294e-06,  5.9540e+00,  1.3929e+01, -7.6294e-06,
          5.9940e+00]])</pre> </div></div>
</div>
</div>
<p>is workinggggggggggggggggg</p>
</section>
<section id="to-tuple" class="level3">
<h3 class="anchored" data-anchor-id="to-tuple">6) To Tuple</h3>
<p>Fastai likes to work with tuples (in particular for collating)… for now convert to a tuple. Maybe find a way to mimic a tuple in <a href="https://mone27.github.io/meteo_imp/lib/kalman/fastai.html#meteoimptensor"><code>MeteoImpTensor</code></a></p>
<p>also duplicate the data, so it becomes training and label</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L474" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="totuple" class="level3">
<h3 class="anchored" data-anchor-id="totuple">ToTuple</h3>
<blockquote class="blockquote">
<pre><code> ToTuple (enc=None, dec=None, split_idx=None, order=None)</code></pre>
</blockquote>
<p>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<code>encodes</code>,<code>decodes</code>,<code>setups</code>) if <code>split_idx</code> matches</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>ToTuple()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
  <p>
    <strong>ToTuple</strong>
  </p>
  <p>(object,object) -&gt; encodes
</p>
  <p>(object,object) -&gt; decodes
</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>tfms5 <span class="op">=</span> TfmdLists(tfms4.items, [<span class="op">*</span>tfms4.fs,ToTuple])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>tfms5[<span class="dv">0</span>]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pipeline" class="level3">
<h3 class="anchored" data-anchor-id="pipeline">Pipeline</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>block_len <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>control_lags <span class="op">=</span> [<span class="dv">1</span>]</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>control_repeat <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="bu">len</span>(control_lags)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>block_ids <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">max</span>(control_lags), (<span class="bu">len</span>(hai) <span class="op">//</span> block_len) <span class="op">-</span> <span class="dv">1</span>))[:<span class="dv">10</span>]</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>gap_len <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>var_sel <span class="op">=</span> [<span class="st">'TA'</span>,<span class="st">'SW_IN'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L482" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="imp_pipeline" class="level3">
<h3 class="anchored" data-anchor-id="imp_pipeline">imp_pipeline</h3>
<blockquote class="blockquote">
<pre><code> imp_pipeline (df, control, var_sel, gap_len, block_len, control_lags,
               n_rep)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>pipeline, block_ids <span class="op">=</span> imp_pipeline(hai, hai_era, var_sel, gap_len, block_len, control_lags, n_rep<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[BlockIndexTransform:
 encodes: (list,object) -&gt; encodes
 decodes: ,
 BlockDfTransform:
 encodes: (DatetimeIndex,object) -&gt; encodes
 decodes: ,
 AddGapTransform:
 encodes: (DataControl,object) -&gt; encodes
 decodes: ,
 __main__.MeteoImpDf2Tensor,
 MeteoImpNormalize -- {'mean_data': tensor([  8.3339, 120.9578,   3.3807]), 'std_data': tensor([  7.9246, 204.0026,   4.3684]), 'mean_control': tensor([  8.1948, 120.6864,   3.3253,   8.1948, 120.6864,   3.3253]), 'std_control': tensor([  7.5459, 187.1730,   3.6871,   7.5459, 187.1730,   3.6871])}:
 encodes: (MeteoImpTensor,object) -&gt; encodes
 decodes: (MeteoImpTensor,object) -&gt; decodes
 (NormalsParams,object) -&gt; decodes,
 __main__.ToTuple]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>pp <span class="op">=</span> Pipeline(pipeline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>pp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Pipeline: BlockIndexTransform -&gt; BlockDfTransform -&gt; AddGapTransform -&gt; MeteoImpDf2Tensor -&gt; MeteoImpNormalize -- {'mean_data': tensor([  8.3339, 120.9578,   3.3807]), 'std_data': tensor([  7.9246, 204.0026,   4.3684]), 'mean_control': tensor([  8.1948, 120.6864,   3.3253,   8.1948, 120.6864,   3.3253]), 'std_control': tensor([  7.5459, 187.1730,   3.6871,   7.5459, 187.1730,   3.6871])} -&gt; ToTuple</code></pre>
</div>
</div>
</section>
<section id="dataloader" class="level3">
<h3 class="anchored" data-anchor-id="dataloader">Dataloader</h3>
<p>random splitter for validation/training set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>reset_seed()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>splits <span class="op">=</span> EndSplitter()(block_ids) <span class="co"># last 80% is test data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Repeat twice the pipeline since is the same pipeline both for training data and for labels.</p>
<p>In theory could optimize the label creation and get the data only from the gap and not the control, but for now it works and the overhead is minimal</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> TfmdLists(block_ids, pipeline, splits<span class="op">=</span>splits).dataloaders(bs<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>dls.one_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>((tensor([[[-0.3298, -0.5929, -0.5640],
           [-0.3563, -0.5929, -0.6420],
           [-0.3387, -0.5929, -0.6720],
           [-0.3261, -0.5929, -0.6722],
           [-0.3248, -0.5929, -0.6924],
           [-0.3172, -0.5929, -0.7105],
           [-0.3071, -0.5929, -0.7066],
           [-0.2933, -0.5929, -0.6883],
           [-0.2907, -0.5767, -0.6901],
           [-0.2882, -0.5386, -0.6929]],
  
          [[-0.7097, -0.3020, -0.7189],
           [-0.6971, -0.3474, -0.7192],
           [-0.6857, -0.2052, -0.7045],
           [-0.6630, -0.0902, -0.6656],
           [-0.6390,  0.0122, -0.6276],
           [-0.6062,  0.4852, -0.5859],
           [-0.5709,  0.7880, -0.5388],
           [-0.5406,  0.5899, -0.5024],
           [-0.5267,  0.4234, -0.5015],
           [-0.4901,  0.7530, -0.4832]]], device='cuda:0'),
  tensor([[[ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [False, False,  True],
           [False, False,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True]],
  
          [[ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [False, False,  True],
           [False, False,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True]]], device='cuda:0'),
  tensor([[[-0.3028, -0.6448, -0.5905, -0.2960, -0.6448, -0.5485],
           [-0.3097, -0.6448, -0.6326, -0.3028, -0.6448, -0.5905],
           [-0.3166, -0.6448, -0.6743, -0.3097, -0.6448, -0.6326],
           [-0.3235, -0.6448, -0.7164, -0.3166, -0.6448, -0.6743],
           [-0.3224, -0.6448, -0.7188, -0.3235, -0.6448, -0.7164],
           [-0.3213, -0.6448, -0.7213, -0.3224, -0.6448, -0.7188],
           [-0.3203, -0.6448, -0.7240, -0.3213, -0.6448, -0.7213],
           [-0.3192, -0.6448, -0.7264, -0.3203, -0.6448, -0.7240],
           [-0.3182, -0.6401, -0.7288, -0.3192, -0.6448, -0.7264],
           [-0.3171, -0.6114, -0.7313, -0.3182, -0.6401, -0.7288]],
  
          [[-0.5342, -0.5229, -0.6567, -0.5343, -0.5707, -0.6594],
           [-0.5342, -0.2773, -0.6540, -0.5342, -0.5229, -0.6567],
           [-0.5021, -0.1783, -0.6084, -0.5342, -0.2773, -0.6540],
           [-0.4702, -0.0844, -0.5629, -0.5021, -0.1783, -0.6084],
           [-0.4381,  0.0029, -0.5173, -0.4702, -0.0844, -0.5629],
           [-0.4060,  0.0821, -0.4717, -0.4381,  0.0029, -0.5173],
           [-0.3741,  0.1518, -0.4262, -0.4060,  0.0821, -0.4717],
           [-0.3420,  0.4581, -0.3806, -0.3741,  0.1518, -0.4262],
           [-0.3166,  0.5191, -0.3532, -0.3420,  0.4581, -0.3806],
           [-0.2911,  0.5640, -0.3261, -0.3166,  0.5191, -0.3532]]],
         device='cuda:0')),
 (tensor([[[-0.3298, -0.5929, -0.5640],
           [-0.3563, -0.5929, -0.6420],
           [-0.3387, -0.5929, -0.6720],
           [-0.3261, -0.5929, -0.6722],
           [-0.3248, -0.5929, -0.6924],
           [-0.3172, -0.5929, -0.7105],
           [-0.3071, -0.5929, -0.7066],
           [-0.2933, -0.5929, -0.6883],
           [-0.2907, -0.5767, -0.6901],
           [-0.2882, -0.5386, -0.6929]],
  
          [[-0.7097, -0.3020, -0.7189],
           [-0.6971, -0.3474, -0.7192],
           [-0.6857, -0.2052, -0.7045],
           [-0.6630, -0.0902, -0.6656],
           [-0.6390,  0.0122, -0.6276],
           [-0.6062,  0.4852, -0.5859],
           [-0.5709,  0.7880, -0.5388],
           [-0.5406,  0.5899, -0.5024],
           [-0.5267,  0.4234, -0.5015],
           [-0.4901,  0.7530, -0.4832]]], device='cuda:0'),
  tensor([[[ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [False, False,  True],
           [False, False,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True]],
  
          [[ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [False, False,  True],
           [False, False,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True]]], device='cuda:0'),
  tensor([[[-0.3028, -0.6448, -0.5905, -0.2960, -0.6448, -0.5485],
           [-0.3097, -0.6448, -0.6326, -0.3028, -0.6448, -0.5905],
           [-0.3166, -0.6448, -0.6743, -0.3097, -0.6448, -0.6326],
           [-0.3235, -0.6448, -0.7164, -0.3166, -0.6448, -0.6743],
           [-0.3224, -0.6448, -0.7188, -0.3235, -0.6448, -0.7164],
           [-0.3213, -0.6448, -0.7213, -0.3224, -0.6448, -0.7188],
           [-0.3203, -0.6448, -0.7240, -0.3213, -0.6448, -0.7213],
           [-0.3192, -0.6448, -0.7264, -0.3203, -0.6448, -0.7240],
           [-0.3182, -0.6401, -0.7288, -0.3192, -0.6448, -0.7264],
           [-0.3171, -0.6114, -0.7313, -0.3182, -0.6401, -0.7288]],
  
          [[-0.5342, -0.5229, -0.6567, -0.5343, -0.5707, -0.6594],
           [-0.5342, -0.2773, -0.6540, -0.5342, -0.5229, -0.6567],
           [-0.5021, -0.1783, -0.6084, -0.5342, -0.2773, -0.6540],
           [-0.4702, -0.0844, -0.5629, -0.5021, -0.1783, -0.6084],
           [-0.4381,  0.0029, -0.5173, -0.4702, -0.0844, -0.5629],
           [-0.4060,  0.0821, -0.4717, -0.4381,  0.0029, -0.5173],
           [-0.3741,  0.1518, -0.4262, -0.4060,  0.0821, -0.4717],
           [-0.3420,  0.4581, -0.3806, -0.3741,  0.1518, -0.4262],
           [-0.3166,  0.5191, -0.3532, -0.3420,  0.4581, -0.3806],
           [-0.2911,  0.5640, -0.3261, -0.3166,  0.5191, -0.3532]]],
         device='cuda:0')))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>dls.device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>device(type='cuda', index=0)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="at">@typedispatch</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_batch(x: <span class="bu">tuple</span>, y, samples, ctxs<span class="op">=</span><span class="va">None</span>, max_n<span class="op">=</span><span class="dv">6</span>):</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dls.show_batch()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>dls._types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{tuple: [{tuple: [torch.Tensor, torch.Tensor, torch.Tensor]},
  {tuple: [torch.Tensor, torch.Tensor, torch.Tensor]}]}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.foundation <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>delegates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;function fastcore.meta.delegates(to: function = None, keep=False, but: list = None)&gt;</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L503" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="imp_dataloader" class="level3">
<h3 class="anchored" data-anchor-id="imp_dataloader">imp_dataloader</h3>
<blockquote class="blockquote">
<pre><code> imp_dataloader (df, control, var_sel, gap_len, block_len, control_lags,
                 n_rep, bs)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>imp_dataloader</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;function __main__.imp_dataloader(df, control, var_sel, gap_len, block_len, control_lags, n_rep, bs)&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> imp_dataloader(hai, hai_era, var_sel, gap_len<span class="op">=</span><span class="dv">10</span>, block_len<span class="op">=</span><span class="dv">200</span>, control_lags<span class="op">=</span>[<span class="dv">1</span>], n_rep <span class="op">=</span> <span class="dv">20</span>, bs<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>dls.one_batch()[<span class="dv">0</span>][<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> dls.cpu()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<section id="forward-function" class="level3">
<h3 class="anchored" data-anchor-id="forward-function">Forward Function</h3>
<p>in order to the a pytorch module we need a forward method to the kalman filter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KalmanFilter.init_random(n_dim_obs <span class="op">=</span> hai.shape[<span class="op">-</span><span class="dv">1</span>], n_dim_state <span class="op">=</span> hai.shape[<span class="op">-</span><span class="dv">1</span>], n_dim_contr <span class="op">=</span> hai_era.shape[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>control_repeat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>control_repeat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table id="T_bcab1" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_bcab1_level0_col0" class="col_heading level0 col0">state</th>
<th id="T_bcab1_level0_col1" class="col_heading level0 col1">x_0</th>
<th id="T_bcab1_level0_col2" class="col_heading level0 col2">x_1</th>
<th id="T_bcab1_level0_col3" class="col_heading level0 col3">x_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_bcab1_row0_col0" class="data row0 col0">x_0</td>
<td id="T_bcab1_row0_col1" class="data row0 col1">0.2617</td>
<td id="T_bcab1_row0_col2" class="data row0 col2">0.7972</td>
<td id="T_bcab1_row0_col3" class="data row0 col3">0.2088</td>
</tr>
<tr class="even">
<td id="T_bcab1_row1_col0" class="data row1 col0">x_1</td>
<td id="T_bcab1_row1_col1" class="data row1 col1">0.4545</td>
<td id="T_bcab1_row1_col2" class="data row1 col2">0.1455</td>
<td id="T_bcab1_row1_col3" class="data row1 col3">0.2249</td>
</tr>
<tr class="odd">
<td id="T_bcab1_row2_col0" class="data row2 col0">x_2</td>
<td id="T_bcab1_row2_col1" class="data row2 col1">0.7409</td>
<td id="T_bcab1_row2_col2" class="data row2 col2">0.2881</td>
<td id="T_bcab1_row2_col3" class="data row2 col3">0.6578</td>
</tr>
</tbody>
</table>
<div>
<p>trans cov (Q)</p>
<table id="T_99b09" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_99b09_level0_col0" class="col_heading level0 col0">state</th>
<th id="T_99b09_level0_col1" class="col_heading level0 col1">x_0</th>
<th id="T_99b09_level0_col2" class="col_heading level0 col2">x_1</th>
<th id="T_99b09_level0_col3" class="col_heading level0 col3">x_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_99b09_row0_col0" class="data row0 col0">x_0</td>
<td id="T_99b09_row0_col1" class="data row0 col1">1.4719</td>
<td id="T_99b09_row0_col2" class="data row0 col2">0.8886</td>
<td id="T_99b09_row0_col3" class="data row0 col3">1.3107</td>
</tr>
<tr class="even">
<td id="T_99b09_row1_col0" class="data row1 col0">x_1</td>
<td id="T_99b09_row1_col1" class="data row1 col1">0.8886</td>
<td id="T_99b09_row1_col2" class="data row1 col2">0.6666</td>
<td id="T_99b09_row1_col3" class="data row1 col3">0.7005</td>
</tr>
<tr class="odd">
<td id="T_99b09_row2_col0" class="data row2 col0">x_2</td>
<td id="T_99b09_row2_col1" class="data row2 col1">1.3107</td>
<td id="T_99b09_row2_col2" class="data row2 col2">0.7005</td>
<td id="T_99b09_row2_col3" class="data row2 col3">1.2385</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>trans off</p>
<table id="T_e1908" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_e1908_level0_col0" class="col_heading level0 col0">state</th>
<th id="T_e1908_level0_col1" class="col_heading level0 col1">offset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_e1908_row0_col0" class="data row0 col0">x_0</td>
<td id="T_e1908_row0_col1" class="data row0 col1">0.9087</td>
</tr>
<tr class="even">
<td id="T_e1908_row1_col0" class="data row1 col0">x_1</td>
<td id="T_e1908_row1_col1" class="data row1 col1">0.6871</td>
</tr>
<tr class="odd">
<td id="T_e1908_row2_col0" class="data row2 col0">x_2</td>
<td id="T_e1908_row2_col1" class="data row2 col1">0.5610</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>obs matrix (H)</p>
<table id="T_a3ee9" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_a3ee9_level0_col0" class="col_heading level0 col0">variable</th>
<th id="T_a3ee9_level0_col1" class="col_heading level0 col1">x_0</th>
<th id="T_a3ee9_level0_col2" class="col_heading level0 col2">x_1</th>
<th id="T_a3ee9_level0_col3" class="col_heading level0 col3">x_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_a3ee9_row0_col0" class="data row0 col0">y_0</td>
<td id="T_a3ee9_row0_col1" class="data row0 col1">0.1391</td>
<td id="T_a3ee9_row0_col2" class="data row0 col2">0.5222</td>
<td id="T_a3ee9_row0_col3" class="data row0 col3">0.8191</td>
</tr>
<tr class="even">
<td id="T_a3ee9_row1_col0" class="data row1 col0">y_1</td>
<td id="T_a3ee9_row1_col1" class="data row1 col1">0.7040</td>
<td id="T_a3ee9_row1_col2" class="data row1 col2">0.3264</td>
<td id="T_a3ee9_row1_col3" class="data row1 col3">0.0842</td>
</tr>
<tr class="odd">
<td id="T_a3ee9_row2_col0" class="data row2 col0">y_2</td>
<td id="T_a3ee9_row2_col1" class="data row2 col1">0.5963</td>
<td id="T_a3ee9_row2_col2" class="data row2 col2">0.4742</td>
<td id="T_a3ee9_row2_col3" class="data row2 col3">0.9001</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>obs cov (R)</p>
<table id="T_a50e6" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_a50e6_level0_col0" class="col_heading level0 col0">variable</th>
<th id="T_a50e6_level0_col1" class="col_heading level0 col1">y_0</th>
<th id="T_a50e6_level0_col2" class="col_heading level0 col2">y_1</th>
<th id="T_a50e6_level0_col3" class="col_heading level0 col3">y_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_a50e6_row0_col0" class="data row0 col0">y_0</td>
<td id="T_a50e6_row0_col1" class="data row0 col1">0.1128</td>
<td id="T_a50e6_row0_col2" class="data row0 col2">0.0000</td>
<td id="T_a50e6_row0_col3" class="data row0 col3">0.0000</td>
</tr>
<tr class="even">
<td id="T_a50e6_row1_col0" class="data row1 col0">y_1</td>
<td id="T_a50e6_row1_col1" class="data row1 col1">0.0000</td>
<td id="T_a50e6_row1_col2" class="data row1 col2">1.2363</td>
<td id="T_a50e6_row1_col3" class="data row1 col3">0.0000</td>
</tr>
<tr class="odd">
<td id="T_a50e6_row2_col0" class="data row2 col0">y_2</td>
<td id="T_a50e6_row2_col1" class="data row2 col1">0.0000</td>
<td id="T_a50e6_row2_col2" class="data row2 col2">0.0000</td>
<td id="T_a50e6_row2_col3" class="data row2 col3">1.1188</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>obs off</p>
<table id="T_02147" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_02147_level0_col0" class="col_heading level0 col0">variable</th>
<th id="T_02147_level0_col1" class="col_heading level0 col1">offset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_02147_row0_col0" class="data row0 col0">y_0</td>
<td id="T_02147_row0_col1" class="data row0 col1">0.3308</td>
</tr>
<tr class="even">
<td id="T_02147_row1_col0" class="data row1 col0">y_1</td>
<td id="T_02147_row1_col1" class="data row1 col1">0.7610</td>
</tr>
<tr class="odd">
<td id="T_02147_row2_col0" class="data row2 col0">y_2</td>
<td id="T_02147_row2_col1" class="data row2 col1">0.3228</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>contr matrix (B)</p>
<table id="T_701e4" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_701e4_level0_col0" class="col_heading level0 col0">state</th>
<th id="T_701e4_level0_col1" class="col_heading level0 col1">c_0</th>
<th id="T_701e4_level0_col2" class="col_heading level0 col2">c_1</th>
<th id="T_701e4_level0_col3" class="col_heading level0 col3">c_2</th>
<th id="T_701e4_level0_col4" class="col_heading level0 col4">c_3</th>
<th id="T_701e4_level0_col5" class="col_heading level0 col5">c_4</th>
<th id="T_701e4_level0_col6" class="col_heading level0 col6">c_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_701e4_row0_col0" class="data row0 col0">x_0</td>
<td id="T_701e4_row0_col1" class="data row0 col1">0.2558</td>
<td id="T_701e4_row0_col2" class="data row0 col2">0.7570</td>
<td id="T_701e4_row0_col3" class="data row0 col3">0.3952</td>
<td id="T_701e4_row0_col4" class="data row0 col4">0.8095</td>
<td id="T_701e4_row0_col5" class="data row0 col5">0.3729</td>
<td id="T_701e4_row0_col6" class="data row0 col6">0.3451</td>
</tr>
<tr class="even">
<td id="T_701e4_row1_col0" class="data row1 col0">x_1</td>
<td id="T_701e4_row1_col1" class="data row1 col1">0.2511</td>
<td id="T_701e4_row1_col2" class="data row1 col2">0.4720</td>
<td id="T_701e4_row1_col3" class="data row1 col3">0.6684</td>
<td id="T_701e4_row1_col4" class="data row1 col4">0.1905</td>
<td id="T_701e4_row1_col5" class="data row1 col5">0.1489</td>
<td id="T_701e4_row1_col6" class="data row1 col6">0.6714</td>
</tr>
<tr class="odd">
<td id="T_701e4_row2_col0" class="data row2 col0">x_2</td>
<td id="T_701e4_row2_col1" class="data row2 col1">0.4719</td>
<td id="T_701e4_row2_col2" class="data row2 col2">0.5053</td>
<td id="T_701e4_row2_col3" class="data row2 col3">0.4909</td>
<td id="T_701e4_row2_col4" class="data row2 col4">0.7793</td>
<td id="T_701e4_row2_col5" class="data row2 col5">0.3246</td>
<td id="T_701e4_row2_col6" class="data row2 col6">0.1249</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>init state mean</p>
<table id="T_2fa53" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_2fa53_level0_col0" class="col_heading level0 col0">state</th>
<th id="T_2fa53_level0_col1" class="col_heading level0 col1">mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_2fa53_row0_col0" class="data row0 col0">x_0</td>
<td id="T_2fa53_row0_col1" class="data row0 col1">0.4553</td>
</tr>
<tr class="even">
<td id="T_2fa53_row1_col0" class="data row1 col0">x_1</td>
<td id="T_2fa53_row1_col1" class="data row1 col1">0.5508</td>
</tr>
<tr class="odd">
<td id="T_2fa53_row2_col0" class="data row2 col0">x_2</td>
<td id="T_2fa53_row2_col1" class="data row2 col1">0.7966</td>
</tr>
</tbody>
</table>
</div>
<div>
<p>init state cov</p>
<table id="T_d8ae3" class="table table-sm table-striped">
<thead>
<tr class="header">
<th id="T_d8ae3_level0_col0" class="col_heading level0 col0">state</th>
<th id="T_d8ae3_level0_col1" class="col_heading level0 col1">x_0</th>
<th id="T_d8ae3_level0_col2" class="col_heading level0 col2">x_1</th>
<th id="T_d8ae3_level0_col3" class="col_heading level0 col3">x_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_d8ae3_row0_col0" class="data row0 col0">x_0</td>
<td id="T_d8ae3_row0_col1" class="data row0 col1">0.3718</td>
<td id="T_d8ae3_row0_col2" class="data row0 col2">0.1513</td>
<td id="T_d8ae3_row0_col3" class="data row0 col3">0.3717</td>
</tr>
<tr class="even">
<td id="T_d8ae3_row1_col0" class="data row1 col0">x_1</td>
<td id="T_d8ae3_row1_col1" class="data row1 col1">0.1513</td>
<td id="T_d8ae3_row1_col2" class="data row1 col2">0.1655</td>
<td id="T_d8ae3_row1_col3" class="data row1 col3">0.1530</td>
</tr>
<tr class="odd">
<td id="T_d8ae3_row2_col0" class="data row2 col0">x_2</td>
<td id="T_d8ae3_row2_col1" class="data row2 col1">0.3717</td>
<td id="T_d8ae3_row2_col2" class="data row2 col2">0.1530</td>
<td id="T_d8ae3_row2_col3" class="data row2 col3">0.6116</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>model._predict_filter(<span class="op">*</span>dls.one_batch()[<span class="dv">0</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L534" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="kalmanfilter.forward" class="level3">
<h3 class="anchored" data-anchor-id="kalmanfilter.forward">KalmanFilter.forward</h3>
<blockquote class="blockquote">
<pre><code> KalmanFilter.forward (meteo_data:__main__.MeteoImpTensor)</code></pre>
</blockquote>
<p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<p>.. note:: Although the recipe for forward pass needs to be defined within this function, one should call the :class:<code>Module</code> instance afterwards instead of this since the former takes care of running the registered hooks while the latter silently ignores them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="bu">input</span> <span class="op">=</span> dls.one_batch()[<span class="dv">0</span>]</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> dls.one_batch()[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>model.state_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>OrderedDict([('trans_matrix',
              tensor([[0.2617, 0.7972, 0.2088],
                      [0.4545, 0.1455, 0.2249],
                      [0.7409, 0.2881, 0.6578]])),
             ('trans_off', tensor([0.9087, 0.6871, 0.5610])),
             ('trans_cov_raw',
              tensor([[ 1.2132,  0.0000,  0.0000],
                      [ 0.7324,  0.3607,  0.0000],
                      [ 1.0803, -0.2516,  0.0897]])),
             ('contr_matrix',
              tensor([[0.2558, 0.7570, 0.3952, 0.8095, 0.3729, 0.3451],
                      [0.2511, 0.4720, 0.6684, 0.1905, 0.1489, 0.6714],
                      [0.4719, 0.5053, 0.4909, 0.7793, 0.3246, 0.1249]])),
             ('obs_matrix',
              tensor([[0.1391, 0.5222, 0.8191],
                      [0.7040, 0.3264, 0.0842],
                      [0.5963, 0.4742, 0.9001]])),
             ('obs_off', tensor([0.3308, 0.7610, 0.3228])),
             ('obs_cov_raw', tensor([-2.1824,  0.2121,  0.1123])),
             ('init_state_mean', tensor([0.4553, 0.5508, 0.7966])),
             ('init_state_cov_raw',
              tensor([[0.6097, 0.0000, 0.0000],
                      [0.2482, 0.3223, 0.0000],
                      [0.6097, 0.0050, 0.4897]]))])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="bu">input</span>[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="bu">input</span>[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>control <span class="op">=</span> <span class="bu">input</span>[<span class="dv">2</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>mask.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>data.device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>device(type='cpu')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>torch.device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.device</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>data.shape, mask.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([200, 3]), torch.Size([200, 3]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>model.predict(data.unsqueeze(<span class="dv">0</span>), mask.unsqueeze(<span class="dv">0</span>), control.unsqueeze(<span class="dv">0</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>model.use_smooth <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(<span class="bu">input</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>pred[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>pred[<span class="dv">1</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>model.use_smooth <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>pred_filt <span class="op">=</span> model(<span class="bu">input</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>pred_filt[<span class="dv">1</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.NormalsParams(mean=tensor([[[-1.0853e+00, -9.6977e-02, -1.6318e+00],
         [-1.6371e+00,  2.1869e-01, -1.8844e+00],
         [-1.6023e+00,  5.3288e-02, -1.9876e+00],
         ...,
         [-9.9819e-01,  3.6522e-01, -1.2074e+00],
         [-9.6037e-01,  4.0569e-01, -1.1560e+00],
         [-8.9643e-01,  4.6237e-01, -1.0614e+00]],

        [[-6.0812e-01,  1.5683e-01, -1.0101e+00],
         [-1.0547e+00,  4.1022e-01, -1.1796e+00],
         [-1.0146e+00,  2.0531e-01, -1.2966e+00],
         ...,
         [-7.8597e-01,  3.2919e-01, -9.8214e-01],
         [-7.5823e-01,  3.4013e-01, -9.3208e-01],
         [-8.4632e-01,  2.2772e-01, -1.0880e+00]],

        [[-1.6702e+00, -3.9161e-01, -2.3861e+00],
         [-2.3548e+00,  4.9082e-02, -2.7635e+00],
         [-2.3357e+00,  3.3406e-03, -2.8112e+00],
         ...,
         [-1.1320e+00,  2.5534e-01, -1.3752e+00],
         [-1.1150e+00,  2.5718e-01, -1.3406e+00],
         [-1.2732e+00,  8.3460e-02, -1.5935e+00]],

        ...,

        [[ 1.7310e-01,  5.5769e-01,  5.6446e-05],
         [-9.9485e-02,  6.7268e-01, -5.0982e-02],
         [-5.9461e-02,  4.1679e-01, -1.9211e-01],
         ...,
         [-9.8248e-01,  2.6596e-01, -1.2264e+00],
         [-9.8716e-01,  2.7125e-01, -1.2140e+00],
         [-1.1072e+00,  1.4848e-01, -1.4036e+00]],

        [[ 1.7675e-01,  6.0039e-01,  2.1625e-02],
         [-5.6660e-02,  7.4941e-01, -1.9557e-02],
         [-4.7743e-02,  5.3824e-01, -1.5286e-01],
         ...,
         [-7.9205e-01,  3.8394e-01, -1.0350e+00],
         [-8.0940e-01,  3.8856e-01, -1.0419e+00],
         [-8.9815e-01,  3.1428e-01, -1.1720e+00]],

        [[ 6.7865e-01,  8.3563e-01,  6.6250e-01],
         [ 5.9507e-01,  9.3269e-01,  7.0435e-01],
         [ 6.5674e-01,  8.3923e-01,  6.9882e-01],
         ...,
         [-2.3054e-01,  3.5551e-01, -3.5493e-01],
         [-2.1713e-01,  3.6480e-01, -3.2844e-01],
         [-2.7460e-01,  3.1484e-01, -4.3022e-01]]], grad_fn=&lt;SqueezeBackward1&gt;), std=tensor([[[0.4361, 1.1451, 1.1246],
         [0.4393, 1.1508, 1.1318],
         [0.4395, 1.1530, 1.1323],
         ...,
         [0.4396, 1.1532, 1.1324],
         [0.4397, 1.1532, 1.1325],
         [0.4469, 1.1565, 1.1400]],

        [[0.4361, 1.1451, 1.1246],
         [0.4393, 1.1508, 1.1318],
         [0.4395, 1.1530, 1.1323],
         ...,
         [0.4396, 1.1532, 1.1324],
         [0.4397, 1.1532, 1.1325],
         [0.4469, 1.1565, 1.1400]],

        [[0.4361, 1.1451, 1.1246],
         [0.4393, 1.1508, 1.1318],
         [0.4395, 1.1530, 1.1323],
         ...,
         [0.4396, 1.1532, 1.1324],
         [0.4397, 1.1532, 1.1325],
         [0.4469, 1.1565, 1.1400]],

        ...,

        [[0.4361, 1.1451, 1.1246],
         [0.4393, 1.1508, 1.1318],
         [0.4395, 1.1530, 1.1323],
         ...,
         [0.4396, 1.1532, 1.1324],
         [0.4397, 1.1532, 1.1325],
         [0.4469, 1.1565, 1.1400]],

        [[0.4361, 1.1451, 1.1246],
         [0.4393, 1.1508, 1.1318],
         [0.4395, 1.1530, 1.1323],
         ...,
         [0.4396, 1.1532, 1.1324],
         [0.4397, 1.1532, 1.1325],
         [0.4469, 1.1565, 1.1400]],

        [[0.4361, 1.1451, 1.1246],
         [0.4393, 1.1508, 1.1318],
         [0.4395, 1.1530, 1.1323],
         ...,
         [0.4396, 1.1532, 1.1324],
         [0.4397, 1.1532, 1.1325],
         [0.4469, 1.1565, 1.1400]]], grad_fn=&lt;SqrtBackward0&gt;))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(pred), <span class="bu">type</span>(pred_filt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(__main__.NormalsParams, __main__.NormalsParams)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>test_ne(pred, pred_filt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loss-function" class="level3">
<h3 class="anchored" data-anchor-id="loss-function">Loss Function</h3>
<p>add support for complete loss (also outside gap) and for filter loss (don’t run the smooher)</p>
<p>There are two ways to compute the loss, one is to do it for all predictions the other is for doing it for only the gap - only_gap</p>
<p>Play around with flatting + diagonal</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> torch.diag(torch.tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> torch.stack([a, a<span class="op">*</span><span class="dv">10</span>])</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> torch.stack([a.diag(), a.diag()<span class="op">*</span><span class="dv">10</span>])</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[[ 1,  0,  0],
         [ 0,  2,  0],
         [ 0,  0,  3]],

        [[10,  0,  0],
         [ 0, 20,  0],
         [ 0,  0, 30]]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>m.flatten()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([ 1,  2,  3, 10, 20, 30])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[[ 1,  0,  0],
         [ 0,  2,  0],
         [ 0,  0,  3]],

        [[10,  0,  0],
         [ 0, 20,  0],
         [ 0,  0, 30]]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>torch.diagonal(d, dim1<span class="op">=</span><span class="dv">1</span>, dim2<span class="op">=</span><span class="dv">2</span>).flatten()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([ 1,  2,  3, 10, 20, 30])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>means, stds <span class="op">=</span> pred</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>data, mask, contr <span class="op">=</span> target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a big matrix with all variables and observations and compute ll</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> mask.flatten() </span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>obs <span class="op">=</span> data.flatten()[mask]</span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> data.flatten()[mask]</span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>stds <span class="op">=</span> stds.flatten()[mask] <span class="co"># need to support batches</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>MultivariateNormal(means, torch.diag(stds)).log_prob(obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(-4817.6538, grad_fn=&lt;SubBackward0&gt;)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L544" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="kalmanloss" class="level3">
<h3 class="anchored" data-anchor-id="kalmanloss">KalmanLoss</h3>
<blockquote class="blockquote">
<pre><code> KalmanLoss (only_gap:bool=True, reduction:str='mean')</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>only_gap</td>
<td>bool</td>
<td>True</td>
<td>loss for all predictions or only gap</td>
</tr>
<tr class="even">
<td>reduction</td>
<td>str</td>
<td>mean</td>
<td>one of [‘sum’, ‘mean’, ‘none’]</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(<span class="bu">input</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>data, mask, contr <span class="op">=</span> <span class="bu">input</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>data.shape, mask.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([10, 200, 3]), torch.Size([10, 200, 3]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>pred.mean.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>means, stds <span class="op">=</span> pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>stds.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>means.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>data.isnan().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(False)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>mask.isnan().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(False)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>means.isnan().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(False)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>stds.isnan().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(0)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>stds.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>is_posdef_eigv(torch.diag(stds.flatten()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(tensor(True),
 tensor([0.9017, 0.9017, 0.9017,  ..., 2.6384, 2.6384, 2.6384],
        grad_fn=&lt;LinalgEighBackward0&gt;))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>KalmanLoss(only_gap<span class="op">=</span><span class="va">True</span>)(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(114.6033, grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>KalmanLoss(only_gap<span class="op">=</span><span class="va">False</span>)(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(3449.2515, grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>pred.mean.device, target[<span class="dv">0</span>].device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(device(type='cpu'), device(type='cpu'))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>pred.mean.shape, target[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([10, 200, 3]), torch.Size([10, 200, 3]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>target[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>KalmanLoss(only_gap<span class="op">=</span><span class="va">False</span>, reduction<span class="op">=</span><span class="st">'mean'</span>)(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(3449.2515, grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
</section>
<section id="metrics" class="level3">
<h3 class="anchored" data-anchor-id="metrics">Metrics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>pred0, targ <span class="op">=</span> target[<span class="dv">0</span>][<span class="dv">0</span>].detach().cpu(), pred[<span class="dv">0</span>][<span class="dv">0</span>].detach().cpu()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>pred0.shape, targ.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([200, 3]), torch.Size([200, 3]))</code></pre>
</div>
</div>
<p>The shape of the input is very important for the r2score, which cannot be batched and requires a needs to keep the multidimensional input</p>
<p><span class="math display">\[ R^2(y, \hat{y}) = 1 - \frac{\sum_{i=1}^{n} (y_i - \hat{y}_i)^2}{\sum_{i=1}^{n} (y_i - \bar{y})^2} \]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>r2_score(pred0, targ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>-44.859557160462295</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>r2_score(pred0, targ, multioutput<span class="op">=</span><span class="st">"raw_values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([-82.40850349,  -2.52230802, -49.64785997])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>r2_score(pred0.flatten(), targ.flatten())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>-15.672803450819654</code></pre>
</div>
</div>
<p>While for the <code>rmse</code> is okay to batch and flatten input. The only difference is how the mean is computed, which is a minor difference</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>mean_squared_error(pred0, targ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>12.148896</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>mean_squared_error(pred0.flatten(), targ.flatten())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>12.148896</code></pre>
</div>
</div>
<p>Wrapper around fastai metrics to support masked tensors and normal distributions</p>
<p>The problem is that fastai metrics by default flatten everything … so need to reimplement them</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>myr2 <span class="op">=</span> skm_to_fastai(r2_score, flatten<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>myr2(pred[<span class="dv">0</span>][<span class="dv">0</span>], target[<span class="dv">0</span>][<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>-44.859557160462295</code></pre>
</div>
</div>
<p>but the mask is still flattening the data ….</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> target[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>m.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([200, 3])</code></pre>
</div>
</div>
<p>need to get the mask as a matrix and not as a vector, so drop columns and rows that are all true and then check the resulting mask is all False</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>mask_sub <span class="op">=</span> m[:, <span class="op">~</span>m.<span class="bu">all</span>(<span class="dv">0</span>)][<span class="op">~</span>m.<span class="bu">all</span>(<span class="dv">1</span>),:]</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>mask_sub</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="op">~</span>mask_sub.<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(True)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="op">=</span> m.clone()</span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>m2[<span class="dv">0</span>,<span class="dv">0</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a>m2[:, <span class="op">~</span>m2.<span class="bu">all</span>(<span class="dv">0</span>)][<span class="op">~</span>m2.<span class="bu">all</span>(<span class="dv">1</span>),:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[False,  True],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False],
        [False, False]])</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L579" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="impmetric" class="level3">
<h3 class="anchored" data-anchor-id="impmetric">ImpMetric</h3>
<blockquote class="blockquote">
<pre><code> ImpMetric (metric, name, only_gap=False, flatten=False)</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>rmse_mask.name, rmse_gap.name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>('rmse', 'rmse')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>rmse_mask(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>3.771059036254883</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>rmse_gap(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>3.2700576782226562</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>r2_mask.name, r2_gap.name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>('r2', 'r2')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>r2_mask(pred, target), r2_gap(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(-308.00872802734375, -3104.080322265625)</code></pre>
</div>
</div>
</section>
<section id="callback" class="level3">
<h3 class="anchored" data-anchor-id="callback">Callback</h3>
<p>save the model state</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L626" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="saveparams" class="level3">
<h3 class="anchored" data-anchor-id="saveparams">SaveParams</h3>
<blockquote class="blockquote">
<pre><code> SaveParams (param_name)</code></pre>
</blockquote>
<p>Basic class handling tweaks of the training loop by changing a <code>Learner</code> in various events</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L626" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="saveparams-1" class="level3">
<h3 class="anchored" data-anchor-id="saveparams-1">SaveParams</h3>
<blockquote class="blockquote">
<pre><code> SaveParams (param_name)</code></pre>
</blockquote>
<p>Basic class handling tweaks of the training loop by changing a <code>Learner</code> in various events</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>debug_preds <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DebugPredCallback(Callback):</span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>    order <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> after_validate(<span class="va">self</span>):</span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">hasattr</span>(<span class="va">self</span>, <span class="st">'gather_preds'</span>):</span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>            debug_preds.append(<span class="va">self</span>.gather_preds.preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="learner" class="level3">
<h3 class="anchored" data-anchor-id="learner">Learner</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>obs_cov_history <span class="op">=</span> SaveParams(<span class="st">'obs_cov'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> CollectDataCallback()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KalmanFilter.init_random(n_dim_obs <span class="op">=</span> hai.shape[<span class="dv">1</span>], n_dim_state <span class="op">=</span> hai.shape[<span class="dv">1</span>], n_dim_contr <span class="op">=</span> hai_era.shape[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>control_repeat).cuda()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model._set_constraint('obs_cov', model.obs_cov, train=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> imp_dataloader(hai[:<span class="dv">20000</span>], hai_era, var_sel, gap_len, block_len, control_lags, <span class="dv">2</span>, bs<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>dls.one_batch()[<span class="dv">0</span>][<span class="dv">0</span>].device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>device(type='cuda', index=0)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="bu">input</span>, target <span class="op">=</span> dls.one_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(<span class="bu">input</span>)</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>KalmanLoss()(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(4.8269, device='cuda:0', grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> Learner(dls, model, loss_func<span class="op">=</span>KalmanLoss(only_gap<span class="op">=</span><span class="va">False</span>), cbs <span class="op">=</span> [DebugPredCallback] , metrics <span class="op">=</span> imp_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>learn.fit(<span class="dv">1</span>, <span class="fl">1e-3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th>epoch</th>
<th>train_loss</th>
<th>valid_loss</th>
<th>rmse</th>
<th>rmse_gap</th>
<th>r2</th>
<th>r2_gap</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>20.619263</td>
<td>19.848585</td>
<td>0.150341</td>
<td>0.167943</td>
<td>-1027.213139</td>
<td>-12404.165356</td>
<td>01:35</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> Learner(dls, model, loss_func<span class="op">=</span>KalmanLoss(only_gap<span class="op">=</span><span class="va">True</span>), cbs <span class="op">=</span> [DebugPredCallback] , metrics <span class="op">=</span> imp_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>learn.fit(<span class="dv">1</span>, <span class="fl">1e-3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th>epoch</th>
<th>train_loss</th>
<th>valid_loss</th>
<th>rmse</th>
<th>rmse_gap</th>
<th>r2</th>
<th>r2_gap</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.752472</td>
<td>1.391766</td>
<td>0.136404</td>
<td>0.145466</td>
<td>-576.202639</td>
<td>-10002.387744</td>
<td>01:46</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="float64" class="level4">
<h4 class="anchored" data-anchor-id="float64">Float64</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>model64 <span class="op">=</span> KalmanFilter.init_random(hai.shape[<span class="dv">1</span>], hai.shape[<span class="dv">1</span>], n_dim_contr <span class="op">=</span> hai_era.shape[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>control_repeat, dtype<span class="op">=</span>torch.float64).cuda()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L645" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="float64callback" class="level3">
<h3 class="anchored" data-anchor-id="float64callback">Float64Callback</h3>
<blockquote class="blockquote">
<pre><code> Float64Callback (after_create=None, before_fit=None, before_epoch=None,
                  before_train=None, before_batch=None, after_pred=None,
                  after_loss=None, before_backward=None,
                  after_cancel_backward=None, after_backward=None,
                  before_step=None, after_cancel_step=None,
                  after_step=None, after_cancel_batch=None,
                  after_batch=None, after_cancel_train=None,
                  after_train=None, before_validate=None,
                  after_cancel_validate=None, after_validate=None,
                  after_cancel_epoch=None, after_epoch=None,
                  after_cancel_fit=None, after_fit=None)</code></pre>
</blockquote>
<p>Basic class handling tweaks of the training loop by changing a <code>Learner</code> in various events</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>dls64 <span class="op">=</span> imp_dataloader(hai64[:<span class="dv">20000</span>], hai_era64, var_sel <span class="op">=</span> var_sel, block_len <span class="op">=</span> <span class="dv">10</span>, gap_len <span class="op">=</span> <span class="dv">2</span>, control_lags <span class="op">=</span> [<span class="dv">1</span>], bs<span class="op">=</span><span class="dv">10</span>, n_rep<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>input64 <span class="op">=</span> dls64.one_batch()[<span class="dv">0</span>]</span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>target64 <span class="op">=</span> dls64.one_batch()[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>data64, mask64, contr64 <span class="op">=</span> input64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>data64.dtype, data64.dtype, contr64.dtype, data64.device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.float64, torch.float64, torch.float64, device(type='cuda', index=0))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>model64.predict(data64, mask64, contr64)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model64(input64)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>KalmanLoss()(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(4.5162, device='cuda:0', grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>learn64 <span class="op">=</span> Learner(dls64, model64, loss_func<span class="op">=</span>KalmanLoss(), cbs <span class="op">=</span> [Float64Callback] , metrics <span class="op">=</span> imp_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>learn64.fit(<span class="dv">1</span>, <span class="fl">1e-3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th>epoch</th>
<th>train_loss</th>
<th>valid_loss</th>
<th>rmse</th>
<th>rmse_gap</th>
<th>r2</th>
<th>r2_gap</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>4.509624</td>
<td>4.509314</td>
<td>0.469744</td>
<td>0.480389</td>
<td>-1271816046246544181264654532608.000000</td>
<td>-48821.499965</td>
<td>00:31</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="predictions" class="level3">
<h3 class="anchored" data-anchor-id="predictions">Predictions</h3>
<p>The transformation pipeline is not working properly (there is a problem in <code>decode_batch</code> as the <code>_types</code> are more nested than the predictions, which results in an error) + the pipeline is anyway not reproducible + the test dataloaders seems that they are actually not deterministic ….. soo reimplement everything almost from scratch</p>
<p>see https://github.com/mone27/meteo_imp/blob/0335003405ec9bd3e3bd2641bc6d7924f34a0788/lib_nbs/kalman/10_fastai.ipynb for all details</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L651" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="normalsdf" class="level3">
<h3 class="anchored" data-anchor-id="normalsdf">NormalsDf</h3>
<blockquote class="blockquote">
<pre><code> NormalsDf (mean, std)</code></pre>
</blockquote>
<p>DataFrames of Normal parameters (mean and std)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>tfms5.fs[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
  <p>
    <strong>BlockIndexTransform</strong>
  </p>
  <p>(list,object) -&gt; encodes
</p>
  <p></p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>tfms5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
  <span>TfmdLists. Items:</span>
  <pre>(#4) [[800, 0],[801, 0],[802, 0],[803, 0]]</pre>
  <ol start="0">
    <li>
      <div>
        <p>
          <strong>BlockIndexTransform</strong>
        </p>
        <p>(list,object) -&gt; encodes
</p>
        <p></p>
      </div>
    </li>
    <li>
      <div>
        <p>
          <strong>BlockDfTransform</strong>
        </p>
        <p>(DatetimeIndex,object) -&gt; encodes
</p>
        <p></p>
      </div>
    </li>
    <li>
      <div>
        <p>
          <strong>AddGapTransform</strong>
        </p>
        <p>(DataControl,object) -&gt; encodes
</p>
        <p></p>
      </div>
    </li>
    <li>
      <div>
        <p>
          <strong>MeteoImpDf2Tensor</strong>
        </p>
        <p>(MeteoImpDf,object) -&gt; encodes
</p>
        <p></p>
      </div>
    </li>
    <li>
      <div>
        <p>
          <strong>MeteoImpNormalize -- {'mean_data': tensor([  8.3339, 120.9578,   3.3807]), 'std_data': tensor([  7.9246, 204.0026,   4.3684]), 'mean_control': tensor([  8.1948, 120.6864,   3.3253,   8.1948, 120.6864,   3.3253]), 'std_control': tensor([  7.5459, 187.1730,   3.6871,   7.5459, 187.1730,   3.6871])}</strong>
        </p>
        <p>(MeteoImpTensor,object) -&gt; encodes
</p>
        <p>(MeteoImpTensor,object) -&gt; decodes
(NormalsParams,object) -&gt; decodes
</p>
      </div>
    </li>
    <li>
      <div>
        <p>
          <strong>ToTuple</strong>
        </p>
        <p>(object,object) -&gt; encodes
</p>
        <p>(object,object) -&gt; decodes
</p>
      </div>
    </li>
  </ol>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>pipe0, pipe1 <span class="op">=</span> tfms5.fs[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>], tfms5.fs[<span class="dv">3</span>,<span class="dv">4</span>] </span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a>pipe0, pipe1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>((#3) [BlockIndexTransform:
encodes: (list,object) -&gt; encodes
decodes: ,BlockDfTransform:
encodes: (DatetimeIndex,object) -&gt; encodes
decodes: ,AddGapTransform:
encodes: (DataControl,object) -&gt; encodes
decodes: ],
 (#2) [MeteoImpDf2Tensor:
encodes: (MeteoImpDf,object) -&gt; encodes
decodes: ,MeteoImpNormalize -- {'mean_data': tensor([  8.3339, 120.9578,   3.3807]), 'std_data': tensor([  7.9246, 204.0026,   4.3684]), 'mean_control': tensor([  8.1948, 120.6864,   3.3253,   8.1948, 120.6864,   3.3253]), 'std_control': tensor([  7.5459, 187.1730,   3.6871,   7.5459, 187.1730,   3.6871])}:
encodes: (MeteoImpTensor,object) -&gt; encodes
decodes: (MeteoImpTensor,object) -&gt; decodes
(NormalsParams,object) -&gt; decodes
])</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L662" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="preds2df" class="level3">
<h3 class="anchored" data-anchor-id="preds2df">preds2df</h3>
<blockquote class="blockquote">
<pre><code> preds2df (preds, targs)</code></pre>
</blockquote>
<p>Final step to decode preds by getting a dataframe</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L674" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="predict_items" class="level3">
<h3 class="anchored" data-anchor-id="predict_items">predict_items</h3>
<blockquote class="blockquote">
<pre><code> predict_items (items, learn, pipe0, pipe1)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>preds, targs, losses, metrics <span class="op">=</span> predict_items([[<span class="dv">0</span>,<span class="dv">0</span>],[<span class="dv">1</span>,<span class="dv">0</span>],[<span class="dv">3</span>,<span class="dv">0</span>]], learn, pipe0, pipe1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>predict_items([[<span class="dv">0</span>,<span class="dv">0</span>]], learn, pipe0, pipe1)[<span class="dv">1</span>][<span class="dv">0</span>].data <span class="op">==</span> predict_items([[<span class="dv">0</span>,<span class="dv">0</span>]], learn, pipe0, pipe1)[<span class="dv">1</span>][<span class="dv">0</span>].data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>TA</th>
<th>SW_IN</th>
<th>VPD</th>
</tr>
<tr class="odd">
<th>time</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>2000-01-01 01:00:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<th>2000-01-01 01:30:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="odd">
<th>2000-01-01 02:00:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<th>2000-01-01 02:30:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="odd">
<th>2000-01-01 03:00:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<th>2000-01-01 03:30:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="odd">
<th>2000-01-01 04:00:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<th>2000-01-01 04:30:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="odd">
<th>2000-01-01 05:00:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<th>2000-01-01 05:30:00</th>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'rmse': 0.10065293312072754,
  'rmse_gap': 0.0664796307682991,
  'r2': -63.429805755615234,
  'r2_gap': -1717.8394775390625},
 {'rmse': 0.08947934955358505,
  'rmse_gap': 0.06449507176876068,
  'r2': -26.80200958251953,
  'r2_gap': -7142.291015625},
 {'rmse': 0.08320702612400055,
  'rmse_gap': 0.06998797506093979,
  'r2': -266.775634765625,
  'r2_gap': -165805.09375}]</code></pre>
</div>
</div>
<section id="plot-results" class="level4">
<h4 class="anchored" data-anchor-id="plot-results">Plot results</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>targs[<span class="dv">0</span>].control</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th>TA_ERA</th>
<th>SW_IN_ERA</th>
<th>VPD_ERA</th>
<th>TA_ERA_lag_1</th>
<th>SW_IN_ERA_lag_1</th>
<th>VPD_ERA_lag_1</th>
</tr>
<tr class="odd">
<th>time</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>2000-01-01 01:00:00</th>
<td>-0.390</td>
<td>0.0</td>
<td>0.399</td>
<td>-0.349</td>
<td>0.0</td>
<td>0.403</td>
</tr>
<tr class="even">
<th>2000-01-01 01:30:00</th>
<td>-0.430</td>
<td>0.0</td>
<td>0.396</td>
<td>-0.390</td>
<td>0.0</td>
<td>0.399</td>
</tr>
<tr class="odd">
<th>2000-01-01 02:00:00</th>
<td>-0.439</td>
<td>0.0</td>
<td>0.411</td>
<td>-0.430</td>
<td>0.0</td>
<td>0.396</td>
</tr>
<tr class="even">
<th>2000-01-01 02:30:00</th>
<td>-0.449</td>
<td>0.0</td>
<td>0.426</td>
<td>-0.439</td>
<td>0.0</td>
<td>0.411</td>
</tr>
<tr class="odd">
<th>2000-01-01 03:00:00</th>
<td>-0.458</td>
<td>0.0</td>
<td>0.442</td>
<td>-0.449</td>
<td>0.0</td>
<td>0.426</td>
</tr>
<tr class="even">
<th>2000-01-01 03:30:00</th>
<td>-0.467</td>
<td>0.0</td>
<td>0.457</td>
<td>-0.458</td>
<td>0.0</td>
<td>0.442</td>
</tr>
<tr class="odd">
<th>2000-01-01 04:00:00</th>
<td>-0.477</td>
<td>0.0</td>
<td>0.472</td>
<td>-0.467</td>
<td>0.0</td>
<td>0.457</td>
</tr>
<tr class="even">
<th>2000-01-01 04:30:00</th>
<td>-0.486</td>
<td>0.0</td>
<td>0.488</td>
<td>-0.477</td>
<td>0.0</td>
<td>0.472</td>
</tr>
<tr class="odd">
<th>2000-01-01 05:00:00</th>
<td>-0.417</td>
<td>0.0</td>
<td>0.492</td>
<td>-0.486</td>
<td>0.0</td>
<td>0.488</td>
</tr>
<tr class="even">
<th>2000-01-01 05:30:00</th>
<td>-0.349</td>
<td>0.0</td>
<td>0.497</td>
<td>-0.417</td>
<td>0.0</td>
<td>0.492</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L692" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="format_metric" class="level3">
<h3 class="anchored" data-anchor-id="format_metric">format_metric</h3>
<blockquote class="blockquote">
<pre><code> format_metric (name, val)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L698" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_result" class="level3">
<h3 class="anchored" data-anchor-id="plot_result">plot_result</h3>
<blockquote class="blockquote">
<pre><code> plot_result (pred, targ, loss, metrics, control=None, show_metric=True,
              n_cols:int=3, bind_interaction:bool=True, units=None,
              ys=['value', 'value', 'control'], title='', sel=None,
              error=False, point=True, gap_area=True, props={})</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pred</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>targ</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>loss</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>metrics</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>control</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>show_metric</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="odd">
<td>n_cols</td>
<td>int</td>
<td>3</td>
<td></td>
</tr>
<tr class="even">
<td>bind_interaction</td>
<td>bool</td>
<td>True</td>
<td>Whether the sub-plots for each variable should be connected for zooming/panning</td>
</tr>
<tr class="odd">
<td>units</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>ys</td>
<td>list</td>
<td>[‘value’, ‘value’, ‘control’]</td>
<td></td>
</tr>
<tr class="odd">
<td>title</td>
<td>str</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>sel</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>error</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="even">
<td>point</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="odd">
<td>gap_area</td>
<td>bool</td>
<td>True</td>
<td></td>
</tr>
<tr class="even">
<td>props</td>
<td>dict</td>
<td>{}</td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="st">"mean"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a>plot_result(preds[<span class="dv">0</span>], targs[<span class="dv">0</span>], torch.tensor(<span class="dv">1</span>), {<span class="st">"a"</span>: <span class="dv">1</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-32040d3a3269401cb5b937b71ed0e52b"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-32040d3a3269401cb5b937b71ed0e52b") {
      outputDiv = document.getElementById("altair-viz-32040d3a3269401cb5b937b71ed0e52b");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"layer": [{"data": {"name": "data-4385b809e056975c12bb0067e10712ea"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-d3647b7bf826706d87b620948e73edb1"}}, {"data": {"name": "data-4385b809e056975c12bb0067e10712ea"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_23"}, {"data": {"name": "data-4385b809e056975c12bb0067e10712ea"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}, {"layer": [{"data": {"name": "data-cc01da4f090398b6bba008e0b867584d"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-d3647b7bf826706d87b620948e73edb1"}}, {"data": {"name": "data-cc01da4f090398b6bba008e0b867584d"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_24"}, {"data": {"name": "data-cc01da4f090398b6bba008e0b867584d"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_25"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "data": {"name": "data-c59bb4f171f6bdbc4ea5d4228dec3dbc"}, "height": 150, "title": "", "width": 200}]}], "params": [{"name": "param_36", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_23", "view_24", "view_25"]}], "title": ["loss: 1.000000", "a: 1.000000"], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-4385b809e056975c12bb0067e10712ea": [{"time": "2000-01-01T01:00:00", "variable": "TA", "value": -0.6499999761581421, "is_present": true, "mean": 2.021482467651367, "std": 2.2792186737060547, "err_low": -2.536954879760742, "err_high": 6.579919815063477}, {"time": "2000-01-01T01:30:00", "variable": "TA", "value": -0.5799999833106995, "is_present": true, "mean": -0.7873735427856445, "std": 1.8224880695343018, "err_low": -4.432349681854248, "err_high": 2.857602596282959}, {"time": "2000-01-01T02:00:00", "variable": "TA", "value": -0.5099999904632568, "is_present": false, "mean": -1.0720272064208984, "std": 1.7987185716629028, "err_low": -4.669464111328125, "err_high": 2.5254099369049072}, {"time": "2000-01-01T02:30:00", "variable": "TA", "value": -0.49000000953674316, "is_present": false, "mean": -1.0994739532470703, "std": 1.7984693050384521, "err_low": -4.696412563323975, "err_high": 2.497464656829834}, {"time": "2000-01-01T03:00:00", "variable": "TA", "value": -0.4000000059604645, "is_present": true, "mean": -1.0712080001831055, "std": 1.7966855764389038, "err_low": -4.664579391479492, "err_high": 2.522163152694702}, {"time": "2000-01-01T03:30:00", "variable": "TA", "value": -0.36000001430511475, "is_present": true, "mean": -1.058609962463379, "std": 1.7932419776916504, "err_low": -4.64509391784668, "err_high": 2.527873992919922}, {"time": "2000-01-01T04:00:00", "variable": "TA", "value": -0.3499999940395355, "is_present": true, "mean": -1.0617523193359375, "std": 1.7927089929580688, "err_low": -4.647170066833496, "err_high": 2.5236656665802}, {"time": "2000-01-01T04:30:00", "variable": "TA", "value": -0.2800000011920929, "is_present": true, "mean": -1.066253662109375, "std": 1.7926561832427979, "err_low": -4.651566028594971, "err_high": 2.5190587043762207}, {"time": "2000-01-01T05:00:00", "variable": "TA", "value": -0.27000001072883606, "is_present": true, "mean": -1.046773910522461, "std": 1.7928084135055542, "err_low": -4.632390975952148, "err_high": 2.5388429164886475}, {"time": "2000-01-01T05:30:00", "variable": "TA", "value": -0.23000000417232513, "is_present": true, "mean": -1.035207748413086, "std": 1.7942185401916504, "err_low": -4.623644828796387, "err_high": 2.553229331970215}], "data-d3647b7bf826706d87b620948e73edb1": [{"gap_start": "2000-01-01T02:00:00", "gap_end": "2000-01-01T02:30:00"}], "data-cc01da4f090398b6bba008e0b867584d": [{"time": "2000-01-01T01:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 62.65424728393555, "std": 72.92684173583984, "err_low": -83.19943237304688, "err_high": 208.5079345703125}, {"time": "2000-01-01T01:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 19.291580200195312, "std": 66.76834106445312, "err_low": -114.24510192871094, "err_high": 152.82826232910156}, {"time": "2000-01-01T02:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 13.993194580078125, "std": 70.6077651977539, "err_low": -127.22233581542969, "err_high": 155.20872497558594}, {"time": "2000-01-01T02:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 9.18743896484375, "std": 70.31156158447266, "err_low": -131.43568420410156, "err_high": 149.81056213378906}, {"time": "2000-01-01T03:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 5.129119873046875, "std": 65.77459716796875, "err_low": -126.42007446289062, "err_high": 136.67831420898438}, {"time": "2000-01-01T03:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 3.4213333129882812, "std": 65.54722595214844, "err_low": -127.6731185913086, "err_high": 134.51577758789062}, {"time": "2000-01-01T04:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 2.6744461059570312, "std": 65.52386474609375, "err_low": -128.373291015625, "err_high": 133.72216796875}, {"time": "2000-01-01T04:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 2.7286148071289062, "std": 65.52470397949219, "err_low": -128.32080078125, "err_high": 133.77801513671875}, {"time": "2000-01-01T05:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 3.3744735717773438, "std": 65.5591049194336, "err_low": -127.74373626708984, "err_high": 134.49267578125}, {"time": "2000-01-01T05:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 2.4483642578125, "std": 65.86611938476562, "err_low": -129.28387451171875, "err_high": 134.18060302734375}], "data-c59bb4f171f6bdbc4ea5d4228dec3dbc": [{"time": "2000-01-01T01:00:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -0.3708653450012207, "std": 1.2578855752944946, "err_low": -2.88663649559021, "err_high": 2.1449058055877686}, {"time": "2000-01-01T01:30:00", "variable": "VPD", "value": 0.09000000357627869, "is_present": true, "mean": 0.021699190139770508, "std": 1.261460542678833, "err_low": -2.5012218952178955, "err_high": 2.5446202754974365}, {"time": "2000-01-01T02:00:00", "variable": "VPD", "value": 0.10999999940395355, "is_present": true, "mean": 0.11522173881530762, "std": 1.2884418964385986, "err_low": -2.4616620540618896, "err_high": 2.692105531692505}, {"time": "2000-01-01T02:30:00", "variable": "VPD", "value": 0.10199999809265137, "is_present": true, "mean": 0.11627769470214844, "std": 1.287011742591858, "err_low": -2.4577457904815674, "err_high": 2.6903011798858643}, {"time": "2000-01-01T03:00:00", "variable": "VPD", "value": 0.11100000143051147, "is_present": true, "mean": 0.15901756286621094, "std": 1.2578859329223633, "err_low": -2.3567543029785156, "err_high": 2.6747894287109375}, {"time": "2000-01-01T03:30:00", "variable": "VPD", "value": 0.10899999737739563, "is_present": true, "mean": 0.1667330265045166, "std": 1.257826805114746, "err_low": -2.3489205837249756, "err_high": 2.682386636734009}, {"time": "2000-01-01T04:00:00", "variable": "VPD", "value": 0.10700000077486038, "is_present": true, "mean": 0.1686701774597168, "std": 1.25785493850708, "err_low": -2.3470396995544434, "err_high": 2.684380054473877}, {"time": "2000-01-01T04:30:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": 0.18788385391235352, "std": 1.2578831911087036, "err_low": -2.3278825283050537, "err_high": 2.7036502361297607}, {"time": "2000-01-01T05:00:00", "variable": "VPD", "value": 0.1379999965429306, "is_present": true, "mean": 0.1941988468170166, "std": 1.2583062648773193, "err_low": -2.322413682937622, "err_high": 2.7108113765716553}, {"time": "2000-01-01T05:30:00", "variable": "VPD", "value": 0.1379999965429306, "is_present": true, "mean": 0.06104016304016113, "std": 1.2641608715057373, "err_low": -2.4672815799713135, "err_high": 2.5893619060516357}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>plot_result(preds[<span class="dv">0</span>], targs[<span class="dv">0</span>], torch.tensor(<span class="dv">1</span>), {<span class="st">"a"</span>: <span class="dv">1</span>}, control<span class="op">=</span>hai_control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-0bf17bfa7d97476b8efd35b6713f1710"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0bf17bfa7d97476b8efd35b6713f1710") {
      outputDiv = document.getElementById("altair-viz-0bf17bfa7d97476b8efd35b6713f1710");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"layer": [{"data": {"name": "data-bf85f16ffc45b934704998448c765560"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-d3647b7bf826706d87b620948e73edb1"}}, {"data": {"name": "data-bf85f16ffc45b934704998448c765560"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_26"}, {"data": {"name": "data-bf85f16ffc45b934704998448c765560"}, "mark": {"type": "line", "strokeDash": [4, 6]}, "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "control", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"data": {"name": "data-bf85f16ffc45b934704998448c765560"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}, {"layer": [{"data": {"name": "data-5c8217d1500dcd72649ce36ae24ec889"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-d3647b7bf826706d87b620948e73edb1"}}, {"data": {"name": "data-5c8217d1500dcd72649ce36ae24ec889"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_27"}, {"data": {"name": "data-5c8217d1500dcd72649ce36ae24ec889"}, "mark": {"type": "line", "strokeDash": [4, 6]}, "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "control", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"data": {"name": "data-5c8217d1500dcd72649ce36ae24ec889"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_28"}, {"mark": {"type": "line", "strokeDash": [4, 6]}, "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "control", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "data": {"name": "data-edf84a60d35e33e2536dded9424852cf"}, "height": 150, "title": "", "width": 200}]}], "params": [{"name": "param_40", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_26", "view_27", "view_28"]}], "title": ["loss: 1.000000", "a: 1.000000"], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-bf85f16ffc45b934704998448c765560": [{"time": "2000-01-01T01:00:00", "variable": "TA", "value": -0.6499999761581421, "control": -0.38999998569488525, "is_present": true, "mean": 2.021482467651367, "std": 2.2792186737060547, "err_low": -2.536954879760742, "err_high": 6.579919815063477}, {"time": "2000-01-01T01:30:00", "variable": "TA", "value": -0.5799999833106995, "control": -0.4300000071525574, "is_present": true, "mean": -0.7873735427856445, "std": 1.8224880695343018, "err_low": -4.432349681854248, "err_high": 2.857602596282959}, {"time": "2000-01-01T02:00:00", "variable": "TA", "value": -0.5099999904632568, "control": -0.4390000104904175, "is_present": false, "mean": -1.0720272064208984, "std": 1.7987185716629028, "err_low": -4.669464111328125, "err_high": 2.5254099369049072}, {"time": "2000-01-01T02:30:00", "variable": "TA", "value": -0.49000000953674316, "control": -0.4490000009536743, "is_present": false, "mean": -1.0994739532470703, "std": 1.7984693050384521, "err_low": -4.696412563323975, "err_high": 2.497464656829834}, {"time": "2000-01-01T03:00:00", "variable": "TA", "value": -0.4000000059604645, "control": -0.4580000042915344, "is_present": true, "mean": -1.0712080001831055, "std": 1.7966855764389038, "err_low": -4.664579391479492, "err_high": 2.522163152694702}, {"time": "2000-01-01T03:30:00", "variable": "TA", "value": -0.36000001430511475, "control": -0.46700000762939453, "is_present": true, "mean": -1.058609962463379, "std": 1.7932419776916504, "err_low": -4.64509391784668, "err_high": 2.527873992919922}, {"time": "2000-01-01T04:00:00", "variable": "TA", "value": -0.3499999940395355, "control": -0.47699999809265137, "is_present": true, "mean": -1.0617523193359375, "std": 1.7927089929580688, "err_low": -4.647170066833496, "err_high": 2.5236656665802}, {"time": "2000-01-01T04:30:00", "variable": "TA", "value": -0.2800000011920929, "control": -0.4860000014305115, "is_present": true, "mean": -1.066253662109375, "std": 1.7926561832427979, "err_low": -4.651566028594971, "err_high": 2.5190587043762207}, {"time": "2000-01-01T05:00:00", "variable": "TA", "value": -0.27000001072883606, "control": -0.4169999957084656, "is_present": true, "mean": -1.046773910522461, "std": 1.7928084135055542, "err_low": -4.632390975952148, "err_high": 2.5388429164886475}, {"time": "2000-01-01T05:30:00", "variable": "TA", "value": -0.23000000417232513, "control": -0.3490000069141388, "is_present": true, "mean": -1.035207748413086, "std": 1.7942185401916504, "err_low": -4.623644828796387, "err_high": 2.553229331970215}], "data-d3647b7bf826706d87b620948e73edb1": [{"gap_start": "2000-01-01T02:00:00", "gap_end": "2000-01-01T02:30:00"}], "data-5c8217d1500dcd72649ce36ae24ec889": [{"time": "2000-01-01T01:00:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": true, "mean": 62.65424728393555, "std": 72.92684173583984, "err_low": -83.19943237304688, "err_high": 208.5079345703125}, {"time": "2000-01-01T01:30:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": true, "mean": 19.291580200195312, "std": 66.76834106445312, "err_low": -114.24510192871094, "err_high": 152.82826232910156}, {"time": "2000-01-01T02:00:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": false, "mean": 13.993194580078125, "std": 70.6077651977539, "err_low": -127.22233581542969, "err_high": 155.20872497558594}, {"time": "2000-01-01T02:30:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": false, "mean": 9.18743896484375, "std": 70.31156158447266, "err_low": -131.43568420410156, "err_high": 149.81056213378906}, {"time": "2000-01-01T03:00:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": true, "mean": 5.129119873046875, "std": 65.77459716796875, "err_low": -126.42007446289062, "err_high": 136.67831420898438}, {"time": "2000-01-01T03:30:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": true, "mean": 3.4213333129882812, "std": 65.54722595214844, "err_low": -127.6731185913086, "err_high": 134.51577758789062}, {"time": "2000-01-01T04:00:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": true, "mean": 2.6744461059570312, "std": 65.52386474609375, "err_low": -128.373291015625, "err_high": 133.72216796875}, {"time": "2000-01-01T04:30:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": true, "mean": 2.7286148071289062, "std": 65.52470397949219, "err_low": -128.32080078125, "err_high": 133.77801513671875}, {"time": "2000-01-01T05:00:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": true, "mean": 3.3744735717773438, "std": 65.5591049194336, "err_low": -127.74373626708984, "err_high": 134.49267578125}, {"time": "2000-01-01T05:30:00", "variable": "SW_IN", "value": 0.0, "control": 0.0, "is_present": true, "mean": 2.4483642578125, "std": 65.86611938476562, "err_low": -129.28387451171875, "err_high": 134.18060302734375}], "data-edf84a60d35e33e2536dded9424852cf": [{"time": "2000-01-01T01:00:00", "variable": "VPD", "value": 0.12200000137090683, "control": 0.39899998903274536, "is_present": true, "mean": -0.3708653450012207, "std": 1.2578855752944946, "err_low": -2.88663649559021, "err_high": 2.1449058055877686}, {"time": "2000-01-01T01:30:00", "variable": "VPD", "value": 0.09000000357627869, "control": 0.3959999978542328, "is_present": true, "mean": 0.021699190139770508, "std": 1.261460542678833, "err_low": -2.5012218952178955, "err_high": 2.5446202754974365}, {"time": "2000-01-01T02:00:00", "variable": "VPD", "value": 0.10999999940395355, "control": 0.41100001335144043, "is_present": true, "mean": 0.11522173881530762, "std": 1.2884418964385986, "err_low": -2.4616620540618896, "err_high": 2.692105531692505}, {"time": "2000-01-01T02:30:00", "variable": "VPD", "value": 0.10199999809265137, "control": 0.4259999990463257, "is_present": true, "mean": 0.11627769470214844, "std": 1.287011742591858, "err_low": -2.4577457904815674, "err_high": 2.6903011798858643}, {"time": "2000-01-01T03:00:00", "variable": "VPD", "value": 0.11100000143051147, "control": 0.44200000166893005, "is_present": true, "mean": 0.15901756286621094, "std": 1.2578859329223633, "err_low": -2.3567543029785156, "err_high": 2.6747894287109375}, {"time": "2000-01-01T03:30:00", "variable": "VPD", "value": 0.10899999737739563, "control": 0.4569999873638153, "is_present": true, "mean": 0.1667330265045166, "std": 1.257826805114746, "err_low": -2.3489205837249756, "err_high": 2.682386636734009}, {"time": "2000-01-01T04:00:00", "variable": "VPD", "value": 0.10700000077486038, "control": 0.47200000286102295, "is_present": true, "mean": 0.1686701774597168, "std": 1.25785493850708, "err_low": -2.3470396995544434, "err_high": 2.684380054473877}, {"time": "2000-01-01T04:30:00", "variable": "VPD", "value": 0.12200000137090683, "control": 0.4880000054836273, "is_present": true, "mean": 0.18788385391235352, "std": 1.2578831911087036, "err_low": -2.3278825283050537, "err_high": 2.7036502361297607}, {"time": "2000-01-01T05:00:00", "variable": "VPD", "value": 0.1379999965429306, "control": 0.492000013589859, "is_present": true, "mean": 0.1941988468170166, "std": 1.2583062648773193, "err_low": -2.322413682937622, "err_high": 2.7108113765716553}, {"time": "2000-01-01T05:30:00", "variable": "VPD", "value": 0.1379999965429306, "control": 0.4970000088214874, "is_present": true, "mean": 0.06104016304016113, "std": 1.2641608715057373, "err_low": -2.4672815799713135, "err_high": 2.5893619060516357}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L705" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_results" class="level3">
<h3 class="anchored" data-anchor-id="plot_results">plot_results</h3>
<blockquote class="blockquote">
<pre><code> plot_results (preds, targs, losses, metrics, n_cols=1, **kwargs)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>plot_results(preds, targs, losses, metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-c9d2aeb466124abf9066e7193aacd66a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-c9d2aeb466124abf9066e7193aacd66a") {
      outputDiv = document.getElementById("altair-viz-c9d2aeb466124abf9066e7193aacd66a");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"vconcat": [{"hconcat": [{"layer": [{"data": {"name": "data-4385b809e056975c12bb0067e10712ea"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-d3647b7bf826706d87b620948e73edb1"}}, {"data": {"name": "data-4385b809e056975c12bb0067e10712ea"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_29"}, {"data": {"name": "data-4385b809e056975c12bb0067e10712ea"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}]}, {"hconcat": [{"layer": [{"data": {"name": "data-cc01da4f090398b6bba008e0b867584d"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-d3647b7bf826706d87b620948e73edb1"}}, {"data": {"name": "data-cc01da4f090398b6bba008e0b867584d"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_30"}, {"data": {"name": "data-cc01da4f090398b6bba008e0b867584d"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}]}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_31"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}], "data": {"name": "data-c59bb4f171f6bdbc4ea5d4228dec3dbc"}}], "title": ["loss: 1.163543", "rmse: 0.100653", "rmse_gap: 0.066480", "r2: -63.429806", "r2_gap: -1717.839478"]}, {"vconcat": [{"hconcat": [{"layer": [{"data": {"name": "data-56b122029defdca34c5262a59af02299"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-22b514a72148b05dd7be146caaa527e7"}}, {"data": {"name": "data-56b122029defdca34c5262a59af02299"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_32"}, {"data": {"name": "data-56b122029defdca34c5262a59af02299"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}]}, {"hconcat": [{"layer": [{"data": {"name": "data-476481c3c1dc74f0f84b722404d63596"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-22b514a72148b05dd7be146caaa527e7"}}, {"data": {"name": "data-476481c3c1dc74f0f84b722404d63596"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_33"}, {"data": {"name": "data-476481c3c1dc74f0f84b722404d63596"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}]}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_34"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}], "data": {"name": "data-20be0175e33b8bc5980e6e2e8a500d11"}}], "title": ["loss: 1.162365", "rmse: 0.089479", "rmse_gap: 0.064495", "r2: -26.802010", "r2_gap: -7142.291016"]}, {"vconcat": [{"hconcat": [{"layer": [{"data": {"name": "data-b6a9e996982bbfe9ec248f65fbddcb20"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-d2f3eefc95043ed43f1d38fc833e8633"}}, {"data": {"name": "data-b6a9e996982bbfe9ec248f65fbddcb20"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_35"}, {"data": {"name": "data-b6a9e996982bbfe9ec248f65fbddcb20"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}]}, {"hconcat": [{"layer": [{"data": {"name": "data-9e646d0b866f416e3f89eec212808365"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}}}, {"mark": "rule", "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_end", "type": "temporal"}}}, {"mark": {"type": "rect", "color": "black", "opacity": 0.15}, "encoding": {"x": {"axis": {"domain": false, "labels": false, "ticks": false, "title": null}, "field": "gap_start", "type": "temporal"}, "x2": {"field": "gap_end"}}}], "data": {"name": "data-d2f3eefc95043ed43f1d38fc833e8633"}}, {"data": {"name": "data-9e646d0b866f416e3f89eec212808365"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_36"}, {"data": {"name": "data-9e646d0b866f416e3f89eec212808365"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}]}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"axis": {"domain": true, "labels": true, "ticks": true, "title": "time"}, "field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_37"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}], "height": 150, "title": "", "width": 200}], "data": {"name": "data-1e05d38cb01a3392ccf80a126bba469f"}}], "title": ["loss: 1.162020", "rmse: 0.083207", "rmse_gap: 0.069988", "r2: -266.775635", "r2_gap: -165805.093750"]}], "params": [{"name": "param_44", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_29", "view_30", "view_31"]}, {"name": "param_48", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_32", "view_33", "view_34"]}, {"name": "param_52", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_35", "view_36", "view_37"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-4385b809e056975c12bb0067e10712ea": [{"time": "2000-01-01T01:00:00", "variable": "TA", "value": -0.6499999761581421, "is_present": true, "mean": 2.021482467651367, "std": 2.2792186737060547, "err_low": -2.536954879760742, "err_high": 6.579919815063477}, {"time": "2000-01-01T01:30:00", "variable": "TA", "value": -0.5799999833106995, "is_present": true, "mean": -0.7873735427856445, "std": 1.8224880695343018, "err_low": -4.432349681854248, "err_high": 2.857602596282959}, {"time": "2000-01-01T02:00:00", "variable": "TA", "value": -0.5099999904632568, "is_present": false, "mean": -1.0720272064208984, "std": 1.7987185716629028, "err_low": -4.669464111328125, "err_high": 2.5254099369049072}, {"time": "2000-01-01T02:30:00", "variable": "TA", "value": -0.49000000953674316, "is_present": false, "mean": -1.0994739532470703, "std": 1.7984693050384521, "err_low": -4.696412563323975, "err_high": 2.497464656829834}, {"time": "2000-01-01T03:00:00", "variable": "TA", "value": -0.4000000059604645, "is_present": true, "mean": -1.0712080001831055, "std": 1.7966855764389038, "err_low": -4.664579391479492, "err_high": 2.522163152694702}, {"time": "2000-01-01T03:30:00", "variable": "TA", "value": -0.36000001430511475, "is_present": true, "mean": -1.058609962463379, "std": 1.7932419776916504, "err_low": -4.64509391784668, "err_high": 2.527873992919922}, {"time": "2000-01-01T04:00:00", "variable": "TA", "value": -0.3499999940395355, "is_present": true, "mean": -1.0617523193359375, "std": 1.7927089929580688, "err_low": -4.647170066833496, "err_high": 2.5236656665802}, {"time": "2000-01-01T04:30:00", "variable": "TA", "value": -0.2800000011920929, "is_present": true, "mean": -1.066253662109375, "std": 1.7926561832427979, "err_low": -4.651566028594971, "err_high": 2.5190587043762207}, {"time": "2000-01-01T05:00:00", "variable": "TA", "value": -0.27000001072883606, "is_present": true, "mean": -1.046773910522461, "std": 1.7928084135055542, "err_low": -4.632390975952148, "err_high": 2.5388429164886475}, {"time": "2000-01-01T05:30:00", "variable": "TA", "value": -0.23000000417232513, "is_present": true, "mean": -1.035207748413086, "std": 1.7942185401916504, "err_low": -4.623644828796387, "err_high": 2.553229331970215}], "data-d3647b7bf826706d87b620948e73edb1": [{"gap_start": "2000-01-01T02:00:00", "gap_end": "2000-01-01T02:30:00"}], "data-cc01da4f090398b6bba008e0b867584d": [{"time": "2000-01-01T01:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 62.65424728393555, "std": 72.92684173583984, "err_low": -83.19943237304688, "err_high": 208.5079345703125}, {"time": "2000-01-01T01:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 19.291580200195312, "std": 66.76834106445312, "err_low": -114.24510192871094, "err_high": 152.82826232910156}, {"time": "2000-01-01T02:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 13.993194580078125, "std": 70.6077651977539, "err_low": -127.22233581542969, "err_high": 155.20872497558594}, {"time": "2000-01-01T02:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 9.18743896484375, "std": 70.31156158447266, "err_low": -131.43568420410156, "err_high": 149.81056213378906}, {"time": "2000-01-01T03:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 5.129119873046875, "std": 65.77459716796875, "err_low": -126.42007446289062, "err_high": 136.67831420898438}, {"time": "2000-01-01T03:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 3.4213333129882812, "std": 65.54722595214844, "err_low": -127.6731185913086, "err_high": 134.51577758789062}, {"time": "2000-01-01T04:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 2.6744461059570312, "std": 65.52386474609375, "err_low": -128.373291015625, "err_high": 133.72216796875}, {"time": "2000-01-01T04:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 2.7286148071289062, "std": 65.52470397949219, "err_low": -128.32080078125, "err_high": 133.77801513671875}, {"time": "2000-01-01T05:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 3.3744735717773438, "std": 65.5591049194336, "err_low": -127.74373626708984, "err_high": 134.49267578125}, {"time": "2000-01-01T05:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 2.4483642578125, "std": 65.86611938476562, "err_low": -129.28387451171875, "err_high": 134.18060302734375}], "data-c59bb4f171f6bdbc4ea5d4228dec3dbc": [{"time": "2000-01-01T01:00:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -0.3708653450012207, "std": 1.2578855752944946, "err_low": -2.88663649559021, "err_high": 2.1449058055877686}, {"time": "2000-01-01T01:30:00", "variable": "VPD", "value": 0.09000000357627869, "is_present": true, "mean": 0.021699190139770508, "std": 1.261460542678833, "err_low": -2.5012218952178955, "err_high": 2.5446202754974365}, {"time": "2000-01-01T02:00:00", "variable": "VPD", "value": 0.10999999940395355, "is_present": true, "mean": 0.11522173881530762, "std": 1.2884418964385986, "err_low": -2.4616620540618896, "err_high": 2.692105531692505}, {"time": "2000-01-01T02:30:00", "variable": "VPD", "value": 0.10199999809265137, "is_present": true, "mean": 0.11627769470214844, "std": 1.287011742591858, "err_low": -2.4577457904815674, "err_high": 2.6903011798858643}, {"time": "2000-01-01T03:00:00", "variable": "VPD", "value": 0.11100000143051147, "is_present": true, "mean": 0.15901756286621094, "std": 1.2578859329223633, "err_low": -2.3567543029785156, "err_high": 2.6747894287109375}, {"time": "2000-01-01T03:30:00", "variable": "VPD", "value": 0.10899999737739563, "is_present": true, "mean": 0.1667330265045166, "std": 1.257826805114746, "err_low": -2.3489205837249756, "err_high": 2.682386636734009}, {"time": "2000-01-01T04:00:00", "variable": "VPD", "value": 0.10700000077486038, "is_present": true, "mean": 0.1686701774597168, "std": 1.25785493850708, "err_low": -2.3470396995544434, "err_high": 2.684380054473877}, {"time": "2000-01-01T04:30:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": 0.18788385391235352, "std": 1.2578831911087036, "err_low": -2.3278825283050537, "err_high": 2.7036502361297607}, {"time": "2000-01-01T05:00:00", "variable": "VPD", "value": 0.1379999965429306, "is_present": true, "mean": 0.1941988468170166, "std": 1.2583062648773193, "err_low": -2.322413682937622, "err_high": 2.7108113765716553}, {"time": "2000-01-01T05:30:00", "variable": "VPD", "value": 0.1379999965429306, "is_present": true, "mean": 0.06104016304016113, "std": 1.2641608715057373, "err_low": -2.4672815799713135, "err_high": 2.5893619060516357}], "data-56b122029defdca34c5262a59af02299": [{"time": "2000-01-01T06:00:00", "variable": "TA", "value": -0.23000000417232513, "is_present": true, "mean": 2.3367366790771484, "std": 2.2792186737060547, "err_low": -2.221700668334961, "err_high": 6.895174026489258}, {"time": "2000-01-01T06:30:00", "variable": "TA", "value": -0.2199999988079071, "is_present": true, "mean": -0.59454345703125, "std": 1.8224880695343018, "err_low": -4.2395195960998535, "err_high": 3.0504326820373535}, {"time": "2000-01-01T07:00:00", "variable": "TA", "value": -0.23999999463558197, "is_present": false, "mean": -0.8529644012451172, "std": 1.7987185716629028, "err_low": -4.450401306152344, "err_high": 2.7444727420806885}, {"time": "2000-01-01T07:30:00", "variable": "TA", "value": -0.23000000417232513, "is_present": false, "mean": -0.8119087219238281, "std": 1.7984693050384521, "err_low": -4.408847332000732, "err_high": 2.785029888153076}, {"time": "2000-01-01T08:00:00", "variable": "TA", "value": -0.2199999988079071, "is_present": true, "mean": -0.7012357711791992, "std": 1.7966855764389038, "err_low": -4.294607162475586, "err_high": 2.8921353816986084}, {"time": "2000-01-01T08:30:00", "variable": "TA", "value": -0.1899999976158142, "is_present": true, "mean": -0.5749883651733398, "std": 1.7932419776916504, "err_low": -4.161472320556641, "err_high": 3.011495590209961}, {"time": "2000-01-01T09:00:00", "variable": "TA", "value": -0.14000000059604645, "is_present": true, "mean": -0.422332763671875, "std": 1.7927089929580688, "err_low": -4.007750511169434, "err_high": 3.1630852222442627}, {"time": "2000-01-01T09:30:00", "variable": "TA", "value": -0.029999999329447746, "is_present": true, "mean": -0.27406978607177734, "std": 1.7926561832427979, "err_low": -3.859382152557373, "err_high": 3.3112425804138184}, {"time": "2000-01-01T10:00:00", "variable": "TA", "value": 0.03999999910593033, "is_present": true, "mean": -0.15576457977294922, "std": 1.7928084135055542, "err_low": -3.7413814067840576, "err_high": 3.429852247238159}, {"time": "2000-01-01T10:30:00", "variable": "TA", "value": 0.10000000149011612, "is_present": true, "mean": -0.0411224365234375, "std": 1.7942185401916504, "err_low": -3.6295595169067383, "err_high": 3.5473146438598633}], "data-22b514a72148b05dd7be146caaa527e7": [{"gap_start": "2000-01-01T07:00:00", "gap_end": "2000-01-01T07:30:00"}], "data-476481c3c1dc74f0f84b722404d63596": [{"time": "2000-01-01T06:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 59.85215759277344, "std": 72.92684173583984, "err_low": -86.00152587890625, "err_high": 205.70584106445312}, {"time": "2000-01-01T06:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 17.410995483398438, "std": 66.76834106445312, "err_low": -116.12568664550781, "err_high": 150.9476776123047}, {"time": "2000-01-01T07:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 11.970458984375, "std": 70.6077651977539, "err_low": -129.2450714111328, "err_high": 153.1859893798828}, {"time": "2000-01-01T07:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 8.703857421875, "std": 70.31156158447266, "err_low": -131.9192657470703, "err_high": 149.3269805908203}, {"time": "2000-01-01T08:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 5.413482666015625, "std": 65.77459716796875, "err_low": -126.13571166992188, "err_high": 136.96267700195312}, {"time": "2000-01-01T08:30:00", "variable": "SW_IN", "value": 0.44999998807907104, "is_present": true, "mean": 4.88775634765625, "std": 65.54722595214844, "err_low": -126.20669555664062, "err_high": 135.98220825195312}, {"time": "2000-01-01T09:00:00", "variable": "SW_IN", "value": 3.700000047683716, "is_present": true, "mean": 6.377128601074219, "std": 65.52386474609375, "err_low": -124.67060089111328, "err_high": 137.42486572265625}, {"time": "2000-01-01T09:30:00", "variable": "SW_IN", "value": 7.260000228881836, "is_present": true, "mean": 9.48834228515625, "std": 65.52470397949219, "err_low": -121.56106567382812, "err_high": 140.53775024414062}, {"time": "2000-01-01T10:00:00", "variable": "SW_IN", "value": 12.239999771118164, "is_present": true, "mean": 13.917221069335938, "std": 65.5591049194336, "err_low": -117.20098876953125, "err_high": 145.03543090820312}, {"time": "2000-01-01T10:30:00", "variable": "SW_IN", "value": 16.510000228881836, "is_present": true, "mean": 16.698814392089844, "std": 65.86611938476562, "err_low": -115.0334243774414, "err_high": 148.43106079101562}], "data-20be0175e33b8bc5980e6e2e8a500d11": [{"time": "2000-01-01T06:00:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -0.3462998867034912, "std": 1.2578855752944946, "err_low": -2.8620710372924805, "err_high": 2.169471263885498}, {"time": "2000-01-01T06:30:00", "variable": "VPD", "value": 0.09799999743700027, "is_present": true, "mean": 0.0510408878326416, "std": 1.261460542678833, "err_low": -2.4718801975250244, "err_high": 2.5739619731903076}, {"time": "2000-01-01T07:00:00", "variable": "VPD", "value": 0.06599999964237213, "is_present": true, "mean": 0.06720948219299316, "std": 1.2884418964385986, "err_low": -2.509674310684204, "err_high": 2.6440932750701904}, {"time": "2000-01-01T07:30:00", "variable": "VPD", "value": 0.04399999976158142, "is_present": true, "mean": 0.05135345458984375, "std": 1.287011742591858, "err_low": -2.522670030593872, "err_high": 2.6253769397735596}, {"time": "2000-01-01T08:00:00", "variable": "VPD", "value": 0.026000000536441803, "is_present": true, "mean": 0.046900033950805664, "std": 1.2578859329223633, "err_low": -2.468871831893921, "err_high": 2.5626718997955322}, {"time": "2000-01-01T08:30:00", "variable": "VPD", "value": 0.01600000075995922, "is_present": true, "mean": 0.02837204933166504, "std": 1.257826805114746, "err_low": -2.487281560897827, "err_high": 2.5440256595611572}, {"time": "2000-01-01T09:00:00", "variable": "VPD", "value": 0.009999999776482582, "is_present": true, "mean": 0.018536090850830078, "std": 1.25785493850708, "err_low": -2.49717378616333, "err_high": 2.5342459678649902}, {"time": "2000-01-01T09:30:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": 0.011316061019897461, "std": 1.2578831911087036, "err_low": -2.5044503211975098, "err_high": 2.5270824432373047}, {"time": "2000-01-01T10:00:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": 0.009427070617675781, "std": 1.2583062648773193, "err_low": -2.507185459136963, "err_high": 2.5260396003723145}, {"time": "2000-01-01T10:30:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": -0.10770845413208008, "std": 1.2641608715057373, "err_low": -2.6360301971435547, "err_high": 2.4206132888793945}], "data-b6a9e996982bbfe9ec248f65fbddcb20": [{"time": "2000-01-01T16:00:00", "variable": "TA", "value": 0.5699999928474426, "is_present": true, "mean": 2.740248680114746, "std": 2.2792186737060547, "err_low": -1.8181886672973633, "err_high": 7.2986860275268555}, {"time": "2000-01-01T16:30:00", "variable": "TA", "value": 0.7300000190734863, "is_present": true, "mean": 1.049889087677002, "std": 1.8224880695343018, "err_low": -2.5950870513916016, "err_high": 4.6948652267456055}, {"time": "2000-01-01T17:00:00", "variable": "TA", "value": 0.7699999809265137, "is_present": false, "mean": 1.103198528289795, "std": 1.7987185716629028, "err_low": -2.4942386150360107, "err_high": 4.70063591003418}, {"time": "2000-01-01T17:30:00", "variable": "TA", "value": 0.8399999737739563, "is_present": false, "mean": 1.3082165718078613, "std": 1.7984693050384521, "err_low": -2.288722038269043, "err_high": 4.905155181884766}, {"time": "2000-01-01T18:00:00", "variable": "TA", "value": 0.9900000095367432, "is_present": true, "mean": 1.5040969848632812, "std": 1.7966855764389038, "err_low": -2.0892741680145264, "err_high": 5.097468376159668}, {"time": "2000-01-01T18:30:00", "variable": "TA", "value": 1.350000023841858, "is_present": true, "mean": 1.7364153861999512, "std": 1.7932419776916504, "err_low": -1.8500685691833496, "err_high": 5.322899341583252}, {"time": "2000-01-01T19:00:00", "variable": "TA", "value": 1.8600000143051147, "is_present": true, "mean": 1.958282470703125, "std": 1.7927089929580688, "err_low": -1.6271355152130127, "err_high": 5.543700218200684}, {"time": "2000-01-01T19:30:00", "variable": "TA", "value": 2.009999990463257, "is_present": true, "mean": 2.1626501083374023, "std": 1.7926561832427979, "err_low": -1.4226622581481934, "err_high": 5.747962474822998}, {"time": "2000-01-01T20:00:00", "variable": "TA", "value": 2.069999933242798, "is_present": true, "mean": 2.3103904724121094, "std": 1.7928084135055542, "err_low": -1.275226354598999, "err_high": 5.896007537841797}, {"time": "2000-01-01T20:30:00", "variable": "TA", "value": 2.0, "is_present": true, "mean": 2.357977867126465, "std": 1.7942185401916504, "err_low": -1.230459213256836, "err_high": 5.946414947509766}], "data-d2f3eefc95043ed43f1d38fc833e8633": [{"gap_start": "2000-01-01T17:00:00", "gap_end": "2000-01-01T17:30:00"}], "data-9e646d0b866f416e3f89eec212808365": [{"time": "2000-01-01T16:00:00", "variable": "SW_IN", "value": 6.369999885559082, "is_present": true, "mean": 60.4833984375, "std": 72.92684173583984, "err_low": -85.37028503417969, "err_high": 206.3370819091797}, {"time": "2000-01-01T16:30:00", "variable": "SW_IN", "value": 1.7200000286102295, "is_present": true, "mean": 23.143394470214844, "std": 66.76834106445312, "err_low": -110.3932876586914, "err_high": 156.68008422851562}, {"time": "2000-01-01T17:00:00", "variable": "SW_IN", "value": 0.05999999865889549, "is_present": false, "mean": 18.86042022705078, "std": 70.6077651977539, "err_low": -122.35511016845703, "err_high": 160.07595825195312}, {"time": "2000-01-01T17:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 15.591773986816406, "std": 70.31156158447266, "err_low": -125.0313491821289, "err_high": 156.21490478515625}, {"time": "2000-01-01T18:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 9.208030700683594, "std": 65.77459716796875, "err_low": -122.3411636352539, "err_high": 140.75723266601562}, {"time": "2000-01-01T18:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 7.874786376953125, "std": 65.54722595214844, "err_low": -123.21966552734375, "err_high": 138.96923828125}, {"time": "2000-01-01T19:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 7.587028503417969, "std": 65.52386474609375, "err_low": -123.46070098876953, "err_high": 138.634765625}, {"time": "2000-01-01T19:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 7.543449401855469, "std": 65.52470397949219, "err_low": -123.5059585571289, "err_high": 138.59286499023438}, {"time": "2000-01-01T20:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 7.6258697509765625, "std": 65.5591049194336, "err_low": -123.49234008789062, "err_high": 138.74407958984375}, {"time": "2000-01-01T20:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 5.370841979980469, "std": 65.86611938476562, "err_low": -126.36139678955078, "err_high": 137.10308837890625}], "data-1e05d38cb01a3392ccf80a126bba469f": [{"time": "2000-01-01T16:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -0.39362382888793945, "std": 1.2578855752944946, "err_low": -2.9093949794769287, "err_high": 2.12214732170105}, {"time": "2000-01-01T16:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -0.13465523719787598, "std": 1.261460542678833, "err_low": -2.657576322555542, "err_high": 2.38826584815979}, {"time": "2000-01-01T17:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -0.007746458053588867, "std": 1.2884418964385986, "err_low": -2.584630250930786, "err_high": 2.5691373348236084}, {"time": "2000-01-01T17:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": 0.0056040287017822266, "std": 1.287011742591858, "err_low": -2.5684194564819336, "err_high": 2.579627513885498}, {"time": "2000-01-01T18:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -0.08444595336914062, "std": 1.2578859329223633, "err_low": -2.600217819213867, "err_high": 2.431325912475586}, {"time": "2000-01-01T18:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -0.06829118728637695, "std": 1.257826805114746, "err_low": -2.583944797515869, "err_high": 2.4473624229431152}, {"time": "2000-01-01T19:00:00", "variable": "VPD", "value": 0.0020000000949949026, "is_present": true, "mean": -0.039962053298950195, "std": 1.25785493850708, "err_low": -2.5556719303131104, "err_high": 2.47574782371521}, {"time": "2000-01-01T19:30:00", "variable": "VPD", "value": 0.008999999612569809, "is_present": true, "mean": -0.03877878189086914, "std": 1.2578831911087036, "err_low": -2.5545451641082764, "err_high": 2.476987600326538}, {"time": "2000-01-01T20:00:00", "variable": "VPD", "value": 0.014000000432133675, "is_present": true, "mean": -0.04281187057495117, "std": 1.2583062648773193, "err_low": -2.55942440032959, "err_high": 2.4738006591796875}, {"time": "2000-01-01T20:30:00", "variable": "VPD", "value": 0.014000000432133675, "is_present": true, "mean": -0.15938973426818848, "std": 1.2641608715057373, "err_low": -2.687711477279663, "err_high": 2.368932008743286}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<section id="show-results" class="level4">
<h4 class="anchored" data-anchor-id="show-results">Show Results</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>random.choices(learn.dls.items, k<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>learn.metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L710" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="get_results" class="level3">
<h3 class="anchored" data-anchor-id="get_results">get_results</h3>
<blockquote class="blockquote">
<pre><code> get_results (learn, n=3, items=None, dls=None)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L718" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="show_results" class="level3">
<h3 class="anchored" data-anchor-id="show_results">show_results</h3>
<blockquote class="blockquote">
<pre><code> show_results (learn, n=3, items=None, **kwargs)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a>learn.model.use_smooth <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>show_results(learn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>show_results(learn, items<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>learn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="interactive" class="level4">
<h4 class="anchored" data-anchor-id="interactive">Interactive</h4>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L726" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="results_custom_gap" class="level3">
<h3 class="anchored" data-anchor-id="results_custom_gap">results_custom_gap</h3>
<blockquote class="blockquote">
<pre><code> results_custom_gap (learn, df, control, items_idx, var_sel, gap_len,
                     block_len, shift, control_lags)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a>plot_results(<span class="op">*</span>results_custom_gap(learn64, df<span class="op">=</span>hai64, control<span class="op">=</span>hai_era64,</span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a>                                 items_idx <span class="op">=</span> [<span class="dv">800</span>, <span class="dv">801</span>, <span class="dv">804</span>],</span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a>                                 var_sel<span class="op">=</span>[<span class="st">'TA'</span>], gap_len<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a>                                 block_len<span class="op">=</span><span class="dv">200</span>, control_lags<span class="op">=</span>[<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L733" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="interact_results" class="level3">
<h3 class="anchored" data-anchor-id="interact_results">interact_results</h3>
<blockquote class="blockquote">
<pre><code> interact_results (learn, df, control)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>learn64.model.use_smooth <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb368"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a>interact_results(learn64, hai64, hai_era64)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="export" class="level2">
<h2 class="anchored" data-anchor-id="export">Export</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>